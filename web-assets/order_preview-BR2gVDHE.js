import{L as q,d as B,F as I}from"./index-DbFwXZiH.js";import{F as C,O as T}from"./form_page-BKQCl3L2.js";import{P as k}from"./public_order_strings-0E9VaVZd.js";class ${format(e,i,r){if(e==null)return"";let s=e;const n=this._getOptions(i);return n&&n.length>0&&(s=this._resolveOptionLabel(e,n,r)),String(s)}_getOptions(e){return e.options||e.data&&e.data.options}_resolveOptionLabel(e,i,r){const s=String(e);return s.includes(" | ")?s.split(" | ").map(c=>this._findOptionTitle(c,i,r)).join(", "):this._findOptionTitle(e,i,r)}_findOptionTitle(e,i,r){const s=i.find(n=>n.id!=null&&String(n.id)===String(e));if(s){let n=s.title;return s.price&&r&&r.currency&&(n+=` (${s.price} ${r.currency})`),n}return e}}class N extends ${_getOptions(e){return e.data&&e.data.product_type_data&&e.data.product_type_data.products?e.data.product_type_data.products:super._getOptions(e)}}class A extends ${format(e,i,r){if(!e)return"";let s,n;if(typeof e=="object"?(s=e.id_document_number,n=e.id_document_expiry_date):s=e,!s)return"";let c=s;if(n){const y=this._formatDate(n);c+=` (${y})`}return c}_formatDate(e){if(!e)return"";try{const i=new Date(e);if(isNaN(i.getTime()))return e;const r=q.currentLocale==="cs"?"cs-CZ":"en-US";return new Intl.DateTimeFormat(r,{year:"numeric",month:"numeric",day:"numeric"}).format(i)}catch{return e}}}class H{static _strategies={default:new $,product_type:new N,id_document:new A};static getStrategy(e){return this._strategies[e.type]||this._strategies.default}static format(e,i,r){return this.getStrategy(e).format(i,e,r)}}if(typeof document<"u"){const w=new URL("/web-assets/order_preview-DIGWdSNj.css",import.meta.url).href;if(!document.querySelector(`link[href="${w}"]`)){const e=document.createElement("link");e.rel="stylesheet",e.href=w,document.head.appendChild(e)}}class L{static show(e,i,r,s,n,c=null){const y=L._prepareData(e,i,r,c);let t=document.getElementById("order-preview-overlay");t||(t=document.createElement("div"),t.id="order-preview-overlay",t.className="order-preview-overlay",document.body.appendChild(t)),t.innerHTML=L._render(y);let a=!1;const f=()=>{if(!a){if(a=!0,t.dataset.closedByDrag!=="true")t.classList.add("closing");else{const u=t.querySelector(".order-preview-content");u&&(u.style.animation="none"),t.classList.add("closing")}document.removeEventListener("keydown",h),t.removeEventListener("click",l),setTimeout(()=>{t.style.display="none",t.classList.remove("visible","closing"),delete t.dataset.closedByDrag,t.innerHTML="",document.body.style.overflow="",n&&n()},250)}},o=t.querySelector(".btn-close-preview"),p=()=>{B.goBackProgrammatically()};o&&(o.onclick=p);const h=u=>{u.key==="Escape"&&p()};document.addEventListener("keydown",h);const l=u=>{u.target===t&&p()};t.addEventListener("click",l);const v=t.querySelector(".btn-submit-order");v&&(v.onclick=()=>{s&&s(t)}),t.classList.remove("closing"),t.style.display="flex",t.offsetHeight,t.classList.add("visible");const d=t.querySelector(".order-preview-content"),m=t.querySelector(".order-preview-body");let g=0,E=0,b=!1,_=!1;const D=u=>{if(!(u.target.closest(".order-preview-header")||u.target.closest(".order-preview-handle-bar"))){_=!0;return}_=!1,g=u.touches[0].clientY,b=!1,d.style.transition="none"},O=u=>{if(_)return;E=u.touches[0].clientY;const S=E-g;if(S>0){u.cancelable&&u.preventDefault(),b=!0,d.style.transform=`translateY(${S}px)`;const P=d.clientHeight||500,x=.5*(1-Math.min(S/P,1));t.style.backgroundColor=`rgba(0, 0, 0, ${x})`}},Y=u=>{if(_||!b)return;E-g>150?(d.style.transition="transform 0.2s ease-out",d.style.transform="translateY(100%)",t.dataset.closedByDrag="true",p()):(d.style.transition="transform 0.25s cubic-bezier(0.25, 0.8, 0.25, 1.0)",d.style.transform="",t.style.backgroundColor="",setTimeout(()=>{!b&&d&&(d.style.transition="")},250)),b=!1};d&&(d.addEventListener("touchstart",D,{passive:!1}),d.addEventListener("touchmove",O,{passive:!1}),d.addEventListener("touchend",Y)),setTimeout(()=>{m&&L._animateScrollToBottom(m,700)},150),document.body.style.overflow="hidden",B.pushOverlayState("order-preview");const F=()=>{f(),window.removeEventListener("popstate",F)};window.addEventListener("popstate",F,{once:!0})}static _animateScrollToBottom(e,i){const r=e.scrollTop,s=e.scrollHeight-e.clientHeight;if(r>=s)return;const n=s-r,c=+new Date,y=(a,f,o,p)=>(a/=p/2,a<1?o/2*a*a+f:(a--,-o/2*(a*(a-2)-1)+f)),t=()=>{const f=+new Date-c;e.scrollTop=parseInt(y(f,r,n,i)),f<i?requestAnimationFrame(t):e.scrollTop=s};t()}static _prepareData(e,i,r,s){const n=s||C.getPayload(e,i),c=r,y=[];n.fields.forEach(o=>{Object.keys(o).forEach(p=>{if(p==="currency_code")return;const h=o[p],l=i.relatedFields.find(v=>String(v.id)===p);if(l&&l.type!=="ticket"){const v=H.format(l,h,{currency:c.currency});y.push({label:l.title,value:v})}})});const t=[],a=n.ticket||[],f=[];return i.visibleFields.forEach(o=>{if(o.type==="ticket"){const p=o.subFields||o.fields||o.data&&o.data.fields||[];f.push(...p)}}),a.forEach((o,p)=>{const h={index:p+1,rows:[],hasSpot:!1};if(o.spot!==void 0){h.hasSpot=!0;let l=o.spotName||`Spot #${o.spot}`;o.spotPrice&&(l+=` (${o.spotPrice} ${c.currency})`),h.rows.push({label:T.gridSpot||"Spot",value:l,isSpot:!0})}o.fields&&o.fields.forEach(l=>{Object.keys(l).forEach(v=>{if(v==="currency_code")return;const d=l[v];let m=null;if(l._subFieldId?m=f.find(g=>String(g.id)===String(l._subFieldId)):m=f.find(g=>g.type===v),!(m&&v!==m.type)&&m){const g=H.format(m,d,{currency:c.currency});h.rows.push({label:m.title,value:g})}})}),t.push(h)}),{personalInfo:y,tickets:t,totalPrice:c.totalPrice,currency:c.currency,hasTickets:I.isFeatureEnabled(I.FeatureConstants.ticket,i.occasionFeatures),tone:i.communicationTone}}static _getAutoTitle(e){return""}static _render(e){const i=e.hasTickets?T.ticket||"Ticket":T.application||"Application";let r=`
            <div class="order-preview-content">
                <div class="order-preview-handle-bar">
                    <div class="order-preview-handle"></div>
                </div>
                <div class="order-preview-header">
                    <h2>${k.summary}</h2>
                    <button class="btn-close-preview"><i class="material-icons">close</i></button>
                </div>
                <div class="order-preview-body">
        `;e.personalInfo.length>0&&(r+='<div class="preview-section">',e.personalInfo.forEach((t,a)=>{r+=`
                    <div class="preview-info-row">
                        <span class="preview-label">${t.label}:</span>
                        <span class="preview-value">${t.value}</span>
                    </div>
                `,a<e.personalInfo.length-1&&(r+='<div class="preview-divider"></div>')}),r+="</div>"),e.tickets.length>0&&e.tickets.forEach(t=>{r+=`
                    <div class="ticket-card">
                        <div class="ticket-header-title">${i}${e.tickets.length>1?" "+t.index:""}</div>
                  `,t.rows.forEach((a,f)=>{r+=`
                        <div class="preview-info-row">
                             <span class="preview-label">${a.label}:</span>
                             <span class="preview-value">${a.value}</span>
                        </div>
                      `,f<t.rows.length-1&&(r+='<div class="preview-divider"></div>')}),r+="</div>"});const s=k.totalPrice(`${e.totalPrice} ${e.currency}`);r+=`
             <div class="preview-total-price">
                 ${s}
             </div>
        `,r+="</div>";const n=e.tone,c=e.hasTickets,y=k.getSubmitButton(c,n);return r+=`
             <div class="preview-actions">
                 <button class="btn-submit-order">
                     ${y}
                 </button>
             </div>
        `,r+="</div>",r}}export{L as OrderPreview};
