const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["web-assets/blueprint_selector-DPxokn65.js","web-assets/index-DbFwXZiH.js","web-assets/index-CNMjAoaq.css","web-assets/order_preview-BR2gVDHE.js","web-assets/public_order_strings-0E9VaVZd.js","web-assets/order_result-C1RlXkgt.js"])))=>i.map(i=>d[i]);
import{L as a,S as Y,_ as K,C as re,f as Q,c as oe,T as ce,a as me,b as he,R as te,d as Z}from"./index-DbFwXZiH.js";class b{static get currencySelectLabel(){return a.tr("FormsFeature.inWhatCurrency")}static get formSettingsTitle(){return a.tr("FeatureFormSettings.title")}static get formNotFound(){return a.tr("FeatureFormSettings.formNotFound")}static get labelFormTitle(){return a.tr("FeatureFormSettings.labelFormTitle")}static get labelFormLink(){return a.tr("FeatureFormSettings.labelFormLink")}static get validationLinkRequired(){return a.tr("FeatureFormSettings.validationLinkRequired")}static get validationLinkInvalidChars(){return a.tr("FeatureFormSettings.validationLinkInvalidChars")}static get validationLinkInUse(){return a.tr("FeatureFormSettings.validationLinkInUse")}static get labelDeadlineDays(){return a.tr("FeatureFormSettings.labelDeadlineDays")}static get helperDeadlineDays(){return a.tr("FeatureFormSettings.helperDeadlineDays")}static get labelCardDesign(){return a.tr("FeatureFormSettings.labelCardDesign")}static get subtitleCardDesign(){return a.tr("FeatureFormSettings.subtitleCardDesign")}static get errorFixBeforeSave(){return a.tr("FeatureFormSettings.errorFixBeforeSave")}static get labelUseExternalForm(){return a.tr("FeatureFormSettings.labelUseExternalForm")}static get labelReservationLink(){return a.tr("FeatureFormSettings.labelReservationLink")}static get helperReservationLink(){return a.tr("FeatureFormSettings.helperReservationLink")}static get labelPrice(){return a.tr("FeatureFormSettings.labelPrice")}static get helperPrice(){return a.tr("FeatureFormSettings.helperPrice")}static get labelAdvancedSettings(){return a.tr("FeatureFormSettings.labelAdvancedSettings")}static get labelReserveButtonTitle(){return a.tr("FeatureFormSettings.labelReserveButtonTitle")}static get labelDeadlineDuration(){return a.tr("FeatureFormSettings.labelDeadlineDuration")}static get helperDeadlineDuration(){return a.tr("FeatureFormSettings.helperDeadlineDuration")}static get labelReminderEnabled(){return a.tr("FeatureFormSettings.labelReminderEnabled")}static get helperReminderEnabled(){return a.tr("FeatureFormSettings.helperReminderEnabled")}static get labelReminderInterval(){return a.tr("FeatureFormSettings.labelReminderInterval")}static get helperReminderInterval(){return a.tr("FeatureFormSettings.helperReminderInterval")}static get validationReminderInterval(){return a.tr("FeatureFormSettings.validationReminderInterval")}static get labelEnableReminders(){return a.tr("FeatureFormSettings.labelEnableReminders")}static get subtitleEnableReminders(){return a.tr("FeatureFormSettings.subtitleEnableReminders")}static get subtitleRemindersDisabled(){return a.tr("FeatureFormSettings.subtitleRemindersDisabled")}static get paymentDetailsTitle(){return a.tr("FeatureFormSettings.paymentDetailsTitle")}static get labelVariableSymbol(){return a.tr("FeatureFormSettings.labelVariableSymbol")}static get vsTypeRandom(){return a.tr("FeatureFormSettings.vsTypeRandom")}static get vsTypeSequence(){return a.tr("FeatureFormSettings.vsTypeSequence")}static get labelStartingNumber(){return a.tr("FeatureFormSettings.labelStartingNumber")}static get helperStartingNumber(){return a.tr("FeatureFormSettings.helperStartingNumber")}static get labelPaymentMessage(){return a.tr("FeatureFormSettings.labelPaymentMessage")}static get msgTypeNameSurname(){return a.tr("FeatureFormSettings.msgTypeNameSurname")}static get msgTypeNone(){return a.tr("FeatureFormSettings.msgTypeNone")}static get msgTypeOccasionTitle(){return a.tr("FeatureFormSettings.msgTypeOccasionTitle")}static get communicationToneTitle(){return a.tr("FeatureFormSettings.communicationToneTitle")}static get helperCommunicationTone(){return a.tr("FeatureFormSettings.helperCommunicationTone")}static get labelCommunicationTone(){return a.tr("FeatureFormSettings.labelCommunicationTone")}static get toneFormal(){return a.tr("FeatureFormSettings.toneFormal")}static get toneInformal(){return a.tr("FeatureFormSettings.toneInformal")}static get pickColor(){return a.tr("FeatureFormSettings.pickColor")}static get buttonGotIt(){return a.tr("FeatureFormSettings.buttonGotIt")}static get designPresets(){return a.tr("FeatureFormSettings.designPresets")}static get more(){return a.tr("FeatureFormSettings.more")}static get less(){return a.tr("FeatureFormSettings.less")}static get customColors(){return a.tr("FeatureFormSettings.customColors")}static get primaryColor(){return a.tr("FeatureFormSettings.primaryColor")}static get typography(){return a.tr("FeatureFormSettings.typography")}static get browseGoogleFonts(){return a.tr("FeatureFormSettings.browseGoogleFonts")}static get currentFont(){return a.tr("FeatureFormSettings.currentFont")}static get defaultFont(){return a.tr("FeatureFormSettings.defaultFont")}static get resetToDefault(){return a.tr("FeatureFormSettings.resetToDefault")}static get choosePopularFonts(){return a.tr("FeatureFormSettings.choosePopularFonts")}static get selectFromList(){return a.tr("FeatureFormSettings.selectFromList")}static get or(){return a.tr("FeatureFormSettings.or")}static get customFontNameLabel(){return a.tr("FeatureFormSettings.customFontNameLabel")}static get customFontHelper(){return a.tr("FeatureFormSettings.customFontHelper")}static get fontNotFound(){return a.tr("FeatureFormSettings.fontNotFound")}static get hexCodeLabel(){return a.tr("FeatureFormSettings.hexCodeLabel")}static get days(){return a.tr("FeatureFormSettings.days")}static get hours(){return a.tr("FeatureFormSettings.hours")}static get minutes(){return a.tr("FeatureFormSettings.minutes")}static get seconds(){return a.tr("FeatureFormSettings.seconds")}static get previewMode(){return a.tr("FeatureFormSettings.previewMode")}static get registrationStart(){return a.tr("FeatureFormSettings.registrationStart")}static get reservationUnavailable(){return a.tr("FeatureFormSettings.reservationUnavailable")}static get reservationUnavailableMessage(){return a.tr("FeatureFormSettings.reservationUnavailableMessage")}static get availability(){return a.tr("FeatureFormSettings.availability")}static get formClosedMessage(){return a.tr("FeatureFormSettings.formClosedMessage")}static scheduledWithTime(e){return a.tr("FeatureFormSettings.scheduledWithTime",{time:e})}static endedWithTime(e){return a.tr("FeatureFormSettings.endedWithTime",{time:e})}static get formOpenMessage(){return a.tr("FeatureFormSettings.formOpenMessage")}static get scheduleAndLimits(){return a.tr("FeatureFormSettings.scheduleAndLimits")}static get autoOpenHelp(){return a.tr("FeatureFormSettings.autoOpenHelp")}static get labelStartTime(){return a.tr("FeatureFormSettings.labelStartTime")}static get labelEndTime(){return a.tr("FeatureFormSettings.labelEndTime")}static get errorEndTimeBeforeStartTime(){return a.tr("FeatureFormSettings.errorEndTimeBeforeStartTime")}static get labelCountdownTimer(){return a.tr("FeatureFormSettings.labelCountdownTimer")}static get requiresStartTime(){return a.tr("FeatureFormSettings.requiresStartTime")}static get countdownDescription(){return a.tr("FeatureFormSettings.countdownDescription")}static get labelCountdownMessage(){return a.tr("FeatureFormSettings.labelCountdownMessage")}static get labelClosedMessage(){return a.tr("FeatureFormSettings.labelClosedMessage")}static get labelMessageContent(){return a.tr("FeatureFormSettings.labelMessageContent")}static get helperClosedMessage(){return a.tr("FeatureFormSettings.helperClosedMessage")}static get notSet(){return a.tr("FeatureFormSettings.notSet")}static get publicView(){return a.tr("FeatureFormSettings.publicView")}static get editorPreview(){return a.tr("FeatureFormSettings.editorPreview")}static get addTicket(){return a.tr("FormsFeature.addTicket")||"Add ticket"}static get ticket(){return a.tr("Ticket")||"Ticket"}static get buttonContinue(){return a.tr("Continue")}static get noOptionsForCurrency(){return a.tr("FormsFeature.noOptionsForCurrency")}static get clearSelection(){return a.tr("FormsFeature.clearSelection")}static get unavailable(){return a.tr("FormsFeature.unavailable")}static get inWhatCurrency(){return a.tr("FormsFeature.inWhatCurrency")}static get surchargeOnSite(){return a.tr("surchargeOnSite")}static get fieldName(){return a.tr("Name")}static get fieldSurname(){return a.tr("Surname")}static get fieldEmail(){return a.tr("Email")}static get fieldPhone(){return a.tr("Phone")}static get fieldCity(){return a.tr("City")}static get fieldBirthYear(){return a.tr("Birth year")}static get fieldNote(){return a.tr("Note")}static get fieldAddress(){return a.tr("Address")}static get fieldNationality(){return a.tr("Nationality")}static get fieldIdDocument(){return a.tr("Identification document")}static get fieldBirthDate(){return a.tr("Birth Date")}static birthDateError(e,i){return a.tr("You must be between {minAge} and {maxAge} years old.",{minAge:e,maxAge:i})}static birthDateWarning(e,i){return a.tr("Warning: Your age is not within the recommended range ({minAge}-{maxAge} years old).",{minAge:e,maxAge:i})}static get birthDateFormatHint(){return a.currentLocale==="cs"?"D. M. RRRR":"MM/DD/YYYY"}static get expiryDate(){return a.tr("Expiry Date")}static get expiryDatePastError(){return a.tr("Expiry date cannot be in the past.")}static get sexLabel(){return a.tr("I am")}static get maleLabel(){return a.tr("Male")}static get femaleLabel(){return a.tr("Female")}static get notSpecifiedLabel(){return a.tr("Not specified")}static get formsTitle(){return a.tr("FormsFeature.formsTitle")}static get createNewForm(){return a.tr("FormsFeature.createNewForm")}static noFormsForEventPrompt(e){return a.tr("FormsFeature.noFormsForEventPrompt",{createNew:e})}static get createCopy(){return a.tr("FormsFeature.createCopy")}static get statusOpen(){return a.tr("FormsFeature.statusOpen")}static get statusClosed(){return a.tr("FormsFeature.statusClosed")}static get responses(){return a.tr("FormsFeature.responses")}static get duplicateSuccess(){return a.tr("FormsFeature.duplicateSuccess")}static get deleteFormTitle(){return a.tr("FormsFeature.deleteFormTitle")}static get deleteFormContent(){return a.tr("FormsFeature.deleteFormContent")}static get tabForm(){return a.tr("FormsFeature.tabForm")}static get tabResponses(){return a.tr("FormsFeature.tabResponses")}static get defaultFormTitle(){return a.tr("FormsFeature.defaultFormTitle")}static get formAvailableAt(){return a.tr("FormsFeature.formAvailableAt")}static get formCreatedSuccess(){return a.tr("FormsFeature.formCreatedSuccess")}static get formTurnedOff(){return a.tr("FormsFeature.formTurnedOff")}static get editOffText(){return a.tr("FormsFeature.editOffText")}static get editContent(){return a.tr("FormsFeature.editContent")}static get dragToReorder(){return a.tr("FormsFeature.dragToReorder")}static get addFieldTitle(){return a.tr("FormsFeature.addFieldTitle")}static get personalInfo(){return a.tr("FormsFeature.personalInfo")}static get noFieldsAvailable(){return a.tr("FormsFeature.noFieldsAvailable")}static get addProductTypeTitle(){return a.tr("FormsFeature.addProductTypeTitle")}static get createNewProductTypeOption(){return a.tr("FormsFeature.createNewProductTypeOption")}static get untitledProductType(){return a.tr("FormsFeature.untitledProductType")}static get noProductTypesToAdd(){return a.tr("FormsFeature.noProductTypesToAdd")}static get newProductTypeDefaultName(){return a.tr("FormsFeature.newProductTypeDefaultName")}static get typeHere(){return a.tr("FormsFeature.typeHere")}static get phoneFormatHint(){return a.tr("FormsFeature.phoneFormatHint")}static get phoneFormatValidation(){return a.tr("FormsFeature.phoneFormatValidation")}static get noProductTypes(){return a.tr("FormsFeature.noProductTypes")}static get productTypes(){return a.tr("FormsFeature.productTypes")}static get seatSelection(){return a.tr("FormsFeature.seatSelection")}static get note(){return a.tr("FormsFeature.note")}static get labelMaxTicketsPerOrder(){return a.tr("FormsFeature.labelMaxTicketsPerOrder")}static get helperMaxTicketsPerOrder(){return a.tr("FormsFeature.helperMaxTicketsPerOrder")}static get validationMaxTicketsInvalid(){return a.tr("FormsFeature.validationMaxTicketsInvalid")}static get createFormTitle(){return a.tr("FormsFeature.createFormTitle")}static get createNewBlankForm(){return a.tr("FormsFeature.createNewBlankForm")}static get orCreateFromCopy(){return a.tr("FormsFeature.orCreateFromCopy")}static get searchFormsToCopy(){return a.tr("FormsFeature.searchFormsToCopy")}static get groupHappeningNow(){return a.tr("FormsFeature.groupHappeningNow")}static get groupUpcoming(){return a.tr("FormsFeature.groupUpcoming")}static get groupOther(){return a.tr("FormsFeature.groupOther")}static numberOfResponsesTooltip(e){return a.tr("FormsFeature.numberOfResponsesTooltip",[e])}static get fieldCannotBeEmpty(){return a.tr("fieldCannotBeEmpty")||"Field cannot be empty"}static get invalidFormat(){return a.tr("invalidFormat")||"Invalid format"}}class W{static get metaFields(){return"fields"}static get metaSecret(){return"secret"}static get metaForm(){return"form"}static get metaValues(){return"values"}static getTicketInputName(e,i,r){return`${e}_${i}_${r}`}static getAvailableCurrencies(e){const i=new Set;if((e.visibleFields||[]).forEach(n=>{(n.type==="product_type"||n.type==="ticket")&&console.log(`FormHelper: Inspecting field [${n.id}] type=${n.type}`,n),n.data&&n.data.product_type_data&&n.data.product_type_data.products&&n.data.product_type_data.products.forEach(o=>{o.currency&&i.add(o.currency),o.currencyCode&&i.add(o.currencyCode),o.currency_code&&i.add(o.currency_code)}),n.options&&n.options.forEach(o=>{o.currency&&i.add(o.currency),o.currencyCode&&i.add(o.currencyCode),o.currency_code&&i.add(o.currency_code)}),n.type==="ticket"&&(n.subFields||n.fields||n.data&&n.data.fields||[]).forEach(l=>{l.options&&l.options.forEach(c=>{c.currency&&i.add(c.currency),c.currencyCode&&i.add(c.currencyCode),c.currency_code&&i.add(c.currency_code)}),l.data&&l.data.product_type_data&&l.data.product_type_data.products&&l.data.product_type_data.products.forEach(c=>{c.currency&&i.add(c.currency),c.currencyCode&&i.add(c.currencyCode),c.currency_code&&i.add(c.currency_code)}),l.product_type_data&&l.product_type_data.products&&l.product_type_data.products.forEach(c=>{c.currency&&i.add(c.currency),c.currencyCode&&i.add(c.currencyCode),c.currency_code&&i.add(c.currency_code)})})}),i.size===0)return console.log("FormHelper: No currencies found, defaulting to CZK"),["CZK"];console.log("FormHelper: Found currencies:",Array.from(i));const t=Array.from(i);return t.includes("CZK")?["CZK",...t.filter(n=>n!=="CZK")]:t}static replaceSpotWithId(e){return e}static calculatePrice(e,i){let r=0,t=0,n=null;return e.ticket&&e.ticket.length>0&&e.ticket.forEach(o=>{let l=0;o.spotPrice&&(l+=parseFloat(o.spotPrice)),o.fields&&o.fields.forEach(s=>{s.price!==void 0&&(l+=parseFloat(s.price)),s.currency_code&&(n=s.currency_code)}),(o.fields&&o.fields.length>0||o.spot||l>0)&&t++,l>0&&(r+=l)}),{totalPrice:r,totalItems:t,currency:n}}}class O{static kMaxPhoneNumberLength=12;static formatInput(e){const i=e.value,r=e.selectionEnd;let t=O.cleanPhoneNumber(i),n=O.formatPhoneNumber(t);i.endsWith(" ")&&(t.length===3||t.length===6||t.length===9||t.startsWith("+")&&t.length===4)&&(n.endsWith(" ")||(n+=" ")),e.value=n;let o=0;for(let s=0;s<r&&s<i.length;s++)i[s]!==" "&&o++;let l=0,c=0;for(let s=0;s<n.length&&(n[s]!==" "&&c++,!(c>o));s++)l++;e.setSelectionRange(l,l)}static cleanPhoneNumber(e){let i=e.replace(/[^\d+]/g,"");return i.includes("+")&&(i.startsWith("+")?i="+"+i.substring(1).replace(/\+/g,""):i=i.replace(/\+/g,"")),i.replace(/\+/g,"").length>O.kMaxPhoneNumberLength&&(i.startsWith("+")?i=i.substring(0,O.kMaxPhoneNumberLength+1):i=i.substring(0,O.kMaxPhoneNumberLength)),i}static formatPhoneNumber(e){let i="";if(e.startsWith("+"))if(e.length>4){i=e.substring(0,4)+" "+e.substring(4);let r=i.substring(0,5),t=i.substring(5),n="";for(let o=0;o<t.length;o++)o>0&&o%3===0&&(n+=" "),n+=t[o];i=r+n}else i=e;else for(let r=0;r<e.length;r++)r>0&&r%3===0&&(i+=" "),i+=e[r];return i}}class ne{constructor(e){this.value=e}toString(){return this.value}}function q(v,...e){let i="";return v.forEach((r,t)=>{if(i+=r,t<e.length){const n=e[t];i+=le(n)}}),new ne(i)}function ie(v){return new ne(v)}function le(v){return v==null?"":v instanceof ne?v.value:Array.isArray(v)?v.map(le).join(""):typeof v=="number"||typeof v=="boolean"?String(v):String(v).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}class V{static create(e,i){const r=document.createElement("div"),t=e.isHidden,n=V.getInputType(e.type),o=e.id.toString(),l=b.typeHere,c=V.getAutocompleteValue(e.type);r.innerHTML=q`
            <div class="form-field-container" style="${t?"display:none":""}">
                <label class="form-field-label">
                    ${e.title||""}
                    ${e.isRequired?q`<span class="required-star"> *</span>`:""}
                </label>
                
                ${e.description?q`<div class="form-field-description">${ie(e.description)}</div>`:""}
                
                <div class="input-wrapper">
                    <input type="${n}" 
                           name="${o}" 
                           class="form-control" 
                           placeholder="${l}"
                           ${e.isRequired?"required":""}
                           ${c?q`autocomplete="${c}"`:""}
                    >
                    
                    ${e.type==="phone"?q`
                        <div class="phone-badges-container" style="display:none; margin-top:8px;"></div>
                    `:""}
                </div>
                
                <div class="form-field-error" style="display:none"></div>
            </div>
        `;const s=r.firstElementChild,u=s.querySelector("input");return e.type==="phone"&&V._attachPhoneLogic(u,s),s}static _attachPhoneLogic(e,i){e.value||(e.value="+420");const r=()=>O.formatInput(e);r(),e.addEventListener("input",r),e.pattern="^\\+\\d{3} \\d{3} \\d{3} \\d{3}$";const t=i.querySelector(".phone-badges-container");if(!t)return;const n=(c,s)=>{const u=document.createElement("div");return u.textContent=c,u.className="phone-badge-chip",u.style.cssText=`
                    display: inline-block;
                    padding: 4px 8px;
                    margin-right: 8px;
                    border-radius: 12px;
                    border: 1px solid var(--primary-color);
                    color: var(--primary-color);
                    background: rgba(var(--primary-color-rgb, 68, 101, 166), 0.1);
                    font-size: 12px;
                    font-weight: 500;
                    cursor: pointer;
                    user-select: none;
                `,u.onmousedown=d=>d.preventDefault(),u.onclick=()=>{let d=e.value,p=d;if(d.startsWith(s))p=d;else if(d.startsWith("+420"))p=s+d.substring(4);else if(d.startsWith("+421"))p=s+d.substring(4);else if(d.startsWith("+")){const m=d.indexOf(" ");m>0?p=s+d.substring(m):p=s+" "+d.replace(/^\+\d+\s*/,"")}else p=s+" "+d;e.value=O.cleanPhoneNumber(p),O.formatInput(e),e.focus()},u},o=n("CZ +420","+420"),l=n("SK +421","+421");t.appendChild(o),t.appendChild(l),e.addEventListener("focus",()=>{t.style.display="block"}),e.addEventListener("blur",()=>{setTimeout(()=>{t.style.display="none"},200)})}static getAutocompleteValue(e){switch(e){case"name":return"given-name";case"surname":return"family-name";case"email":return"email";case"phone":return"tel";case"city":return"address-level2";case"address":return"street-address";case"nationality":return"country";case"birth_year":return"bday-year";default:return null}}static getInputType(e){switch(e){case"email":return"email";case"phone":return"tel";case"birth_year":return"number";case"note":return"text";default:return"text"}}}class X{static create(e,i){const r=document.createElement("div");if(r.className="form-field-container radio-field",!e._hideLabel){const d=document.createElement("label");d.className="form-field-label",d.innerHTML=`${e.title||""}${e.isRequired?'<span class="required-star">*</span>':""}`,r.appendChild(d)}if(e.description){const d=document.createElement("div");d.className="form-field-description",d.innerHTML=e.description,r.appendChild(d)}const t=document.createElement("div");t.className="radio-options";const o=e.type!=="product_type"&&e.options&&e.options.some(d=>d.description&&d.description.trim().length>0),l=i&&i.isCardDesign||e.description&&e.description.trim().length>0||o;e.options&&e.options.forEach(d=>{const p=document.createElement("div");p.className="form-check",l&&p.classList.add("option-card");const m=document.createElement("input");m.type="radio",m.name=e.id,m.value=d.id!==void 0&&d.id!==null?d.id:d.title,m.id=`${e.id}_${d.id!==void 0&&d.id!==null?d.id:d.title}`,m.className="form-check-input";const f=d.currencyCode||d.currency||d.currency_code;f&&(m.setAttribute("data-currency",f),p.setAttribute("data-currency",f));const y=d.id!==void 0&&d.id!==null?d.id:d.title;e.value!==void 0&&e.value!==null&&String(y)===String(e.value)&&(m.checked=!0),l&&(p.classList.add("option-card"),p.onclick=_=>{_.target!==m&&_.target.tagName!=="LABEL"&&!_.target.closest("label")&&m.click()});const F=document.createElement("label");F.className="form-check-label",F.htmlFor=m.id;let g=`<span>${d.title||""}</span>`;if(d.price){const _=`${d.price}&nbsp;${f||""}`;g+=`<span class="option-price">+${_}</span>`}F.innerHTML=g;const C=document.createElement("div");C.appendChild(F);const S=d.data&&d.data.surcharge,k=i&&i.relatedFields?i.relatedFields.find(_=>_.type==="ticket"):null,P=k&&k.data&&k.data.show_surcharge_description!==void 0?k.data.show_surcharge_description:!0;if(d.description||S&&S.amount&&P){const _=document.createElement("span");_.className="option-description";let T="";S&&S.amount&&P&&(T+=`<span class="surcharge-info">+ ${S.amount}&nbsp;${S.currency||""} ${b.surchargeOnSite}</span>`,d.description&&(T+="<br>")),d.description&&(T+=d.description),_.innerHTML=T,C.appendChild(_)}p.appendChild(m),p.appendChild(C),t.appendChild(p)}),r.appendChild(t);const c=document.createElement("button");c.type="button",c.className="btn-clear-selection",c.innerText=b.clearSelection,r.addEventListener("change",d=>{if(d.target.name==e.id&&d.target.type==="radio"){const p=r.querySelector(`input[name="${e.id}"]:checked`);c.style.display=p?"inline-block":"none"}});const s=r.querySelector("input:checked");e.value!==void 0&&e.value!==null&&e.value!==""&&s&&(c.style.display="inline-block"),c.onclick=()=>{r.querySelectorAll(`input[type="radio"][name="${e.id}"]`).forEach(p=>p.checked=!1),c.style.display="none",r.setAttribute("name",e.id),r.name=e.id,r.value=null,r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0}))},r.appendChild(c);const u=document.createElement("div");return u.className="form-field-error",u.style.display="none",r.appendChild(u),r}}class se{static create(e,i){const r=document.createElement("div");r.className="form-field-container checkbox-field-container",e.isHidden&&(r.style.display="none");const n=e.type!=="product_type"&&e.options&&e.options.some(s=>s.description&&s.description.trim().length>0),o=i&&i.isCardDesign||e.description&&e.description.trim().length>0||n;if(!e._hideLabel){const s=document.createElement("label");s.className="form-field-label",s.innerHTML=`${e.title||""}${e.isRequired?'<span class="required-star">*</span>':""}`,r.appendChild(s)}if(e.description){const s=document.createElement("div");s.className="form-field-description",s.innerHTML=e.description,r.appendChild(s)}const l=document.createElement("div");if(l.className="checkbox-options",e.options&&e.options.forEach(s=>{const u=document.createElement("div");u.className="form-check";const d=document.createElement("input");d.type="checkbox",d.name=e.id,d.value=s.id!==void 0&&s.id!==null?s.id:s.title,d.id=`${e.id}_${s.id!==void 0&&s.id!==null?s.id:s.title}`,d.className="form-check-input";const p=s.currencyCode||s.currency||s.currency_code;p&&(d.setAttribute("data-currency",p),u.setAttribute("data-currency",p)),o&&(u.classList.add("option-card"),u.onclick=C=>{C.target!==d&&C.target.tagName!=="LABEL"&&!C.target.closest("label")&&d.click()});const m=document.createElement("label");m.className="form-check-label",m.htmlFor=d.id;let f=`<span>${s.title||""}</span>`;if(s.price){const C=`${s.price}&nbsp;${p||""}`;f+=`<span class="option-price">+${C}</span>`}m.innerHTML=f;const y=document.createElement("div");y.appendChild(m);const h=s.data&&s.data.surcharge,F=i&&i.relatedFields?i.relatedFields.find(C=>C.type==="ticket"):null,g=F&&F.data&&F.data.show_surcharge_description!==void 0?F.data.show_surcharge_description:!0;if(s.description||h&&h.amount&&g){const C=document.createElement("span");C.className="option-description";let S="";h&&h.amount&&g&&(S+=`<span class="surcharge-info">+ ${h.amount}&nbsp;${h.currency||""} ${b.surchargeOnSite}</span>`,s.description&&(S+="<br>")),s.description&&(S+=s.description),C.innerHTML=S,y.appendChild(C)}u.appendChild(d),u.appendChild(y),l.appendChild(u)}),r.appendChild(l),!e.options||e.options.length===0){const s=document.createElement("div");s.className="form-check single-checkbox";const u=document.createElement("input");u.type="checkbox",u.name=e.id.toString(),u.id=`field_${e.id}`,u.className="form-check-input",e.isRequired&&(u.required=!0);const d=document.createElement("label");if(d.htmlFor=u.id,d.className="form-check-label",d.textContent=e.title||"",e.isRequired&&(d.innerHTML+=' <span class="required-star">*</span>'),s.appendChild(u),s.appendChild(d),r.appendChild(s),e.description){const p=document.createElement("div");p.className="form-field-description",p.style.marginLeft="1.5em",p.innerHTML=e.description,r.appendChild(p)}}const c=document.createElement("div");return c.className="form-field-error",c.style.display="none",r.appendChild(c),r}}class ae{static get synchronizePayments(){return a.tr("FeatureOrders.synchronizePayments")}static get processing(){return a.tr("FeatureOrders.processing")}static get changeStateToPaid(){return a.tr("FeatureOrders.changeStateToPaid")}static get changeStateToPaidConfirmation(){return a.tr("FeatureOrders.changeStateToPaidConfirmation")}static get tickets(){return a.tr("FeatureOrders.tickets")}static get ticket(){return a.tr("FeatureOrders.ticket")}static get applications(){return a.tr("FeatureOrders.applications")}static get application(){return a.tr("FeatureOrders.application")}static get stornoFailed(){return a.tr("FeatureOrders.stornoFailed")}static get ordersTab(){return a.tr("FeatureOrders.ordersTab")}static get ordersHistoryTab(){return a.tr("FeatureOrders.ordersHistoryTab")}static get confirmTicket(){return a.tr("FeatureOrders.setAsUsed")}static get stornoCompletedText(){return a.tr("FeatureOrders.stornoCompletedItem")}static get gridId(){return a.tr("OrderGridColumns.id")}static get gridHide(){return a.tr("OrderGridColumns.hide")}static get gridTitle(){return a.tr("OrderGridColumns.title")}static get gridPrice(){return a.tr("OrderGridColumns.price")}static get gridProductType(){return a.tr("OrderGridColumns.productType")}static get gridOrder(){return a.tr("OrderGridColumns.order")}static get gridMax(){return a.tr("OrderGridColumns.max")}static get gridOrdered(){return a.tr("OrderGridColumns.ordered")}static get gridPaid(){return a.tr("OrderGridColumns.paid")}static get gridCurrency(){return a.tr("OrderGridColumns.currency")}static get gridDescription(){return a.tr("OrderGridColumns.description")}static get gridState(){return a.tr("OrderGridColumns.state")}static get gridCreated(){return a.tr("OrderGridColumns.created")}static get gridProducts(){return a.tr("OrderGridColumns.products")}static get gridNote(){return a.tr("OrderGridColumns.note")}static get gridHiddenNote(){return a.tr("OrderGridColumns.hiddenNote")}static get gridSpot(){return a.tr("OrderGridColumns.spot")}static get gridOrderSymbol(){return a.tr("OrderGridColumns.orderSymbol")}static get gridCustomer(){return a.tr("OrderGridColumns.customer")}static get gridEmail(){return a.tr("OrderGridColumns.email")}static get gridHistory(){return a.tr("OrderGridColumns.history")}static get gridTransactions(){return a.tr("OrderGridColumns.transactions")}static get gridAmount(){return a.tr("OrderGridColumns.amount")}static get gridReturned(){return a.tr("OrderGridColumns.returned")}static get gridVariableSymbol(){return a.tr("OrderGridColumns.variableSymbol")}static get gridDeadline(){return a.tr("OrderGridColumns.deadline")}static get gridForm(){return a.tr("OrderGridColumns.form")}static get gridReminderSent(){return a.tr("OrderGridColumns.reminderSent")}static get gridChangedAt(){return a.tr("OrderGridColumns.changedAt")}static get gridChangedBy(){return a.tr("OrderGridColumns.changedBy")}static get gridChanges(){return a.tr("OrderGridColumns.changes")}static get gridPaidOrSent(){return a.tr("OrderGridColumns.paidOrSent")}static get gridCancelled(){return a.tr("OrderGridColumns.cancelled")}static get gridUsedInForms(){return a.tr("OrderGridColumns.usedInForms")}}class fe{constructor(e={}){this.total=e.total||0,this.storno=e.storno||0,this.paidOrSent=e.paid_or_sent||0,this.ordered=e.ordered||0}}class w{static metaValue="value";static metaDescription="description";static metaOptionsName="name";static metaOptionsId="id";static metaOptionsPrice="price";static metaOptionsPrice="price";static metaCurrency="currency_code";static metaData="data";constructor(e={}){this.title=e[w.metaValue]||"",this.description=e[w.metaDescription]||null,this.name=e[w.metaOptionsName]||null,this.id=e[w.metaOptionsId]||null,this.price=e[w.metaOptionsPrice]||0,this.currency=e[w.metaCurrency],this.data=e[w.metaData]||null}}class R{static metaRequired="required";static metaHidden="hidden";static metaTitle="title";static metaDescription="description";static metaOptions="options";constructor(e={}){if(this.id=e.id,this.createdAt=e.created_at?new Date(e.created_at):null,this.title=e.title,this.description=e.description,this.type=e.type,this.isRequired=e.is_required,this.isHidden=e.is_hidden,this.isTicketField=e.is_ticket_field,this.formId=e.form,this.order=e.order,this.productTypeId=e.product_type,this.data=e.data||{},this.data&&this.data[R.metaFields]&&(this.subFields=this.data[R.metaFields].map(i=>new R(i)).sort((i,r)=>i.order-r.order)),this.options=[],this.data&&this.data[R.metaOptions]&&(this.options=this.data[R.metaOptions].map(i=>new w(i))),this.type==="product_type"&&this.data&&this.data.product_type_data&&this.data.product_type_data.products){const i=this.data.product_type_data.products;this.options=i.map(r=>new w({[w.metaValue]:r.title,[w.metaDescription]:r.description,[w.metaOptionsId]:r.id,[w.metaOptionsPrice]:r.price,[w.metaCurrency]:r.currency_code,[w.metaData]:r.data}))}else if(this.type==="product_type"&&e.product_type_data&&e.product_type_data.products){const i=e.product_type_data.products;this.options=i.map(r=>new w({[w.metaValue]:r.title,[w.metaDescription]:r.description,[w.metaOptionsId]:r.id,[w.metaOptionsPrice]:r.price,[w.metaCurrency]:r.currency_code,[w.metaData]:r.data}))}}}class D{static metaIsCardDesign="is_card_design";static metaIsReminderEnabled="is_reminder_enabled";static metaFields="fields";static metaVariableSymbol="variable_symbol";static metaPaymentMessage="payment_message";static metaType="type";static metaStartNumber="starting_number";static metaStartTime="start_time";static metaEndTime="end_time";static metaEnableCountdown="enable_countdown";static metaCountdownStyle="countdown_style";static metaCountdownTitle="countdown_title";static metaPrimaryColor="primary_color";static metaSecondaryColor="secondary_color";static metaFontFamily="font_family";static metaDesign="design";static metaSchedule="schedule";static metaCommunicationTone="communication_tone";constructor(e={}){this.id=e.id,this.createdAt=e.created_at?new Date(e.created_at):null,this.title=e.title,this.description=e.description,this.data=e.data||{},this.key=e.key,this.occasionId=e.occasion,this.blueprint=e.blueprint,this.type=e.type,this.bankAccountId=e.bank_account,this.deadlineDurationSeconds=e.deadline_duration_seconds,this.isOpen=e.is_open,this.accountNumber=e.account_number,this.secret=e.secret,this.header=e.header,this.headerOff=e.header_off,this.link=e.link,this.relatedFields=(e.fields||[]).map(t=>new R(t)).sort((t,n)=>t.order-n.order);const i=this.relatedFields.filter(t=>t.isTicketField===!0).sort((t,n)=>(t.order||0)-(n.order||0)),r=this.relatedFields.find(t=>t.type==="ticket");r&&(r.subFields||(r.subFields=[]),i.forEach(t=>{r.subFields.some(n=>n.id===t.id)||r.subFields.push(t)}),r.subFields.sort((t,n)=>(t.order||0)-(n.order||0))),this.stats=e.stats?new fe(e.stats):null,this.occasionFeatures=e.features||e.occasion&&e.occasion.features||[]}get _designData(){return this.data[D.metaDesign]||(this.data[D.metaDesign]={}),this.data[D.metaDesign]}get _scheduleData(){return this.data[D.metaSchedule]||(this.data[D.metaSchedule]={}),this.data[D.metaSchedule]}get visibleFields(){const e=new Set;return this.relatedFields.forEach(i=>{i.subFields&&i.subFields.length>0&&i.subFields.forEach(r=>e.add(r.id))}),this.relatedFields.filter(i=>!e.has(i.id)&&i.isTicketField!==!0)}get startTime(){const e=this._scheduleData[D.metaStartTime];return e?new Date(e):null}get endTime(){const e=this._scheduleData[D.metaEndTime];return e?new Date(e):null}get enableCountdown(){return this._scheduleData[D.metaEnableCountdown]===!0}get countdownTitle(){return this._scheduleData[D.metaCountdownTitle]}get isCardDesign(){return this._designData[D.metaIsCardDesign]===!0}get primaryColor(){return this._parseColor(this._designData[D.metaPrimaryColor])}get secondaryColor(){return this._parseColor(this._designData[D.metaSecondaryColor])}get fontFamily(){return this._designData[D.metaFontFamily]}get communicationTone(){return this.data[D.metaCommunicationTone]}_parseColor(e){if(!e)return null;if(typeof e=="number")return"#"+(e&16777215).toString(16).padStart(6,"0");if(typeof e=="string"){if(e.startsWith("#")&&e.length===9){const i=e.substring(1,3),r=e.substring(3,5),t=e.substring(5,7),n=e.substring(7,9);return`#${r}${t}${n}${i}`}return e.startsWith("#"),e}return null}}class H{static get metaSecret(){return"secret"}static get metaForm(){return"form"}static async getFormByLink(e){const i=Y.getClient();if(!i)throw new Error("Supabase client not initialized");const{data:r,error:t}=await i.rpc("get_form_by_link",{form_link:e});return t?(console.error("Error fetching form:",t),null):r&&r.code===200?new D(r.data):r&&r.code===400?new D(r.data):(console.warn("Form fetch returned non-200 code:",r?.code,r?.message),null)}static async getAllFormFields(e){const i=Y.getClient(),{data:r,error:t}=await i.rpc("get_all_form_fields",{form_link:e});return t?(console.error("Error fetching form fields:",t),[]):Array.isArray(r)?r.map(n=>new R(n)):[]}static async getBlueprint(e,i,r){const t=Y.getClient();if(!t)throw new Error("Supabase client not initialized");const{data:n,error:o}=await t.rpc("get_blueprint",{my_secret:e,form_key:i,blueprint_id:r});return o?(console.error("Error fetching blueprint:",o),null):n&&n.code===200?n.data:null}static async selectSpot(e,i,r,t){const n=Y.getClient();if(!n)throw new Error("Supabase client not initialized");const{data:o,error:l}=await n.rpc("select_spot",{form_key:e,secret_id:i,spot_id:r,selecting:t});if(l)throw console.error("Error selecting spot:",l),new Error(l.message);if(o&&o.code!==200)throw new Error(o.message||"Selection failed");return console.log("[DbForms] selectSpot success. Result data:",o.data),o.data}}class j{static _uniqueIndexCounter=0;static reset(){j._uniqueIndexCounter=0}static _prepareScopedDef(e){e.type==="product_type"&&(e.data&&e.data.product_type_data&&e.data.product_type_data.products&&(!e.options||e.options.length===0)&&(e.options=e.data.product_type_data.products.map(i=>({id:i.id,title:i.title,description:i.description,price:i.price,currency:i.currency,data:i.data}))),delete e._hideLabel)}static create(e,i,r){const t=document.createElement("div");t.className="form-field-container ticket-field",t.dataset.fieldId=e.id;const n=document.createElement("div");n.className="form-field-error",n.style.display="none",t.appendChild(n);let o=e.subFields;(!o||o.length===0)&&(o=e.fields||e.data&&e.data.fields||[]);const l=o.some(s=>s.type==="spot");let c=!1;if(r&&r.maxTickets>1&&(c=!0),!l&&!c){if(r&&r.state.tickets.length===0&&r.addTicket(),o.forEach((s,u)=>{const d={...s,id:W.getTicketInputName(e.id,0,s.id)};d.isRequired,j._prepareScopedDef(d);const p=G.createFormField(d,i);p.querySelectorAll("input, select, textarea").forEach(f=>{f.dataset.ticketId=e.id,f.dataset.index="0",f.dataset.subId=s.id}),t.appendChild(p)}),r){const s=()=>{if(r.state.tickets.length===0)return;const u=r.state.tickets[0];if(!u||!u.fields)return;t.querySelectorAll("input, select, textarea").forEach(p=>{const m=p.dataset.subId;if(!m)return;const f=u.fields.find(h=>h._subFieldId===m);let y="";f&&(y=f.value||f[f.type]||"",f.type==="product_type"&&f.product_type&&(y=f.product_type)),p.type==="radio"||p.type==="checkbox"?p.value===y||String(p.value)===String(y)?p.checked=!0:p.type:p.value!==y&&document.activeElement!==p&&(p.value=y)})};s(),r.addEventListener("state-changed",()=>{s()})}return t}else{if(e.title&&e.title!=="Tickets"&&e.title!==ae.tickets){const p=document.createElement("label");p.className="form-field-label",p.textContent=e.title,t.appendChild(p)}if(e.description){const p=document.createElement("div");p.className="form-field-description",p.innerHTML=e.description,t.appendChild(p)}const s=document.createElement("div");s.className="tickets-list",t.appendChild(s);const u=(p,m=null)=>{const f=document.createElement("div");f.className="ticket-item",m&&(f.dataset.seatId=m.id),f.dataset.index=p;let y=null;r&&r.state.tickets[p]&&(y=r.state.tickets[p]);const h=document.createElement("div");h.className="ticket-header";const F=document.createElement("span");F.style.fontWeight="bold",F.style.fontSize="1.3rem",m&&m.objectModel?F.textContent=m.objectModel.name||`${b.ticket} ${p+1}`:F.textContent=`${b.ticket} ${p+1}`,h.appendChild(F);const g=document.createElement("button");g.type="button",g.className="btn-remove-ticket",g.title=re.remove,g.innerHTML='<i class="material-icons">close</i>',g.onclick=async()=>{if(r){const S=Array.from(s.children).indexOf(f);r.removeTicket(S)}f.remove(),Array.from(s.children).forEach((S,k)=>{const P=S.querySelector(".ticket-header span");P&&P.textContent.startsWith(b.ticket)&&(P.textContent=`${b.ticket} ${k+1}`)}),t.selectedSeats&&m&&(t.selectedSeats=t.selectedSeats.filter(S=>S.id!==m.id))},h.appendChild(g),f.appendChild(h);const C=[...o].sort((S,k)=>S.type==="spot"?-1:1);if(C.length>0)C.forEach(S=>{const k={...S,id:W.getTicketInputName(e.id,p,S.id)};if(j._prepareScopedDef(k),y&&y.fields){const T=y.fields.find(I=>String(I._subFieldId)===String(S.id));if(T){const I=T[S.type];I!==void 0&&(k.value=I)}}if(S.isRequired&&(k.isRequired=!0),k.type==="spot"&&(k.isRequired=!0,m)){let T=0,I=b.currencyDefault||"CZK",x="";const E=m.productModel||(typeof m.product=="object"?m.product:null);E&&(x=E.title||"",E.price&&(T=E.price),E.currency?I=E.currency:i.currencyCode&&(I=i.currencyCode));const U=m.title||m.name||`Seat #${m.id}`,A=document.createElement("input");A.type="hidden",A.name=k.id,A.value=m.id,A.dataset.name=U,T>0&&(A.dataset.price=T),f.appendChild(A);const z=document.createElement("div");z.className="form-field-container";const ee=document.createElement("label");ee.className="form-field-label",ee.textContent=k.title||ae.gridSpot||"Spot",z.appendChild(ee);const B=document.createElement("div");B.className="form-control",B.style.backgroundColor="var(--bs-secondary-bg, #e9ecef)",B.style.opacity="1",B.style.display="flex",B.style.alignItems="center";const ue=T>0?`&nbsp;<span class="option-price">+${T} ${I}</span>`:"",pe=x?`${x} - `:"";B.innerHTML=`<span>${pe}${U}</span>${ue}`,z.appendChild(B),f.appendChild(z);return}const P=G.createFormField(k,i);P.querySelectorAll("input, select, textarea").forEach(T=>{T.dataset.ticketId=e.id,T.dataset.index=p,T.dataset.subId=S.id,k.isRequired&&(T.dataset.required="true")}),f.appendChild(P)});else{const S=document.createElement("div");S.style.fontStyle="italic",S.style.color="#777",S.textContent="Ticket details",f.appendChild(S)}f.updateFromSession=S=>{if(S!==void 0&&(p=S),!document.body.contains(f)&&!s.contains(f))return;const k=f.querySelectorAll("input, select, textarea");if(!r||!r.state.tickets[p])return;const P=r.state.tickets[p];k.forEach(_=>{const T=_.dataset.subId;if(!T)return;const I=P.fields?P.fields.find(E=>String(E._subFieldId)===String(T)):null;let x;if(I&&(x=I.value,x===void 0&&(I.product_type!==void 0?x=I.product_type:I.text!==void 0?x=I.text:x=Object.entries(I).find(([E,U])=>E!=="_subFieldId"&&E!=="currency_code"&&E!=="price")?.[1])),!(document.activeElement===_&&_.type!=="checkbox"&&_.type!=="radio"))if(_.type==="radio"){const E=x!==void 0&&String(_.value)===String(x);_.checked!==E&&(_.checked=E)}else if(_.type==="checkbox"){let E=!1;x!=null&&(x===!0||x==="true"?E=!0:E=String(x).split(" | ").some(z=>String(z)===String(_.value))),_.checked!==E&&(_.checked=E)}else{const E=x!==void 0?x:"";String(_.value)!==String(E)&&(_.value=E)}})},f.updateFromSession&&f.updateFromSession(p),s.appendChild(f)};if(l&&i.blueprint){t.selectedSeats=[];let p=t.querySelector("button.btn-primary.btn-blueprint-select");p||(p=document.createElement("button"),p.type="button",p.className="btn btn-primary btn-blueprint-select w-100 d-block",p.textContent=b.seatSelection||"Select Seats",t.appendChild(p)),p.onclick=()=>{K(async()=>{const{BlueprintSelector:m}=await import("./blueprint_selector-DPxokn65.js");return{BlueprintSelector:m}},__vite__mapDeps([0,1,2])).then(({BlueprintSelector:m})=>{new m().open(r,e,t.selectedSeats||[])})}}else{const p=document.createElement("button");p.type="button",p.className="btn btn-secondary btn-sm btn-add-ticket",p.textContent=`+ ${b.addTicket}`,p.onclick=()=>{r&&r.addTicket()},t.appendChild(p),r&&r.state.tickets.length===0?(r.addTicket(),u(0)):r&&r.state.tickets.length>0?r.state.tickets.forEach((m,f)=>{u(f)}):u(0)}const d=()=>{const p=r.state.tickets,m=Array.from(s.children);let f=!1;if(p.length!==m.length)f=!0,console.log(`[TicketFieldBuilder] Structure changed (length mismatch): ${p.length} vs ${m.length}`);else for(let h=0;h<p.length;h++){const F=p[h],g=m[h];if(F.spot){if(String(F.spot)!==String(g.dataset.seatId)){f=!0;break}}else if(g.dataset.seatId){f=!0;break}}const y=()=>{const h=t.querySelector(".btn-add-ticket");if(h){const F=r.maxTickets||999;r.state.tickets.length>=F?h.style.display="none":h.style.display="";const g=t.querySelectorAll(".btn-remove-ticket"),C=r.state.tickets.length;g.forEach(S=>{C<=1?S.style.display="none":S.style.display=""})}};if(!f){m.forEach((h,F)=>{h.updateFromSession?h.updateFromSession(F):console.warn(`[TicketFieldBuilder] Item ${F} missing updateFromSession!`)}),y();return}m.forEach(h=>{h.updateFromSession&&(h.updateFromSession=null),h.remove()}),s.innerHTML="",t.selectedSeats=[],r.state.tickets.forEach((h,F)=>{let g=null;h.spot&&(g={id:h.spot,title:h.spotName||`Spot ${h.spot}`,productModel:{price:h.spotPrice}},t.selectedSeats.push(g)),u(F,g)}),t.dispatchEvent(new Event("input",{bubbles:!0})),y()};if(r){d();const p=()=>d();r.addEventListener("state-changed",p),t.destroy=()=>{r.removeEventListener("state-changed",p)}}return t}}}class ge{static create(e,i){const r=document.createElement("div");r.className="form-field-container",e.isHidden&&(r.style.display="none");const t=document.createElement("label");if(t.className="form-field-label",t.textContent=b.fieldBirthDate,e.isRequired){const h=document.createElement("span");h.className="required-star",h.textContent=" *",t.appendChild(h)}if(r.appendChild(t),e.description){const h=document.createElement("div");h.className="form-field-description",h.innerHTML=e.description,r.appendChild(h)}const n=document.createElement("div");n.className="input-wrapper";const o=document.createElement("div");o.className="form-field-hint",o.textContent=b.birthDateFormatHint,n.appendChild(o);const l=document.createElement("input");l.type="text",l.name=e.id.toString(),l.className="form-control flatpickr-input",e.isRequired&&(l.required=!0),l.placeholder=b.typeHere,l.autocomplete="off",n.appendChild(l);const c=e.data?.min_year||0,s=e.data?.max_year||0,u=e.data?.is_hard===!0,d=e.data?.message;let p,m;if(c>0||s>0){let h=new Date;i.start&&(h=new Date(i.start));const F=g=>new Date(g.getFullYear(),g.getMonth(),g.getDate());if(s>0){const g=new Date(h.getFullYear()-s,h.getMonth(),h.getDate());p=F(g)}if(c>0){const g=new Date(h.getFullYear()-c,h.getMonth(),h.getDate());m=F(g)}}Q(l,{dateFormat:"Y-m-d",altInput:!0,altFormat:a.currentLocale==="cs"?"j. n. Y":"F j, Y",allowInput:!0,disableMobile:!0,locale:a.currentLocale==="cs"?oe.Czech:"default",parseDate:(h,F)=>{try{const g=Q.parseDate(h,F);if(g)return g}catch{}if(h&&typeof h=="string"){if(h.match(/^\d{1,2}\.\d{1,2}\.\d{4}$/)){const g=h.split(".");return new Date(`${g[2]}-${g[1]}-${g[0]}`)}if(h.match(/^\d{1,2}\. \d{1,2}\. \d{4}$/)){const g=h.replace(/ /g,"").split(".");return new Date(`${g[2]}-${g[1]}-${g[0]}`)}}},maxDate:m||"today",defaultDate:l.value||void 0}),r.appendChild(n);const f=document.createElement("div");f.className="form-field-message",f.style.display="none",f.style.marginTop="4px",f.style.fontSize="0.85em",r.appendChild(f);const y=document.createElement("div");if(y.className="form-field-error",y.style.display="none",r.appendChild(y),c>0||s>0){const h=()=>{const F=l.value;if(!F){f.style.display="none",u&&l.setCustomValidity("");return}const g=new Date(F),C=new Date(g.getFullYear(),g.getMonth(),g.getDate());let S=!1;if(p&&C<p&&(S=!0),m&&C>m&&(S=!0),S){let k="";if(d&&d.trim()!==""?k=d.replace("{minAge}",c).replace("{maxAge}",s):u?k=b.birthDateError(c,s):k=b.birthDateWarning(c,s),f.textContent=k,f.style.display="block",u)f.style.color="var(--red-color)",f.classList.add("form-field-error"),l.setCustomValidity(k),l.classList.add("invalid");else{const P=ce.warningColor;f.style.color=P,l.setCustomValidity(""),l.classList.remove("invalid"),l.style.borderColor=P}}else f.style.display="none",l.setCustomValidity(""),l.classList.remove("invalid"),l.style.borderColor=""};l.value&&h(),l.addEventListener("input",h),l.addEventListener("change",h)}else console.log("DateFieldBuilder: No age limits for field",e.id,e.title);return r}}class J{static get EXPIRY_SUFFIX(){return"_expiry"}}class ye{static create(e,i){console.log("IdDocumentFieldBuilder field data:",JSON.parse(JSON.stringify(e))),i.isCardDesign;const r=document.createElement("label");if(r.className="form-field-label",r.textContent=e.title,e.isRequired){const u=document.createElement("span");u.className="required-star",u.textContent=" *",r.appendChild(u)}const t=document.createElement("div");t.className="input-wrapper";const n=document.createElement("input");n.type="text",n.name=e.id.toString(),n.className="form-control",e.isRequired&&(n.required=!0),n.placeholder=b.typeHere,t.appendChild(n);const o=e.description?document.createElement("div"):null;o&&(o.className="form-field-description",o.innerHTML=e.description);const l=e.showExpiryDate||e.show_expiry_date||e.data?.showExpiryDate||e.data?.show_expiry_date;let c=null;if(l){const u=document.createElement("label");u.className="form-field-label";const d=e.expiryDateLabel||e.expiry_date_label||e.data?.expiryDateLabel||e.data?.expiry_date_label;u.textContent=d&&d.trim()!==""?d:b.expiryDate;const p=document.createElement("div");p.className="input-wrapper";const m=document.createElement("input");m.type="text",m.name=e.id.toString()+J.EXPIRY_SUFFIX,m.className="form-control flatpickr-input",e.isRequired&&(m.required=!0,m.dataset.required="true"),m.placeholder=a.currentLocale==="cs"?"D. M. RRRR":"YYYY-MM-DD",m.autocomplete="off",p.appendChild(m);const f=document.createElement("div");f.className="form-field-error",f.style.display="none";const y=h=>{if(!h){f.style.display="none",m.setCustomValidity(""),m.classList.remove("invalid");return}const F=new Date;if(F.setHours(0,0,0,0),h<F){const g=b.expiryDatePastError;f.textContent=g,f.style.display="block",m.setCustomValidity(g),m.classList.add("invalid")}else f.style.display="none",m.setCustomValidity(""),m.classList.remove("invalid")};Q(m,{dateFormat:"Y-m-d",altInput:!0,altFormat:a.currentLocale==="cs"?"j. n. Y":"F j, Y",allowInput:!0,minDate:"today",disableMobile:!0,locale:a.currentLocale==="cs"?oe.Czech:"default",parseDate:(h,F)=>{try{const g=Q.parseDate(h,F);if(g)return g}catch{}if(h&&typeof h=="string"){if(h.match(/^\d{1,2}\.\d{1,2}\.\d{4}$/)){const g=h.split(".");return new Date(`${g[2]}-${g[1]}-${g[0]}`)}if(h.match(/^\d{1,2}\. \d{1,2}\. \d{4}$/)){const g=h.replace(/ /g,"").split(".");return new Date(`${g[2]}-${g[1]}-${g[0]}`)}}},onChange:function(h){y(h[0])}}),c={label:u,wrapper:p,error:f}}const s=document.createElement("div");if(s.className="form-field-container",e.isHidden&&(s.style.display="none"),s.appendChild(r),o&&s.appendChild(o),s.appendChild(t),l&&c){const u=document.createElement("div");u.style.height="8px",s.appendChild(u),s.appendChild(c.label),s.appendChild(c.wrapper),s.appendChild(c.error)}return s}}class G{static createFormField(e,i,r){(!e.title||e.title.trim()==="")&&(e.title=G.getAutoTitle(e.type));let t=null;switch(e.type){case"text":case"name":case"surname":case"city":case"email":case"phone":case"birth_year":case"note":case"address":case"nationality":t=V.create(e,i);break;case"id_document":t=ye.create(e,i);break;case"sex":(!e.options||e.options.length===0)&&(e.options=[{id:"male",title:b.maleLabel},{id:"female",title:b.femaleLabel}],e.isRequired||e.options.unshift({id:"",title:b.notSpecifiedLabel})),t=X.create(e,i);break;case"select_one":t=X.create(e,i);break;case"select_many":t=se.create(e,i);break;case"product_type":e.data&&e.data.selection_type==="select_many"?t=se.create(e,i):t=X.create(e,i);break;case"spot":e.options&&e.options.length>0?t=X.create(e,i):t=V.create(e,i);break;case"ticket":t=j.create(e,i,r);break;case"birth_date":t=ge.create(e,i);break;default:console.warn(`Field type ${e.type} not supported yet.`),["text","string"].includes(e.type)&&(t=V.create(e,i));break}return t?G.isCardDesign(i,e)?t.dataset.skipCardWrapping==="true"?t:G.wrapInCard(e,t):t:document.createElement("div")}static getAutoTitle(e){switch(e){case"name":return b.fieldName;case"surname":return b.fieldSurname;case"email":return b.fieldEmail;case"phone":return b.fieldPhone;case"city":return b.fieldCity;case"birth_year":return b.fieldBirthYear;case"birth_date":return b.fieldBirthDate;case"note":return b.fieldNote;case"address":return b.fieldAddress;case"nationality":return b.fieldNationality;case"sex":return b.sexLabel;case"id_document":return b.fieldIdDocument;default:return""}}static isCardDesign(e,i){return!!(e.isCardDesign||i.description&&i.description.trim().length>0||["select_one","select_many","sex"].includes(i.type)&&i.options&&i.options.some(r=>r.description&&r.description.trim().length>0))}static wrapInCard(e,i){const r=document.createElement("div");return r.className="form-field-card",r.appendChild(i),r}}class Fe{static async sendOrder(e){const i=Y.getClient();if(!i)throw new Error("Supabase client not initialized");const{data:r,error:t}=await i.functions.invoke("send-ticket-order",{body:{orderDetails:e}});if(t)return console.error("Error sending order:",t),{success:!1,message:t.message};const n=r?.code||200;return n===200?{success:!0,data:r}:{success:!1,code:n,message:r?.message||"Unknown error",product:r?.product}}}class be{static updateMetaTags(e,i){if(!e)return;const r=e.title||"Festapp Event";let t="",n=null;if(e.header&&(t=this._extractTextFromHtml(e.header),n=this._extractImageFromHtml(e.header)),t||(t=e.description||"Rychl a jednoduch zaloen udlosti, prodej vstupenek a registrace."),e.startTime){const o=this._formatDate(e.startTime);o&&(t=`${o} - ${t}`)}document.title=`${r} - Vstupenky.online`,this._setMetaTag("name","description",t),this._setMetaTag("property","og:title",r),this._setMetaTag("property","og:description",t),i&&this._setMetaTag("property","og:url",i),n&&n.src&&(this._setMetaTag("property","og:image",n.src),n.width&&this._setMetaTag("property","og:image:width",n.width),n.height&&this._setMetaTag("property","og:image:height",n.height)),this._setMetaTag("property","twitter:title",r),this._setMetaTag("property","twitter:description",t),n&&n.src&&this._setMetaTag("property","twitter:image",n.src)}static _setMetaTag(e,i,r){let t=r?String(r).trim():"";const n=i.includes("image")||i.includes("url"),o=i.includes("width")||i.includes("height");!n&&!o&&t.length>300&&(t=t.substring(0,297)+"...");let l=document.querySelector(`meta[${e}="${i}"]`);l||(l=document.createElement("meta"),l.setAttribute(e,i),document.head.appendChild(l)),l.setAttribute("content",t)}static _extractTextFromHtml(e){return e&&new DOMParser().parseFromString(e,"text/html").body.textContent||""}static _extractImageFromHtml(e){if(!e)return null;const t=new DOMParser().parseFromString(e,"text/html").querySelector("img");return t?{src:t.src,width:t.getAttribute("width"),height:t.getAttribute("height")}:null}static _formatDate(e){return e?e.toLocaleDateString("cs-CZ",{day:"numeric",month:"numeric",year:"numeric"}):""}}class L{static timer=null;static render(e,i,r){L.timer&&(clearInterval(L.timer),L.timer=null);const t=document.createElement("div");t.className="countdown-widget";const n=i.countdownTitle||b.registrationStart,o=new Date(i.startTime);t.innerHTML=`
            <div class="countdown-title form-header">${n}</div>
            <div class="countdown-timer-row">
                <div class="time-block"><div class="time-value" id="cd-days">00</div><div class="time-label">${b.days}</div></div>
                <div class="time-block"><div class="time-value" id="cd-hours">00</div><div class="time-label">${b.hours}</div></div>
                <div class="time-block"><div class="time-value" id="cd-minutes">00</div><div class="time-label">${b.minutes}</div></div>
                <div class="time-block"><div class="time-value" id="cd-seconds">00</div><div class="time-label">${b.seconds}</div></div>
            </div>
        `,e.appendChild(t);const l=()=>{const s=o-new Date;if(s<=0){L.timer&&clearInterval(L.timer),r&&r();return}const u=Math.floor(s/(1e3*60*60*24)),d=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),p=Math.floor(s%(1e3*60*60)/(1e3*60)),m=Math.floor(s%(1e3*60)/1e3),f=C=>C.toString().padStart(2,"0"),y=t.querySelector("#cd-days"),h=t.querySelector("#cd-hours"),F=t.querySelector("#cd-minutes"),g=t.querySelector("#cd-seconds");y&&(y.textContent=f(u)),h&&(h.textContent=f(d)),F&&(F.textContent=f(p)),g&&(g.textContent=f(m))};l(),L.timer=setInterval(l,1e3)}static stop(){L.timer&&(clearInterval(L.timer),L.timer=null)}}class Se{static render(e,i){const r=document.createElement("div");r.className="not-available-widget";let t=i.headerOff;(!t||t.length===0)&&(t=b.reservationUnavailableMessage),r.innerHTML=`
            <i class="material-icons not-available-icon">event_busy</i>
            <div class="not-available-title">${b.reservationUnavailable}</div>
            <div class="not-available-message">${t}</div>
        `,e.appendChild(r)}}class ${static Status={OPEN:"OPEN",CLOSED:"CLOSED",BEFORE_START:"BEFORE_START"};static getStatus(e){const i=new Date;return e.startTime&&i<e.startTime?{status:$.Status.BEFORE_START,targetTime:e.startTime}:e.endTime&&i>e.endTime?{status:$.Status.CLOSED}:e.isOpen===!1?{status:$.Status.CLOSED}:{status:$.Status.OPEN}}static renderStatus(e,i,r,t={}){const{showPreview:n}=t,{status:o}=r;return n?!1:o===$.Status.BEFORE_START&&i.enableCountdown?(L.render(e,i,t.onReload),!0):o===$.Status.CLOSED||o===$.Status.BEFORE_START?(Se.render(e,i),!0):!1}}class ve{static render(e,i,r,t,n){e.innerHTML=q`
            <div class="form-wrapper ${r.isCardDesign?"is-card-design":""}">
                ${t?q`<div style="width:100%; color:black; background:orange; padding:8px; margin-bottom:16px; text-align:center; font-weight:bold; font-size:13px;">${b.previewMode}</div>`:""}
                
                ${r.header?q`<div class="form-header">${ie(this._optimizeLcp(r.header))}</div>`:""}
                
                ${r.description?q`<div class="form-description">${ie(r.description)}</div>`:""}

                <form id="dynamic-form" novalidate>
                    <!-- Fields will be appended here -->
                    <div id="fields-container"></div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-submit">${b.buttonContinue}</button>
                    </div>
                </form>
            </div>
        `;const o=e.querySelector("#dynamic-form"),l=o.querySelector("#fields-container");r.visibleFields.forEach(u=>{const d=G.createFormField(u,r,i);l.appendChild(d)}),o.onsubmit=u=>{u.preventDefault(),console.log("[FormRenderer] onsubmit triggered"),n.onSubmit&&n.onSubmit(o,r)};const c=o.querySelector(".btn-submit");c&&(c.onclick=u=>{u.preventDefault(),console.log("[FormRenderer] Submit Clicked (Manual Trigger)"),n.onSubmit&&n.onSubmit(o,r)});const s=u=>{n.onInput&&n.onInput(u,o,r)};o.addEventListener("input",s),o.addEventListener("change",s)}static _optimizeLcp(e){return e&&e.replace(/<img\s/,'<img fetchpriority="high" ')}}class N{static getPayload(e,i){const r=new FormData(e),t={fields:[],ticket:[],[H.metaSecret]:i.secret,[H.metaForm]:i.key},n=r.get("blueprint_secret");n&&(t.secret=n),i.relatedFields.forEach(l=>{if(l.type==="ticket")return;if(l.type==="id_document"){const u=r.get(l.id.toString());if(u&&u.trim()!==""){const d=r.get(l.id.toString()+J.EXPIRY_SUFFIX),p={id_document_number:u,id_document_expiry_date:d&&d.trim()!==""?d:null};let m={};m[l.id.toString()]=p,t.fields.push(m)}return}const s=r.getAll(l.id.toString()).filter(u=>u!=="");if(s.length>0){const u=s.length>1?s.join(" | "):s[0];let d={};if(d[l.id.toString()]=u,s.length===1){const p=N._findOption(l,s[0]);if(p){const m=p.currency||p.currencyCode||p.currency_code;m&&(d.currency_code=m)}}t.fields.push(d)}});const o=i.visibleFields.find(l=>l.type==="email");if(o){const l=t.fields.find(c=>c[o.id.toString()]!==void 0);l&&(t.email=l[o.id.toString()])}return t}static getTicketDataFromDom(e,i){const r=new FormData(e),t={};for(const[o,l]of r.entries()){if(l==="")continue;const c=o.match(/^(\d+)_(\d+)_(.+)$/);if(c){const s=c[1],u=parseInt(c[2],10),d=c[3];t[s]||(t[s]=[]),t[s][u]||(t[s][u]={}),t[s][u][d]||(t[s][u][d]=[]),t[s][u][d].push(l)}}const n=[];return i.visibleFields.forEach(o=>{if(o.type!=="ticket")return;const l=t[o.id.toString()];l&&Object.keys(l).forEach(c=>{const s=l[c],u={fields:[]};u._ticketIndex=c;let d=!1;(o.subFields||o.fields||o.data&&o.data.fields||[]).forEach(m=>{const f=s[m.id.toString()];if(!(!f||f.length===0))if(d=!0,m.type==="spot"){const y=f[0];u.spot=y;const h=N._findOption(m,y);if(h&&h.price!==void 0)u.spotPrice=parseFloat(h.price);else{const F=`${o.id}_${c}_${m.id}`,g=e.querySelector(`input[name="${F}"][value="${y}"]`)||e.querySelector(`input[name="${F}"]`);g&&(g.dataset.price&&(u.spotPrice=parseFloat(g.dataset.price)),g.dataset.name&&(u.spotName=g.dataset.name))}}else if(m.type==="product_type")f.forEach(y=>{const h=N._createSubFieldObj(m,y);if(h.price===void 0){const F=`${o.id}_${c}_${m.id}`,g=e.querySelector(`input[name="${F}"][value="${y}"]`)||e.querySelector(`option[value="${y}"]`);if(g&&g.dataset&&g.dataset.price){h.price=parseFloat(g.dataset.price);const C=g.dataset.currency||g.dataset.currencyCode;C&&(h.currency_code=C)}}u.fields.push(h)});else if((m.options||m.data&&m.data.options||[]).some(h=>h.price)&&f.length>1)f.forEach(h=>{u.fields.push(N._createSubFieldObj(m,h))});else{const h=f.length>1?f.join(" | "):f[0];if(f.length===1)u.fields.push(N._createSubFieldObj(m,h));else{let F={};F[m.type]=h,u.fields.push(F)}}}),d&&n.push(u)})}),n}static _findOption(e,i){let r=null;if(e.type==="product_type"&&e.data&&e.data.product_type_data&&e.data.product_type_data.products&&(r=e.data.product_type_data.products.find(t=>String(t.id)===String(i))),!r){const t=e.options||e.data&&e.data.options||[];t.length>0&&(r=t.find(n=>String(n.id)===String(i)))}return r}static _createSubFieldObj(e,i){let r={};r[e.type]=i,r._subFieldId=e.id;const t=N._findOption(e,i);if(t){(e.type==="product_type"||t.price!==void 0&&t.price!==null&&t.price!==""&&!isNaN(Number(t.price)))&&(r.product_type=i),t.price!==void 0&&(r.price=t.price);const o=t.currency||t.currencyCode||t.currency_code;o&&(r.currency_code=o)}return r}}class Ce{static get maxTicketsReached(){return a.tr("FeatureBlueprint.maxTicketsReached")||"Maximum number of tickets reached"}}class de{handle(e,i,r,t,n){throw new Error("Method 'handle' must be implemented.")}}class _e extends de{handle(e,i,r,t,n){const l=e.formModel.visibleFields.find(u=>String(u.id)===t);if(!l)return;let c=i.value;if(i.type==="checkbox"||l.type==="select_many"){const u=r.querySelectorAll(`input[name="${t}"]:checked`),d=Array.from(u).map(p=>p.value);c=d.length>1?d.join(" | "):d[0]||"",d.length===0&&(c=null)}c?e.state.fields.set(String(t),c):e.state.fields.delete(String(t)),e._syncPayloadFromState(),e._recalculate()}}class ke extends de{handle(e,i,r,t,n){const o=n&&n.isExpiry;let l=e.state.fields.get(String(t));!l||typeof l!="object"?l={id_document_number:typeof l=="string"?l:""}:l={...l},o?l.id_document_expiry_date=i.value:l.id_document_number=i.value,e.state.fields.set(String(t),l),e._syncPayloadFromState(),e._recalculate()}}class Ee{static _handlers={default:new _e,id_document:new ke};static getHandler(e,i,r){if(r.endsWith(J.EXPIRY_SUFFIX)){const n=r.replace(J.EXPIRY_SUFFIX,"");if(e.visibleFields.some(o=>String(o.id)===n))return{handler:this._handlers.id_document,fieldId:n,context:{isExpiry:!0}}}const t=e.visibleFields.find(n=>String(n.id)===r);return t&&t.type==="id_document"?{handler:this._handlers.id_document,fieldId:r,context:{isExpiry:!1}}:{handler:this._handlers.default,fieldId:r,context:{}}}}class we extends EventTarget{constructor(e){super(),this.formModel=e;const i=W.getAvailableCurrencies(e);if(this.state={totalPrice:0,totalItems:0,currency:i[0],availableCurrencies:i,validationErrors:{},tickets:[],fields:new Map},this.payload={fields:[],ticket:[],[H.metaSecret]:e.secret,[H.metaForm]:e.key},this.maxTickets=1,e&&e.relatedFields){const r=e.relatedFields.find(t=>t.type==="ticket");if(r&&r.data&&r.data.max_tickets){const t=parseInt(r.data.max_tickets,10);!isNaN(t)&&t>0&&(this.maxTickets=t)}}this.uiState=new Map,this._spotQueue=Promise.resolve(),this.spotModels=new Map}getComponentState(e){return this.uiState.get(e)}setComponentState(e,i){this.uiState.set(e,i)}refreshPayload(e){e&&(this.state.fields.size===0&&N.getPayload(e,this.formModel).fields.forEach(r=>{const t=Object.keys(r).find(n=>n!=="currency_code");t&&this.state.fields.set(t,r[t])}),this._syncPayloadFromState(),this._recalculate())}resetIncompatibleCurrencyFields(e){if(!e)return;let i=!1;this.state.tickets.forEach(r=>{if(r.fields){const t=[];r.fields.forEach((n,o)=>{let l=n.currency_code;if(!l){const c=this._getTicketSubDef(n._subFieldId);if(c){const s=n[c.type];let u=null;if(c.type==="product_type"&&c.data&&c.data.product_type_data&&(u=c.data.product_type_data.products.find(d=>String(d.id)===String(s))),u||(u=(c.options||c.data&&c.data.options||[]).find(p=>String(p.id)===String(s))),u){const d=u.currency||u.currencyCode||u.currency_code;d&&(l=d,n.currency_code=l)}}}l&&l!==e&&t.push(o)});for(let n=t.length-1;n>=0;n--)r.fields.splice(t[n],1),i=!0}});for(const[r,t]of this.state.fields.entries()){const n=this.formModel.visibleFields.find(o=>String(o.id)===String(r));if(n){const o=l=>{const c=n.options||n.data&&n.data.options||[];return n.type==="product_type"&&n.data&&n.data.product_type_data?n.data.product_type_data.products.find(s=>String(s.id)===String(l)):c.find(s=>String(s.id)===String(l))};if(!(typeof t=="string"&&t.includes(" | "))){const l=o(t);if(l){const c=l.currency||l.currencyCode||l.currency_code;c&&c!==e&&(this.state.fields.delete(r),i=!0)}}}}i&&(this._syncPayloadFromState(),this._recalculate(),this._emitStateChanged())}addTicket(e={}){if(this.state.tickets.length>=this.maxTickets)throw console.warn("[FormSession] Max tickets reached"),new Error(Ce.maxTicketsReached);const i={id:Date.now()+Math.random(),fields:[],...e};this.maxTickets>1&&this._getTicketSubDefs().forEach(t=>{if(i.fields.some(c=>String(c._subFieldId)===String(t.id)))return;let n=t.options||t.data&&t.data.options||[];t.type==="product_type"&&t.data&&t.data.product_type_data&&(n=t.data.product_type_data.products);const o=this.state.currency,l=n.filter(c=>{const s=c.currency||c.currencyCode||c.currency_code;return!s||s===o});if(l.length>0){const c=l[0],s=c.id!==void 0&&c.id!==null?c.id:c.title,u={[t.type]:s,_subFieldId:t.id,currency_code:o};c.price!==void 0&&(u.price=c.price),t.type==="product_type"&&(u.product_type=s),i.fields.push(u)}}),this.state.tickets.push(i),this._syncPayloadFromState(),this._recalculate(),this._emitStateChanged()}async removeTicket(e,i=!1){if(e>=0&&e<this.state.tickets.length){const r=this.state.tickets[e];if(!i&&r.spot)try{await H.selectSpot(this.formModel.key,this.formModel.secret,r.spot,!1)}catch(t){console.error("FormSession: Failed to deselect spot on removal",t)}this.state.tickets.splice(e,1),this._syncPayloadFromState(),this._recalculate(),this._emitStateChanged()}else console.error(`[FormSession] removeTicket failed: index ${e} out of bounds`)}updateTicket(e,i,r){if(e<0||e>=this.state.tickets.length)return;const t=this.state.tickets[e],n=t.fields.findIndex(o=>o._subFieldId===i||o._subFieldId===r?._subFieldId);if(n!==-1?r==null?t.fields.splice(n,1):t.fields[n]=r:r!=null&&t.fields.push(r),r&&(r.type==="spot"||r.spot!==void 0)&&(t.spot=r.value||r.spot,r.price!==void 0&&(t.spotPrice=r.price),t.spotPrice===void 0&&this.spotModels.has(String(t.spot)))){const o=this.spotModels.get(String(t.spot));o.product&&o.product.price?t.spotPrice=o.product.price:o.price&&(t.spotPrice=o.price)}this._syncPayloadFromState(),this._recalculate(),this._emitStateChanged()}async toggleSpot(e,i){const r=typeof e=="object"?e.id:e,t=typeof e=="object"?e:{id:r},n=c=>{if(c){if(!this.state.tickets.some(u=>String(u.spot)===String(r))){const u={spot:r,spotName:t.title||t.name||`Spot ${r}`},d=t.productModel||t.product;d&&d.price&&(u.spotPrice=d.price),this.addTicket(u)}}else{const s=this.state.tickets.findIndex(u=>String(u.spot)===String(r));s!==-1&&this.removeTicket(s,!0)}};(t.product||t.productModel||t.price)&&this.spotModels.set(String(r),t),n(i);const o=async()=>{try{const c=this.formModel.secret;return console.log(`[FormSession] Executing toggleSpot queue task. Spot: ${r}, Action: ${i?"Select":"Deselect"}, Secret: ${c}`),await H.selectSpot(this.formModel.key,c,r,i)}catch(c){throw console.error("FormSession: Spot selection failed, reverting state",c),n(!i),c}},l=this._spotQueue.then(()=>o());return this._spotQueue=l.catch(()=>{}),l}_syncPayloadFromState(){this.payload.ticket=this.state.tickets.map((e,i)=>{const r=e.fields||[],t=[];r.forEach(o=>{let l=!1,c=null,s=!1,u=null,d=null;c=this._getTicketSubDef(o._subFieldId),c&&c.type==="checkbox"&&(l=!0),Object.entries(o).forEach(([p,m])=>{p==="_subFieldId"||p==="currency_code"||l&&typeof m=="string"&&m.includes(" | ")&&(s=!0,u=m,d=p)}),s&&u?u.split(" | ").forEach(m=>{const f={...o};f[d]=m,f.product_type===u&&(f.product_type=m);try{const y=this._getTicketSubDef(o._subFieldId);if(y){let h=null;if(y.type==="product_type"&&y.data&&y.data.product_type_data&&(h=y.data.product_type_data.products.find(F=>String(F.id)===String(m))),h||(h=(y.options||y.data&&y.data.options||[]).find(g=>String(g.id)===String(m))),h&&h.price!==void 0&&(f.price=parseFloat(h.price)),h){const F=h.currency||h.currencyCode||h.currency_code;F&&(f.currency_code=F)}}}catch(y){console.warn("[FormSession] Failed to re-hydrate price for multi-select part:",m,y)}t.push(f)}):t.push(o)});const n={fields:t,_ticketIndex:i};if(e.spot&&(n.spot=e.spot),e.spotPrice&&(n.spotPrice=e.spotPrice),n.spot&&!n.spotPrice&&this.spotModels.has(String(n.spot))){const o=this.spotModels.get(String(n.spot));o.product&&o.product.price?n.spotPrice=o.product.price:o.price&&(n.spotPrice=o.price)}return e.spotName&&(n.spotName=e.spotName),n}),this.payload.fields=[];for(const[e,i]of this.state.fields.entries()){if(i==null||i==="")continue;const r=this.formModel.visibleFields.find(n=>String(n.id)===String(e));if(!r)continue;const t={[e]:i};if(typeof i=="string"&&!i.includes(" | ")){const o=(l=>{const c=r.options||r.data&&r.data.options||[];return r.type==="product_type"&&r.data&&r.data.product_type_data?r.data.product_type_data.products.find(s=>String(s.id)===String(l)):c.find(s=>String(s.id)===String(l))})(i);if(o){const l=o.currency||o.currencyCode||o.currency_code;l&&(t.currency_code=l)}}this.payload.fields.push(t)}}handleInput(e,i){if(!e.target)return;const r=e.target,t=r.name||r.getAttribute&&r.getAttribute("name");if(!t)return;if(r.dataset.ticketId&&r.dataset.index!==void 0&&r.dataset.subId){const o=r.dataset.ticketId,l=parseInt(r.dataset.index,10),c=r.dataset.subId;this._handleTicketInputRefactored(r,i,[null,o,l,c]);return}const n=t.match(/^(\d+)_(\d+)_(.+)$/);if(n)this._handleTicketInputRefactored(r,i,n);else{const{handler:o,fieldId:l,context:c}=Ee.getHandler(this.formModel,r,t);o?o.handle(this,r,i,l,c):console.warn(`[FormSession] No handler found for input ${t}`)}}_handleTicketInputRefactored(e,i,r){r[1];const t=typeof r[2]=="number"?r[2]:parseInt(r[2],10),n=r[3],o=this._getTicketSubDef(n);if(!o){console.warn(`[FormSession] subDef failed for subId ${n}`);return}let l=e.value,c=e.type;if(c==="checkbox"){const s=e.name;if(s){const u=i.querySelectorAll(`input[name="${s}"]:checked`),d=Array.from(u).map(p=>p.value);l=d.length>0?d.join(" | "):null}else e.checked||(l=null)}else c==="radio"&&(e.checked||(l=null));if(l!==null){const s=y=>{const h=o.options||o.data&&o.data.options||[];let F=null;return o.type==="product_type"&&o.data&&o.data.product_type_data&&(F=o.data.product_type_data.products.find(g=>String(g.id)===String(y))),F||(F=h.find(g=>String(g.id)===String(y))),F},u={[o.type]:l,_subFieldId:o.id};o.type==="product_type"&&(u.product_type=l);let d=0,p=null,m=!1;const f=String(l).split(" | ");if(f.forEach(y=>{const h=s(y);if(h){h.price!==void 0&&(d+=parseFloat(h.price),m=!0);const F=h.currency||h.currencyCode||h.currency_code;F&&(p=F)}}),m&&(u.price=d),p&&(u.currency_code=p),!m&&f.length===1&&e.dataset.price&&(u.price=parseFloat(e.dataset.price)),!p&&e.dataset.currency&&(u.currency_code=e.dataset.currency),e.tagName==="SELECT"&&e.options[e.selectedIndex]){const y=e.options[e.selectedIndex];!m&&y.dataset.price&&(u.price=parseFloat(y.dataset.price)),!p&&y.dataset.currency&&(u.currency_code=y.dataset.currency)}o.type,this.updateTicket(t,o.id,u)}else this.updateTicket(t,o.id,null)}initialize(e){const i=N.getTicketDataFromDom(e,this.formModel);i.length>0&&(this.state.tickets=i,console.log("FormSession: Hydrated tickets from DOM:",this.state.tickets)),this.refreshPayload(e)}_handleStandardInput_LEGACY(e,i,r){const t=this.formModel.visibleFields.find(c=>String(c.id)===r);if(!t)return;let n=e.value;if(e.type==="checkbox"||t.type==="select_many"){const c=i.querySelectorAll(`input[name="${r}"]:checked`),s=Array.from(c).map(u=>u.value);n=s.length>1?s.join(" | "):s[0]||""}const l=this.payload.fields.findIndex(c=>c[r]!==void 0);if(l!==-1&&this.payload.fields.splice(l,1),n){const c={[r]:n},s=u=>{const d=t.options||t.data&&t.data.options||[];return t.type==="product_type"&&t.data&&t.data.product_type_data?t.data.product_type_data.products.find(p=>String(p.id)===String(u)):d.find(p=>String(p.id)===String(u))};if(!n.includes(" | ")){const u=s(n);u&&u.currency&&(c.currency_code=u.currency)}this.payload.fields.push(c)}this._recalculate()}_recalculate(){const e=W.calculatePrice(this.payload,this.formModel);e.currency||(e.currency=this.state.currency),this.updateState(e)}_emitStateChanged(){this.dispatchEvent(new CustomEvent("state-changed",{detail:this.state}))}setCurrency(e){this.state.currency!==e&&(this.state.currency=e,this.resetIncompatibleCurrencyFields(e),this._syncPayloadFromState(),this._recalculate(),this._emitStateChanged())}updateState(e){(e.totalPrice!==this.state.totalPrice||e.totalItems!==this.state.totalItems||e.currency!==this.state.currency)&&(this.state={...this.state,...e},this.dispatchEvent(new CustomEvent("state-changed",{detail:this.state})))}setValidationErrors(e){this.state={...this.state,validationErrors:e},this.dispatchEvent(new CustomEvent("validation-changed",{detail:this.state.validationErrors}))}setIsReady(e){this.dispatchEvent(new CustomEvent("state-changed",{detail:this.state}))}_getTicketFieldDef(){let e=this.formModel.visibleFields.find(i=>i.type==="ticket");return!e&&this.formModel.relatedFields&&(e=this.formModel.relatedFields.find(i=>i.type==="ticket")),e}_getTicketSubDefs(){const e=this._getTicketFieldDef();return e?e.subFields||e.fields||e.data&&e.data.fields||[]:[]}_getTicketSubDef(e){return this._getTicketSubDefs().find(r=>String(r.id)===String(e))}get currentState(){return this.state}}class Te{constructor(e,i){this.session=e,this.container=i,this.element=null,this.isVisible=!1,this._onStateChange=this._onStateChange.bind(this),this.session.addEventListener("state-changed",this._onStateChange)}_onStateChange(e){const i=e.detail;this.render(i)}render(e=null){const{totalPrice:i,totalItems:r,currency:t}=e||this.session.currentState,o=!!this.session.formModel.blueprint;let l=!1;if(i<=0&&r<=0&&(l=!0),console.log(`[PriceWidget] Render: Price=${i} Items=${r} Hide=${l} Blueprint=${o} El=${!!this.element}`),l){this.element&&(this.element.remove(),this.element=null),this.updateSubmitButton(!1);return}if(this.updateSubmitButton(!0),!this.element){this.element=document.createElement("div"),this.element.id="floating-price-widget",this.element.className="floating-price-widget",document.body.appendChild(this.element);const s=this.session.formModel.primaryColor||"var(--primary-color)",u=this._resolveColor(s),d=me.isLight(u)?"black":"white";this.element.style.cssText=`
                position: fixed; /* Always fixed as requested */
                top: 16px;
                right: 16px;
                z-index: 2005; /* Above Blueprint Modal */
                
                background-color: ${s};
                color: ${d};
                padding: 12px 16px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.3);
                display: flex;
                align-items: center;
                font-family: var(--font-family-base);
                font-weight: 600 !important;
                font-size: 1.1rem;
                animation: fadeIn 0.3s ease-out;
                cursor: pointer;
            `,this.element.onclick=()=>{const p=document.querySelector('#dynamic-form button[type="submit"]');p&&p.scrollIntoView({behavior:"smooth"})}}this.element.innerHTML=`
            <span style="margin-right: 6px; font-weight: 600;">${r}x</span>
            <i class="material-icons" style="font-size: 24px; margin-right: 10px;">local_activity</i>
            <span style="font-weight: 600;">${i} ${t}</span>
        `}updateSubmitButton(e){const r=(this.container||document).querySelector("#dynamic-form")||document.getElementById("dynamic-form");if(!r)return;const t=r.querySelector('button[type="submit"]');this.session.formModel.visibleFields.some(o=>o.type==="ticket")&&t&&(e?(t.disabled=!1,t.classList.remove("disabled"),t.style.opacity="1",t.style.cursor="pointer"):(t.disabled=!0,t.classList.add("disabled"),t.style.opacity="0.5",t.style.cursor="not-allowed"))}destroy(){this.session.removeEventListener("state-changed",this._onStateChange),this.element&&this.element.remove()}_resolveColor(e){if(!e)return null;if(e.startsWith("var(--"))try{const i=e.match(/var\(([^)]+)\)/)[1];return getComputedStyle(document.documentElement).getPropertyValue(i).trim()||e}catch{return e}return e}}class xe{constructor(e,i){this.session=e,this.container=i,this.element=null,this._handleStateChange=this._onStateChange.bind(this),this.session.addEventListener("state-changed",this._handleStateChange),this.render()}render(){const{currency:e,availableCurrencies:i}=this.session.state;if(this.element&&(this.element.remove(),this.element=null),console.log("CurrencySelectorWidget: Available currencies:",i),!i||i.length<=1){console.log("CurrencySelectorWidget: Not enough currencies to show selector");return}this.element=document.createElement("div"),this.element.className="currency-selector-widget",this.element.style.cssText=`
            margin-bottom: 24px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        `;const r=document.createElement("div");r.className="currency-selector-title",r.textContent=b.currencySelectLabel,r.style.cssText=`
            font-size: 14px;
            color: var(--text-color, #000); /* Fallback to black for light theme */
            margin-bottom: 8px;
            opacity: 0.8;
            font-weight: 500;
        `,this.element.appendChild(r);const t=document.createElement("div");t.className="currency-btn-group",t.style.cssText=`
            display: inline-flex;
            background-color: var(--surface-color, rgba(255, 255, 255, 0.05)); 
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--divider-color, rgba(0, 0, 0, 0.1));
        `,i.forEach((c,s)=>{const u=document.createElement("button");u.type="button",u.className="btn currency-btn",u.textContent=c;const d=c===e;u.style.cssText=`
                border: none;
                padding: 10px 24px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                transition: background-color 0.2s, color 0.2s;
                min-width: 80px;
                background-color: transparent;
                color: var(--text-color, #000);
                opacity: 0.6;
                border-radius: 0; /* Explicitly no radius for segmented look */
                flex: 1; /* Stretch to fill */
            `,s>0&&(u.style.borderLeft="1px solid var(--divider-color, rgba(0, 0, 0, 0.1))"),d&&this._applySelectedStyle(u),u.onclick=()=>{this.session.setCurrency(c)},t.appendChild(u)}),this.element.appendChild(t);const n=this.session.formModel;let o=null;if(n&&n.visibleFields){const c=n.visibleFields.find(s=>s.type==="product_type"||s.type==="ticket");c&&(o=c.id)}let l=!1;if(o){let c=this.container.querySelector(`.form-field-container[data-field-id="${o}"]`);if(!c){const s=this.container.querySelector(`input[name="${o}"]`);s&&(c=s.closest(".form-field-container"))}c&&c.parentNode&&(c.parentNode.insertBefore(this.element,c),l=!0)}if(!l){const c=this.container.querySelector(".form-header")||this.container.querySelector("h1.form-title");if(c&&c.parentElement)c.nextSibling?c.parentElement.insertBefore(this.element,c.nextSibling):c.parentElement.appendChild(this.element);else{const s=this.container.querySelector(".form-wrapper");s?s.prepend(this.element):this.container.prepend(this.element)}}}_applySelectedStyle(e){e.style.backgroundColor="var(--primary-color, #6200EE)",e.style.color="#fff",e.style.opacity="1",e.classList.add("active")}_onStateChange(e){e.detail,this.element&&this.render()}destroy(){this.session.removeEventListener("state-changed",this._handleStateChange),this.element&&this.element.remove()}}class M{static handleInputValidation(e,i,r){if(!r)return;const t=e.target,n=t.name;if(!n)return;const o={...r.state.validationErrors};if(!!!o[n]&&!t.classList.contains("invalid"))return;const c=t.dataset.required==="true";let s=!0,u=null;if(t.type==="radio"||t.type==="checkbox"){if(t.type==="checkbox"&&c)s=t.checked,s||(u=b.fieldCannotBeEmpty);else if(t.type==="radio"&&c){const d=i.querySelectorAll(`input[name="${n}"]`);s=Array.from(d).some(p=>p.checked),s||(u=b.fieldCannotBeEmpty)}}else c&&(!t.value||t.value.trim()==="")&&(s=!1,u=b.fieldCannotBeEmpty),s&&t.value&&(t.checkValidity()||(t.validity.typeMismatch||t.validity.patternMismatch)&&(s=!1,u=b.invalidFormat));if(console.log(`[FormValidator] Input: ${n} Valid: ${s}`),s){o[n]&&(delete o[n],r.setValidationErrors(o)),t.classList.remove("invalid");const d=t.closest(".form-field-container");if(d){const p=d.querySelector(".form-field-error");p&&(p.style.display="none");const m=d.querySelector(".radio-options, .checkbox-options");m&&m.classList.remove("invalid")}}else{let d=u||t.validationMessage||b.fieldCannotBeEmpty;o[n]=d,r.setValidationErrors(o),t.classList.add("invalid");const p=t.closest(".form-field-container");if(p){const m=p.querySelector(".form-field-error");m&&(m.textContent=d,m.style.display="block");const f=p.querySelector(".radio-options, .checkbox-options");f&&f.classList.add("invalid")}}}static getTicketFieldValues(e,i){const r=[];return i.type==="spot"?(e.spot&&r.push(e.spot),r):(e.fields&&e.fields.forEach(t=>{Object.keys(t).forEach(n=>{if(n==="currency_code"||n==="price"||n==="_subFieldId")return;const o=t[n];let l=!1;t._subFieldId?String(t._subFieldId)===String(i.id)&&(l=!0):n===i.type&&(l=!0),l&&o!=null&&o!==""&&(String(o).includes(" | ")?r.push(...String(o).split(" | ")):r.push(o))})}),r)}static validateAndShowErrors(e,i,r){const t={},n=e.elements;for(let c=0;c<n.length;c++){const s=n[c];if(!(s.nodeName==="BUTTON"||s.type==="submit")&&!t[s.name]){if(s.dataset.required==="true"){let u=!0;if(s.type==="radio"){const d=e.querySelectorAll(`input[name="${s.name}"]`);u=Array.from(d).some(p=>p.checked)}else s.type==="checkbox"?u=s.checked:u=s.value&&s.value.trim()!=="";if(!u){t[s.name]=b.fieldCannotBeEmpty;continue}}s.validity&&!s.validity.valid&&(s.validity.valueMissing?t[s.name]=b.fieldCannotBeEmpty:s.validity.typeMismatch||s.validity.patternMismatch?s.type==="tel"?t[s.name]=b.phoneFormatValidation:t[s.name]=b.invalidFormat:t[s.name]=s.validationMessage)}}const o=r?r.payload:null,l=o?o.fields:[];if(i.visibleFields.forEach(c=>{if(c.type==="ticket"){const s=o&&o.ticket?o.ticket:[];let u=c.subFields;(!u||u.length===0)&&(u=c.fields||c.data&&c.data.fields||[]),s.forEach((d,p)=>{u.forEach(m=>{if((m.isRequired!==void 0?m.isRequired:m.is_required)&&!(M.getTicketFieldValues(d,m).length>0)){const g=d._ticketIndex!==void 0?d._ticketIndex:p,C=W.getTicketInputName(c.id,g,m.id);t[C]=b.fieldCannotBeEmpty}const y=m.maxOptions||m.data&&m.data.max_options;if(y&&y>0&&M.getTicketFieldValues(d,m).length>y){const g=d._ticketIndex!==void 0?d._ticketIndex:p,C=W.getTicketInputName(c.id,g,m.id);t[C]=(b.maxOptionsReached||"Maximum options: {0}").replace("{0}",y)}})}),c.isRequired&&(s.length>0||(t[c.id]=b.fieldCannotBeEmpty));return}if(!t[c.id]&&c.isRequired){let s=!1;if(o){const u=l.find(p=>p[c.id.toString()]!==void 0),d=u?u[c.id.toString()]:null;Array.isArray(d)?s=d.length>0:s=d!==null&&d!==""&&d!==void 0}s||(t[c.id]=b.fieldCannotBeEmpty)}}),r&&r.setValidationErrors(t),Object.keys(t).length>0){const c=Object.keys(t)[0];let s=e.elements[c];if(typeof RadioNodeList<"u"&&s instanceof RadioNodeList&&(s=s[0]),!s)try{s=e.querySelector(`[name="${c}"]`)}catch(u){console.warn(`[FormValidator] Selector error for ${c}`,u)}return s?((s.closest(".form-field-container")||s).scrollIntoView({behavior:"smooth",block:"center"}),s.focus&&s.focus({preventScroll:!0})):console.warn(`[FormValidator] Could not find element for error field: ${c}`),!1}return!0}static renderErrors(e,i){e.querySelectorAll(".form-field-error").forEach(n=>n.style.display="none"),e.querySelectorAll(".invalid").forEach(n=>n.classList.remove("invalid")),!(!i||Object.keys(i).length===0)&&Object.keys(i).forEach(n=>{const o=i[n];let l=e.querySelector(`[name="${n}"]`);if(!l){const c=e.querySelector("form");if(c&&c.elements[n]){let s=c.elements[n];typeof RadioNodeList<"u"&&s instanceof RadioNodeList&&(s=s[0]),l=s}}if(l||(l=e.querySelector(`[data-field-id="${n}"]`)),l){l.classList.add("invalid");const c=l.closest(".form-field-container");if(c){const s=c.querySelector(".form-field-error");s?(s.textContent=o,s.style.display="block"):console.error("[FormValidator] Error div not found in container",c);const u=c.querySelector(".radio-options, .checkbox-options");u&&u.classList.add("invalid")}else console.warn("[FormValidator] Field container not found for input",l)}else console.warn(`[FormValidator] Input not found for error field: ${n} in container`,e)})}}class De{static async submitOrder(e){try{const i=await Fe.sendOrder(e);let r={};i.success?r=i.data||{}:r={code:i.code,message:i.message,product:i.product};const t=r.code?String(r.code):i.success?"200":"0",n=parseInt(t.replace(/\D/g,""),10)||0;return r.code=n,{success:n===200,data:r}}catch(i){throw console.error("FormNetwork Submit Error:",i),i}}}class Ie extends he{constructor(e){super(e),this.currentPriceWidget=null,this.currentSession=null,this.currentLink=null,this.onBack=null,this._previewModulePromise=null}cleanup(){this.currentPriceWidget&&(this.currentPriceWidget.destroy(),this.currentPriceWidget=null),this.currentSession=null,this._previewModulePromise=null;const e=document.getElementById("floating-price-widget");e&&e.remove(),this._fabBtn&&(this._fabBtn.remove(),this._fabBtn=null),this.host&&this.host.querySelectorAll(".ticket-field").forEach(r=>{typeof r.destroy=="function"&&r.destroy()}),super.clear()}async init(e,i={}){if(j.reset(),this.currentLink===e&&this.host&&this.host.innerHTML.trim()!==""){console.log("FormPage already initialized for link (Persistent):",e);return}if(i.onBack&&(this.onBack=i.onBack),this.cleanup(),window.scrollTo(0,0),this.currentLink=e,this.onBack=this.onBack||(()=>window.history.back()),!this.host){console.error("FormPage: No host element!");return}this.host.innerHTML="",this.host.style.transform="translate(0)",this.host.style.display="block";const r=document.getElementById("app");r&&(r.style.display="none");try{const t=await H.getFormByLink(e);if(!t){this.renderError(b.formNotFound);return}this.applyTheme(t),be.updateMetaTags(t,window.location.href);const n=$.getStatus(t),s=!0&&new URLSearchParams(window.location.search).get("preview")==="true";if($.renderStatus(this.host,t,n,{showPreview:s,onReload:()=>this.init(e)}))return;this.renderForm(t,s),te.updateAppData({formLink:e}).then(()=>{te.canSeeReservations()&&this.renderEditButton(e)})}catch(t){console.error(t),this.renderError(t.message+`
`+t.stack)}}renderEditButton(e){if(this._fabBtn)return;const i=document.createElement("button");i.className="fab-edit",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 17l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm635-498-57-57 57 57Zm-58 58L462-200H368v-94l329-329 57 57Z"/></svg>',i.style.position="fixed",i.style.bottom="24px",i.style.right="24px",i.style.width="56px",i.style.height="56px",i.style.borderRadius="50%",i.style.backgroundColor="var(--fab-color, var(--primary-color, #000))",i.style.color="var(--fab-text-color, #fff)",i.style.border="none",i.style.boxShadow="0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)",i.style.cursor="pointer",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.zIndex="3000",i.onclick=()=>{let t=te.context?.occasion?.link;t||(t=e);const n=`/${t}/reservations`;Z.navigateExternal(n)},document.body.appendChild(i),this._fabBtn=i}renderLoading(){this.host.innerHTML=`<div class="loading-spinner">${re.loading}</div>`}renderError(e){this.host.innerHTML=`<div class="error-message">${e}</div>`}applyTheme(e){ce.applyThemeFromModel(e)}renderForm(e,i){const r=new we(e);this.currentSession=r,r.addEventListener("validation-changed",n=>{M.renderErrors(this.host,n.detail)}),this.currentPriceWidget=new Te(r,this.host),ve.render(this.host,r,e,i,{onSubmit:(n,o)=>this.validateAndSubmit(n,o),onInput:(n,o,l)=>{n.type==="input"&&M.handleInputValidation(n,o,r),n.target.name&&r.handleInput(n,o)}}),new xe(r,this.host),r.addEventListener("state-changed",n=>{const{currency:o,previousCurrency:l}=n.detail;this.host.querySelector("form")});let t=r.state.currency;r.addEventListener("state-changed",n=>{const{currency:o}=n.detail,l=this.host.querySelector("form");if(!l)return;const c=t!==o;t=o,l.querySelectorAll("input, select, textarea").forEach(d=>{if(d.dataset.ticketId||d.type==="submit"||d.type==="button"||d.type==="hidden"||!d.name)return;const p=r.state.fields.get(d.name);if(d.type==="radio"){const f=p!==void 0&&String(d.value)===String(p);d.checked!==f&&(d.checked=f)}else if(d.type==="checkbox"){let f=!1;p!==void 0&&(p===!0||p==="true"?f=!0:f=String(p).split(" | ").includes(d.value)),d.checked!==f&&(d.checked=f)}else{const f=p!==void 0?p:"";String(d.value)!==String(f)&&(d.value=f)}const m=d.closest(".form-field-container");if(m){const f=m.querySelector(".btn-clear-selection");if(f){const y=m.querySelector("input:checked");f.style.display=y?"inline-block":"none"}}}),l.querySelectorAll("[data-currency]").forEach(d=>{const p=d.getAttribute("data-currency");(d.classList.contains("form-check")||d.classList.contains("dropdown-item")||d.classList.contains("option-card"))&&(p&&p!==o?d.style.display="none":d.style.display="")}),c&&r.resetIncompatibleCurrencyFields(o)}),setTimeout(()=>{const n=this.host.querySelector("form");n&&(r.initialize(n),r.setIsReady(!0))},100),this.prefetchPreview()}prefetchPreview(){if(this._previewModulePromise)return;const e=()=>{this._previewModulePromise||(console.log("[FormPage] Prefetching OrderPreview..."),this._previewModulePromise=K(()=>import("./order_preview-BR2gVDHE.js"),__vite__mapDeps([3,1,2,4])))};window.requestIdleCallback?window.requestIdleCallback(e):setTimeout(e,2e3)}handleInputValidation(e,i){M.handleInputValidation(e,i,this.currentSession)}validateAndSubmit(e,i){M.validateAndShowErrors(e,i,this.currentSession)&&this.handlePreview(e,i)}calculateTotal(e,i){if(this.currentSession)return this.currentSession.state;const r=N.getPayload(e,i);return W.calculatePrice(r,i)}handlePreview(e,i){e.reportValidity()&&(this._previewModulePromise||(this._previewModulePromise=K(()=>import("./order_preview-BR2gVDHE.js"),__vite__mapDeps([3,1,2,4]))),this._previewModulePromise.then(({OrderPreview:r})=>{try{const t=this.calculateTotal(e,i),n=this.currentSession?this.currentSession.payload:null;r.show(e,i,t,o=>{this.submitOrder(e,i,o||document.body)},()=>{},n)}catch(t){console.error("[FormPage] OrderPreview.show crashed:",t)}}).catch(r=>{console.error("[FormPage] Failed to load OrderPreview module",r)}))}closePreview(){const e=document.getElementById("order-preview-overlay");e&&(e.classList.remove("visible"),setTimeout(()=>{e.remove()},300))}submitOrder(e,i,r){const t=document.getElementById("order-preview-overlay");t?(t.remove(),Z.goBackProgrammatically()):this.closePreview();const n=this.showFullScreenLoader(),o=this.currentSession?this.currentSession.payload:N.getPayload(e,i);De.submitOrder(o).then(l=>{n.remove(),document.body.style.overflow="",l.success&&(this.cleanup(),this.host&&(this.host.innerHTML="",this.renderForm(i,!1)),window.scrollTo(0,0)),this.showFullScreenResult(l.success,l.data,i)}).catch(l=>{console.error("Submit Error:",l),n.remove(),document.body.style.overflow="",this.showFullScreenResult(!1,{code:999},i)})}showFullScreenLoader(){const e=document.createElement("div");if(e.className="fullscreen-loader-overlay",e.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85); /* Dark background */
            backdrop-filter: blur(5px);
            z-index: 3000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: var(--font-family-base, sans-serif);
        `,e.innerHTML=`
            <div class="spinner"></div>
            <div style="margin-top: 24px; font-weight: 600; font-size: 1.1rem; color: #ffffff;">
                ${re.processing||"Processing..."}
            </div>
        `,document.body.appendChild(e),document.body.style.overflow="hidden",!document.getElementById("spinner-style")){const i=document.createElement("style");i.id="spinner-style",i.textContent=`
                .spinner {
                    border: 4px solid rgba(255,255,255,0.1); /* Light track for dark bg */
                    border-top: 4px solid var(--primary-color, #3498db);
                    border-radius: 50%;
                    width: 50px;
                    height: 50px;
                    animation: spin 1s linear infinite;
                }
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `,document.head.appendChild(i)}return e}showFullScreenResult(e,i,r){Z.pushOverlayState("order-result");const t=document.createElement("div");t.className="fullscreen-result-overlay",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="var(--background-color, #fff)",t.style.zIndex="3000",t.style.overflowY="auto",t.style.padding="20px",t.style.boxSizing="border-box",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",document.body.appendChild(t),document.body.style.overflow="hidden";const n=()=>{t.remove(),document.body.style.overflow="",e&&(this.cleanup(),this.host&&(this.host.innerHTML="",this.renderForm(r,!1)),window.scrollTo(0,0))},o=()=>{window.removeEventListener("popstate",o),n()};window.addEventListener("popstate",o,{once:!0}),K(async()=>{const{OrderResult:l}=await import("./order_result-C1RlXkgt.js");return{OrderResult:l}},__vite__mapDeps([5,1,2,4])).then(({OrderResult:l})=>{l.render(t,e,i,r,()=>{Z.goBackProgrammatically()})})}}const Le=Object.freeze(Object.defineProperty({__proto__:null,FormPage:Ie},Symbol.toStringTag,{value:"Module"}));export{H as D,N as F,ae as O,b as a,Le as f};
