import{C as W,L as N,D as H,_ as $}from"./index-D1jLIrbU.js";import{F as z}from"./form_page-DAgHuXwG.js";function U(g,t,e=2,s="cs-CZ"){if(g==null)return"";try{return new Intl.NumberFormat(s,{style:"currency",currency:t||"CZK",minimumFractionDigits:e,maximumFractionDigits:e}).format(g)}catch(n){return console.error("Error formatting price:",n),`${g} ${t}`}}const b={seatSize:60,maxScale:5,overscrollLimit:150,panMargin:24,snapAnimationDuration:300,colors:{lessContrastyBlack:"#444444"}},p={AVAILABLE:"available",SELECTED_BY_ME:"selected_by_me",SELECTED:"selected",ORDERED:"ordered",USED:"used",TAKEN:"taken",BLACK:"black",EMPTY:"empty"};class X{static get padding(){return 2.5}static get focusedPadding(){return .8}static getSeatColor(t){const e={darkGreen:"hsl(122, 50%, 30%)",blueColor:"hsl(262, 50%, 30%)",black26:"rgba(0, 0, 0, 0.26)",black87:"rgba(0, 0, 0, 0.87)",black12:"rgba(0, 0, 0, 0.12)",transparent:"rgba(0, 0, 0, 0)"};switch(t){case p.AVAILABLE:return e.darkGreen;case p.SELECTED_BY_ME:return e.darkGreen;case p.SELECTED:return e.black26;case p.BLACK:return e.black87;case p.USED:return e.blueColor;case p.ORDERED:return e.black12;case p.EMPTY:return e.transparent;default:return e.transparent}}}const F={get checkmark(){return'<svg viewBox="0 0 24 24" style="width:70%;height:70%;display:block;"><path d="M5 12 L9 16 L19 6" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" /></svg>'},get orderX(){const g=b.colors.lessContrastyBlack;return`<svg viewBox="0 0 24 24" style="width:70%;height:70%;display:block;">
            <line x1="3" y1="3" x2="21" y2="21" stroke="${g}" stroke-width="1.5" stroke-linecap="round" />
            <line x1="21" y1="3" x2="3" y2="21" stroke="${g}" stroke-width="1.5" stroke-linecap="round" />
        </svg>`}};class V{static applyStyle(t,e,s){const i=s/40,o=X.padding*1.8*i,a=X.focusedPadding*i,f=8*i,l=e.state||p.AVAILABLE;let S=X.getSeatColor(l),h="default",r=0,d=0,u="";switch(l){case p.AVAILABLE:case p.SELECTED:h="pointer",r=o,d=f;break;case p.SELECTED_BY_ME:h="pointer",r=a,d=f,u=F.checkmark;break;case p.ORDERED:r=o,d=f,u=F.orderX;break;case p.USED:case p.TAKEN:S=X.getSeatColor(p.USED),r=o,d=f;break;case p.BLACK:r=0,d=0;break}t.innerHTML="",t.className="blueprint-seat-visual-inner";const m=document.createElement("div");m.className="blueprint-seat-visual",m.style.width=`calc(100% - ${r*2}px)`,m.style.height=`calc(100% - ${r*2}px)`,m.style.margin=`${r}px`,m.style.backgroundColor=S,m.style.borderRadius=`${d}px`,m.style.cursor=h,u&&(m.innerHTML=u),t.appendChild(m)}}class G{static prepareBackgroundSvg(t){if(!t||!t.trim().startsWith("<svg"))return{svg:t,isSvg:!1};let e=t,s=0,n=0;try{const a=new DOMParser().parseFromString(e,"image/svg+xml").documentElement;if(a&&a.tagName.toLowerCase()==="svg"){const c=a.getAttribute("width"),f=a.getAttribute("height");if(c&&(s=parseFloat(c)),f&&(n=parseFloat(f)),(s===0||n===0)&&a.getAttribute("viewBox")){const l=a.getAttribute("viewBox").split(/[\s,]+/).map(parseFloat);l.length===4&&(s=l[2],n=l[3])}return a.classList.add("blueprint-bg-svg"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("preserveAspectRatio","xMinYMin slice"),!a.hasAttribute("viewBox")&&s>0&&n>0&&a.setAttribute("viewBox",`0 0 ${s} ${n}`),{svg:new XMLSerializer().serializeToString(a),isSvg:!0}}}catch(i){console.warn("SVG Parsing/Serialization error",i)}return{svg:t,isSvg:!0}}}class Z{static getContent(t,e){let s=t.product;const n=e.productsMap&&s?e.productsMap.get(String(s)):null,i=n?n.title:"",o=t.title||"",a=n?n.price:0,c=h=>{const r=h.data||{},d=r.name,u=r.surname,m=r.email,E=d&&d.trim().length>0,k=u&&u.trim().length>0;if(E||k){const C=[];return E&&C.push(d),k&&C.push(u),C.join(" ")}else if(m&&m.trim().length>0)return m;return""};if(t.order_product_ticket){const h=e.optMap?e.optMap.get(t.order_product_ticket):null;if(h){const r=e.ticketsMap?e.ticketsMap.get(h.ticket):null;if(r){let d="";if(e.data.order_product_ticket&&e.data.products){const _=e.data.order_product_ticket.filter(v=>v.ticket===r.id).map(v=>v.product).filter(v=>v!==s).map(v=>e.productsMap.get(v)?.title).filter(Boolean);_.length>0&&(d=_.join(`
`))}const u=e.ordersMap?e.ordersMap.get(h.order):null;let m="";if(u){const L=c(u),x=u.data&&u.data.note?`
${u.data.note}`:"";m=`
${L}${x}`}const E=r.note&&r.note.trim().length>0?`
${r.note}`:"",k=r.ticket_symbol||"",C=W.itemSingular||"Item";let T=`${i} ${o}
${C} ${k}${E}`;return d&&(T+=`
${d}`),m&&(T+=`${m}`),T}}}const f=W.price||"Price",l=n?.currency_code||"CZK",S=U(a,l,0,N.currentLocale);return i&&o?`${i} ${o}
${f}: ${S}`:i?`${i}
${f}: ${S}`:`${o}
${f}: ${S}`}}class K{static prepare(t){if(!t)return null;const e={...t,meta:{productsMap:new Map,ticketsMap:new Map,ordersMap:new Map,optMap:new Map,productToOptMap:new Map,spotsMap:new Map,cols:0,rows:0,seatSize:b.seatSize,contentWidth:0,contentHeight:0}};return t.products&&t.products.forEach(s=>e.meta.productsMap.set(String(s.id),s)),t.tickets&&t.tickets.forEach(s=>e.meta.ticketsMap.set(String(s.id),s)),t.orders&&t.orders.forEach(s=>e.meta.ordersMap.set(String(s.id),s)),t.order_product_ticket&&t.order_product_ticket.forEach(s=>{const n=String(s.id);e.meta.optMap.set(n,s),s.product&&e.meta.productToOptMap.set(String(s.product),s)}),t.spots&&t.spots.forEach(s=>e.meta.spotsMap.set(String(s.id),s)),t.objects&&t.objects.forEach(s=>{const n=e.meta.spotsMap.get(String(s.id));if(n){if(s.title||(s.title=n.title),n.product?(s.product=n.product,s.productModel=e.meta.productsMap.get(String(n.product))):n.spot_product&&(s.product=n.spot_product,s.productModel=e.meta.productsMap.get(String(n.spot_product))),!s.order_product_ticket){if(n.order_product_ticket)s.order_product_ticket=n.order_product_ticket;else if(s.product){const i=e.meta.productToOptMap.get(String(s.product));i&&(s.order_product_ticket=i.id,s.state=p.ORDERED)}}n.state&&(s.state=n.state)}}),t.configuration&&t.configuration.dimensions?(e.meta.cols=t.configuration.dimensions.width,e.meta.rows=t.configuration.dimensions.height):t.objects&&t.objects.forEach(s=>{s.x!==void 0&&s.x+1>e.meta.cols&&(e.meta.cols=s.x+1),s.y!==void 0&&s.y+1>e.meta.rows&&(e.meta.rows=s.y+1)}),e.meta.contentWidth=e.meta.cols*e.meta.seatSize,e.meta.contentHeight=e.meta.rows*e.meta.seatSize,e}}class q{constructor(){this.state={x:0,y:0,scale:1},this.dims={viewportW:0,viewportH:0,contentW:100,contentH:100}}updateDimensions(t,e,s,n){this.dims.viewportW=t,this.dims.viewportH=e,this.dims.contentW=s||100,this.dims.contentH=n||100}setState(t,e,s){this.state={x:t,y:e,scale:s}}getState(){return{...this.state}}getFitScale(){const{viewportW:t,viewportH:e,contentW:s,contentH:n}=this.dims;return!s||!n||!t||!e?1:Math.min(t/s,e/n)*.95}fitToScreen(){if(!this.dims.contentW||!this.dims.contentH)return;const{viewportW:t,viewportH:e,contentW:s,contentH:n}=this.dims,i=this.getFitScale(),o=s*i,a=n*i,c=(t-o)/2,f=(e-a)/2;return this.state={x:c,y:f,scale:i},this.state}onInteractionUpdate(t,e,s,n,i,o,a=!0){const{contentW:c,contentH:f}=this.dims;let l=this.state.scale*s;const S=this.getFitScale(),h=S,r=S*b.maxScale;l<h&&(l=h),l>r&&(l=r);const d=l/this.state.scale,u=n-o.left,m=i-o.top,E=this.state.x,k=this.state.y,C=E+t,T=k+e,L=u-(u-C)*d,x=m-(m-T)*d,{viewportW:_,viewportH:v}=this.dims,P=c*l,O=f*l,I=b.panMargin;let D,Y,B,A;if(P<_){const y=(_-P)/2;D=y,Y=y}else D=_-P-I,Y=I;if(O<v){const y=(v-O)/2;B=y,A=y}else B=v-O-I,A=I;const R=l<=S*1.001;let M,w;if(a&&!R){const y=b.overscrollLimit;M=this._getRubberBandedVal(L,D,Y,y),w=this._getRubberBandedVal(x,B,A,y)}else M=L,M<D&&(M=D),M>Y&&(M=Y),w=x,w<B&&(w=B),w>A&&(w=A);return this.state={x:M,y:w,scale:l},this.state}getConstrainedState(){const{viewportW:t,viewportH:e,contentW:s,contentH:n}=this.dims,i=this.getFitScale();let o=this.state.scale;const a=i*b.maxScale;o<i*.999&&(o=i),o>a&&(o=a);const c=s*o,f=n*o,l=b.panMargin;let S,h,r,d;if(c<t){const E=(t-c)/2;S=E,h=E}else S=t-c-l,h=l;if(f<e){const E=(e-f)/2;r=E,d=E}else r=e-f-l,d=l;let u=this.state.x,m=this.state.y;return u<S&&(u=S),u>h&&(u=h),m<r&&(m=r),m>d&&(m=d),{x:u,y:m,scale:o}}shouldSnapBack(){const t=this.getConstrainedState();return Math.abs(t.x-this.state.x)>.5||Math.abs(t.y-this.state.y)>.5||Math.abs(t.scale-this.state.scale)>.001}_getTouchingAxis(){const{viewportW:t,viewportH:e,contentW:s,contentH:n}=this.dims,i=t/s,o=e/n;return Math.abs(i-o)<.001?"both":i<o?"x":"y"}_getRubberBandedVal(t,e,s,n){if(t>=e&&t<=s)return t;if(t<e){const i=e-t;return e-n*(1-Math.exp(-i/(n*1.5)))}else{const i=t-s;return s+n*(1-Math.exp(-i/(n*1.5)))}}}class J{constructor(t,e){this.container=t,this.callbacks=e||{},this.state={pressed:!1,lastCount:0,lastX:0,lastY:0,lastDist:0,lastCx:0,lastCy:0,isTapCandidate:!1,touchStartX:0,touchStartY:0,mousePanning:!1,mouseLastX:0,mouseLastY:0},this._bindMethods(),this.attachEvents()}_bindMethods(){this._boundOnMouseMove=this.onMouseMove.bind(this),this._boundOnMouseUp=this.onMouseUp.bind(this),this._boundOnTouchStart=this.onTouchStart.bind(this),this._boundOnTouchMove=this.onTouchMove.bind(this),this._boundOnTouchEnd=this.onTouchEnd.bind(this),this._boundOnWheel=this.onWheel.bind(this),this._boundOnGesture=t=>t.preventDefault()}attachEvents(){this.container.onmousedown=t=>this.onMouseDown(t),this.container.onwheel=this._boundOnWheel,window.addEventListener("mousemove",this._boundOnMouseMove),window.addEventListener("mouseup",this._boundOnMouseUp),this.container.addEventListener("touchstart",this._boundOnTouchStart,{passive:!1}),window.addEventListener("touchmove",this._boundOnTouchMove,{passive:!1}),window.addEventListener("touchend",this._boundOnTouchEnd),document.addEventListener("gesturestart",this._boundOnGesture),document.addEventListener("gesturechange",this._boundOnGesture),document.addEventListener("gestureend",this._boundOnGesture)}destroy(){window.removeEventListener("mousemove",this._boundOnMouseMove),window.removeEventListener("mouseup",this._boundOnMouseUp),this.container&&(this.container.removeEventListener("touchstart",this._boundOnTouchStart),this.container.onmousedown=null,this.container.onwheel=null),window.removeEventListener("touchmove",this._boundOnTouchMove),window.removeEventListener("touchend",this._boundOnTouchEnd),document.removeEventListener("gesturestart",this._boundOnGesture),document.removeEventListener("gesturechange",this._boundOnGesture),document.removeEventListener("gestureend",this._boundOnGesture)}onMouseDown(t){this.callbacks.onInteractionStart&&this.callbacks.onInteractionStart(),t.preventDefault(),this.state.mouseLastX=t.clientX,this.state.mouseLastY=t.clientY,this.state.mousePanning=!0,this.container.style.cursor="grabbing"}onMouseMove(t){if(!this.state.mousePanning)return;t.preventDefault();const e=t.clientX-this.state.mouseLastX,s=t.clientY-this.state.mouseLastY;this.state.mouseLastX=t.clientX,this.state.mouseLastY=t.clientY,this.callbacks.onPan&&this.callbacks.onPan(e,s,t.clientX,t.clientY)}onMouseUp(t){this.state.mousePanning&&(this.state.mousePanning=!1,this.container.style.cursor="default",this.callbacks.onInteractionEnd&&this.callbacks.onInteractionEnd())}onWheel(t){t.preventDefault(),this.callbacks.onInteractionStart&&this.callbacks.onInteractionStart();const s=Math.exp(-t.deltaY*.0015);this.callbacks.onZoom&&this.callbacks.onZoom(s,t.clientX,t.clientY)}onTouchStart(t){t.cancelable&&t.preventDefault(),this.callbacks.onInteractionStart&&this.callbacks.onInteractionStart(),t.touches.length===1?(this.state.isTapCandidate=!0,this.state.touchStartX=t.touches[0].clientX,this.state.touchStartY=t.touches[0].clientY):this.state.isTapCandidate=!1,this.state.lastCount=0}onTouchMove(t){if(t.cancelable&&t.preventDefault(),this.state.isTapCandidate){const n=t.touches[0];Math.hypot(n.clientX-this.state.touchStartX,n.clientY-this.state.touchStartY)>10&&(this.state.isTapCandidate=!1)}const e=t.touches,s=e.length;if(s===1){const n=e[0].clientX,i=e[0].clientY;if(this.state.lastCount!==1){this.state.lastX=n,this.state.lastY=i,this.state.lastCount=1;return}const o=n-this.state.lastX,a=i-this.state.lastY;this.state.lastX=n,this.state.lastY=i,this.callbacks.onPan&&this.callbacks.onPan(o,a,n,i)}else if(s===2){const n=e[0],i=e[1],o=Math.hypot(n.clientX-i.clientX,n.clientY-i.clientY),a=(n.clientX+i.clientX)/2,c=(n.clientY+i.clientY)/2;if(this.state.lastCount!==2){this.state.lastDist=o,this.state.lastCx=a,this.state.lastCy=c,this.state.lastCount=2;return}const f=a-this.state.lastCx,l=c-this.state.lastCy,S=this.state.lastDist<1?1:this.state.lastDist,h=o/S;this.state.lastDist=o,this.state.lastCx=a,this.state.lastCy=c,this.callbacks.onPinch&&this.callbacks.onPinch(f,l,h,a,c)}else this.state.lastCount=0}onTouchEnd(t){t.touches.length===0&&this.state.isTapCandidate&&this.callbacks.onTap&&this.callbacks.onTap(this.state.touchStartX,this.state.touchStartY),t.touches.length===0?(this.state.lastCount=0,this.callbacks.onInteractionEnd&&this.callbacks.onInteractionEnd()):this.state.lastCount=0,this.state.isTapCandidate=!1}}class Q{constructor(t){this.container=t,this.state={panning:!1,start:{x:0,y:0},scalingMode:"min"},this.controller=new q,this.gestureController=null,this.seatSize=b.seatSize,this.data=null,this.onSeatClick=null}setScalingMode(t){this.state.scalingMode=t,this.container.innerHTML="",this.container.classList.add("blueprint-renderer-container"),this.transformContainer=document.createElement("div"),this.transformContainer.className="blueprint-transform-container",this.container.appendChild(this.transformContainer),this.contentWidth&&(this.transformContainer.style.width=this.contentWidth+"px",this.transformContainer.style.height=this.contentHeight+"px"),this.renderBackground(),this.renderSeats(),this.fitToScreen(),this.attachEvents()}render(t,e){const s=K.prepare(t);this.data=s,s.meta&&Object.assign(this,s.meta),this.onSeatClick=e,this.container.innerHTML="",this.container.classList.add("blueprint-renderer-container"),this.transformContainer=document.createElement("div"),this.transformContainer.className="blueprint-transform-container",this.contentWidth&&(this.transformContainer.style.width=this.contentWidth+"px",this.transformContainer.style.height=this.contentHeight+"px"),this.container.appendChild(this.transformContainer),this.createTooltip(),this.renderBackground(),this.renderSeats(),this.fitToScreen(),this.attachEvents()}renderBackground(){const t=this.data.background_svg;if(!t)return;const e=document.createElement("div");e.className="blueprint-bg-container";const{svg:s,isSvg:n}=G.prepareBackgroundSvg(t);if(n)e.innerHTML=s;else if(t.startsWith("http")){const i=document.createElement("img");i.src=t,i.className="blueprint-bg-img",e.appendChild(i)}this.transformContainer.appendChild(e)}applySeatStyle(t,e){V.applyStyle(t,e,this.seatSize)}updateSeat(t){t.element&&this.applySeatStyle(t.element,t)}updateSeatsDOM(){!this.data||!this.data.objects||this.data.objects.forEach(t=>{if(!t.element){const e=this.transformContainer.querySelector(`.blueprint-seat-container[data-seat-id="${t.id}"]`);e&&(t.element=e.querySelector(".blueprint-seat-visual-inner"))}t.element&&this.applySeatStyle(t.element,t)})}updateControllerDims(){this.container&&this.controller.updateDimensions(this.container.clientWidth,this.container.clientHeight,this.contentWidth,this.contentHeight)}fitToScreen(){!this.contentWidth||!this.contentHeight||this.container.clientWidth===0||this.container.clientHeight===0||(this.updateControllerDims(),this.controller.fitToScreen(),this.updateTransform())}attachEvents(){this.gestureController=new J(this.container,{onPan:(t,e,s,n)=>this.handlePan(t,e,s,n),onZoom:(t,e,s)=>this.handleZoom(t,e,s),onPinch:(t,e,s,n,i)=>this.handlePinch(t,e,s,n,i),onTap:(t,e)=>this.handleTap(t,e),onInteractionStart:()=>{this.updateControllerDims(),this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null)},onInteractionEnd:()=>this.snapBack()})}handlePan(t,e,s,n){this.controller.onInteractionUpdate(t,e,1,s,n,this.container.getBoundingClientRect()),this.updateTransform()}handleZoom(t,e,s){this.controller.onInteractionUpdate(0,0,t,e,s,this.container.getBoundingClientRect(),!1),this.updateTransform()}handlePinch(t,e,s,n,i){this.controller.onInteractionUpdate(t,e,s,n,i,this.container.getBoundingClientRect()),this.updateTransform()}handleTap(t,e){const s=document.elementFromPoint(t,e);if(s){const n=s.closest(".blueprint-seat-container");if(n&&n.dataset.seatId){const i=n.dataset.seatId,o=this.data.objects.find(a=>String(a.id)===String(i));o&&this.onSeatClick&&this.onSeatClick(o)}}}updateTransform(){if(!this.transformContainer)return;const{x:t,y:e,scale:s}=this.controller.state;this.transformContainer.style.transform=`translate(${t}px, ${e}px) scale(${s})`}snapBack(){this.updateControllerDims();const t=this.controller.getConstrainedState(),{x:e,y:s,scale:n}=this.controller.state;(Math.abs(t.x-e)>.5||Math.abs(t.y-s)>.5||Math.abs(t.scale-n)>.001)&&this.animateTo(t)}animateTo(t){const e=this.controller.state.x,s=this.controller.state.y,n=this.controller.state.scale,i=performance.now(),o=b.snapAnimationDuration,a=c=>{const f=(c-i)/o;if(f<1){const l=1-Math.pow(1-f,3);this.controller.state.x=e+(t.x-e)*l,this.controller.state.y=s+(t.y-s)*l,this.controller.state.scale=n+(t.scale-n)*l,this.updateTransform(),this._animationFrame=requestAnimationFrame(a)}else this.controller.state.x=t.x,this.controller.state.y=t.y,this.controller.state.scale=t.scale,this.updateTransform(),this._animationFrame=null};this._animationFrame&&cancelAnimationFrame(this._animationFrame),this._animationFrame=requestAnimationFrame(a)}createTooltip(){this.tooltipElement||(this.tooltipElement=document.createElement("div"),this.tooltipElement.className="blueprint-tooltip",document.body.appendChild(this.tooltipElement))}destroy(){this.gestureController&&(this.gestureController.destroy(),this.gestureController=null),this.tooltipElement&&(this.tooltipElement.remove(),this.tooltipElement=null)}processData(){}renderSeats(){(this.data.objects||[]).forEach(e=>{if(e.x===void 0||e.y===void 0)return;const s=document.createElement("div");s.className="blueprint-seat-container",s.dataset.seatId=e.id,s.style.left=e.x*this.seatSize+"px",s.style.top=e.y*this.seatSize+"px",s.style.width=this.seatSize+"px",s.style.height=this.seatSize+"px";const n=document.createElement("div");n.className="blueprint-seat-visual-inner",this.applySeatStyle(n,e),s.appendChild(n),s.onclick=i=>{i.stopPropagation(),this.onSeatClick&&this.onSeatClick(e)},s.onpointerenter=i=>this.showTooltip(e,i),s.onpointerleave=()=>this.hideTooltip(),s.onpointermove=i=>this.updateTooltipPosition(i),this.transformContainer.appendChild(s),e.element=n})}getTooltipContent(t){const e={productsMap:this.productsMap,ticketsMap:this.ticketsMap,ordersMap:this.ordersMap,optMap:this.optMap,data:this.data};return Z.getContent(t,e)}showTooltip(t,e){if(e&&e.pointerType==="touch"||!this.tooltipElement)return;const s=this.getTooltipContent(t);s&&(this.tooltipElement.innerText=s,this.tooltipElement.style.display="block",this.updateTooltipPosition(e))}hideTooltip(){this.tooltipElement&&(this.tooltipElement.style.display="none")}updateTooltipPosition(t){if(t&&t.pointerType==="touch"||!this.tooltipElement||this.tooltipElement.style.display==="none")return;const e=15;this.tooltipElement.style.left=t.clientX+e+"px",this.tooltipElement.style.top=t.clientY+e+"px";const s=this.tooltipElement.getBoundingClientRect();s.right>window.innerWidth&&(this.tooltipElement.style.left=t.clientX-s.width-e+"px"),s.bottom>window.innerHeight&&(this.tooltipElement.style.top=t.clientY-s.height-e+"px")}getPinchDist(t){return Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY)}}if(typeof document<"u"){const g=new URL("/web-assets/blueprint-DmWIgusI.css",import.meta.url).href;if(!document.querySelector(`link[href="${g}"]`)){const t=document.createElement("link");t.rel="stylesheet",t.href=g,document.head.appendChild(t)}}class et{constructor(){this.renderer=null}async open(t,e,s){const n=t.formModel,i=document.createElement("div");i.className="blueprint-modal-container",i.style.touchAction="none",document.body.appendChild(i),document.body.classList.add("blueprint-active"),document.documentElement.classList.add("blueprint-active");const o=document.createElement("button");o.className="btn btn-primary btn-submit blueprint-btn-confirm",o.textContent=z.buttonContinue;const a=document.createElement("div");a.className="blueprint-content",i.appendChild(a),i.appendChild(o);let c=null;this.selectedSeats=s?[...s]:[],window.history.pushState({overlay:"seat-selection"},"","#seat-selection");const l=h=>{S()},S=()=>{this.renderer&&this.renderer.destroy(),document.body.classList.remove("blueprint-active"),document.documentElement.classList.remove("blueprint-active"),i.remove(),window.removeEventListener("popstate",l)};o.onclick=()=>{window.history.back()},window.addEventListener("popstate",l);try{a.innerHTML='<div class="blueprint-loading"><div class="sp-loader"></div></div>';let h=null;if(e&&e.data&&e.data.blueprintId?h=e.data.blueprintId:n.blueprint&&(h=typeof n.blueprint=="object"?n.blueprint.id:n.blueprint),!h)throw new Error("Blueprint ID missing");c=await H.getBlueprint(n.secret,n.key,h),c&&c.secret?(console.log("[BlueprintSelector] ADOPTING SECRET FROM API:",c.secret),n.secret=c.secret,this.reservationSecret=c.secret,t&&t.payload&&(t.payload[H.metaSecret]=c.secret)):this.reservationSecret=n.secret,this.selectedSeats.length>0&&this.selectedSeats.forEach(r=>{if(c.spots){const d=c.spots.find(u=>String(u.id)===String(r.id));d&&(d.state=p.SELECTED_BY_ME)}if(c.objects){const d=c.objects.find(u=>String(u.id)===String(r.id));d&&(d.state=p.SELECTED_BY_ME)}}),this.renderer=new Q(a),this.renderer.render(c,r=>this.handleSeatClick(r,t))}catch(h){console.error(h),a.innerHTML=`<div class="blueprint-error">Error: ${h.message}</div>`,$(async()=>{const{Toast:r}=await import("./toast-D6YzYK6v.js");return{Toast:r}},[]).then(({Toast:r})=>{new r(h.message,"error").show()})}}async handleSeatClick(t,e){if(t.processing){console.log("Seat is processing, ignoring click");return}if(console.log("Seat clicked",t),!(t.state!==p.AVAILABLE&&t.state!==p.SELECTED_BY_ME)){t.processing=!0;try{const s=t.state!==p.SELECTED_BY_ME,n=t.state,i=s?p.SELECTED_BY_ME:p.AVAILABLE;t.state=i,s?this.selectedSeats.push(t):this.selectedSeats=this.selectedSeats.filter(o=>o.id!==t.id),this.renderer.updateSeat(t),await e.toggleSpot(t,s)}catch(s){console.error("Spot selection failed",s);const n=t.state===p.SELECTED_BY_ME;t.state=n?p.AVAILABLE:p.SELECTED_BY_ME,n?this.selectedSeats=this.selectedSeats.filter(i=>i.id!==t.id):this.selectedSeats.push(t),this.renderer.updateSeat(t),$(async()=>{const{Toast:i}=await import("./toast-D6YzYK6v.js");return{Toast:i}},[]).then(({Toast:i})=>{new i(s.message,"error").show()})}finally{t.processing=!1}}}}export{et as BlueprintSelector};
