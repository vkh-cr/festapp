const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["web-assets/blueprint_selector-tbqRAKaa.js","web-assets/index-CcrWGBd4.js","web-assets/index-HcR4OibG.css","web-assets/order_result-4cRecScd.js"])))=>i.map(i=>d[i]);
import{L as o,_ as O,O as J,C as U,f as Z,c as ee,T as te,S as se,D as q,F as V,a as ae,b as oe,R as j,d as M}from"./index-CcrWGBd4.js";class y{static get currencySelectLabel(){return o.tr("FormsFeature.inWhatCurrency")}static get formSettingsTitle(){return o.tr("FeatureFormSettings.title")}static get formNotFound(){return o.tr("FeatureFormSettings.formNotFound")}static get labelFormTitle(){return o.tr("FeatureFormSettings.labelFormTitle")}static get labelFormLink(){return o.tr("FeatureFormSettings.labelFormLink")}static get validationLinkRequired(){return o.tr("FeatureFormSettings.validationLinkRequired")}static get validationLinkInvalidChars(){return o.tr("FeatureFormSettings.validationLinkInvalidChars")}static get validationLinkInUse(){return o.tr("FeatureFormSettings.validationLinkInUse")}static get labelDeadlineDays(){return o.tr("FeatureFormSettings.labelDeadlineDays")}static get helperDeadlineDays(){return o.tr("FeatureFormSettings.helperDeadlineDays")}static get labelCardDesign(){return o.tr("FeatureFormSettings.labelCardDesign")}static get subtitleCardDesign(){return o.tr("FeatureFormSettings.subtitleCardDesign")}static get errorFixBeforeSave(){return o.tr("FeatureFormSettings.errorFixBeforeSave")}static get labelUseExternalForm(){return o.tr("FeatureFormSettings.labelUseExternalForm")}static get labelReservationLink(){return o.tr("FeatureFormSettings.labelReservationLink")}static get helperReservationLink(){return o.tr("FeatureFormSettings.helperReservationLink")}static get labelPrice(){return o.tr("FeatureFormSettings.labelPrice")}static get helperPrice(){return o.tr("FeatureFormSettings.helperPrice")}static get labelAdvancedSettings(){return o.tr("FeatureFormSettings.labelAdvancedSettings")}static get labelReserveButtonTitle(){return o.tr("FeatureFormSettings.labelReserveButtonTitle")}static get labelDeadlineDuration(){return o.tr("FeatureFormSettings.labelDeadlineDuration")}static get helperDeadlineDuration(){return o.tr("FeatureFormSettings.helperDeadlineDuration")}static get labelReminderEnabled(){return o.tr("FeatureFormSettings.labelReminderEnabled")}static get helperReminderEnabled(){return o.tr("FeatureFormSettings.helperReminderEnabled")}static get labelReminderInterval(){return o.tr("FeatureFormSettings.labelReminderInterval")}static get helperReminderInterval(){return o.tr("FeatureFormSettings.helperReminderInterval")}static get validationReminderInterval(){return o.tr("FeatureFormSettings.validationReminderInterval")}static get labelEnableReminders(){return o.tr("FeatureFormSettings.labelEnableReminders")}static get subtitleEnableReminders(){return o.tr("FeatureFormSettings.subtitleEnableReminders")}static get subtitleRemindersDisabled(){return o.tr("FeatureFormSettings.subtitleRemindersDisabled")}static get paymentDetailsTitle(){return o.tr("FeatureFormSettings.paymentDetailsTitle")}static get labelVariableSymbol(){return o.tr("FeatureFormSettings.labelVariableSymbol")}static get vsTypeRandom(){return o.tr("FeatureFormSettings.vsTypeRandom")}static get vsTypeSequence(){return o.tr("FeatureFormSettings.vsTypeSequence")}static get labelStartingNumber(){return o.tr("FeatureFormSettings.labelStartingNumber")}static get helperStartingNumber(){return o.tr("FeatureFormSettings.helperStartingNumber")}static get labelPaymentMessage(){return o.tr("FeatureFormSettings.labelPaymentMessage")}static get msgTypeNameSurname(){return o.tr("FeatureFormSettings.msgTypeNameSurname")}static get msgTypeNone(){return o.tr("FeatureFormSettings.msgTypeNone")}static get msgTypeOccasionTitle(){return o.tr("FeatureFormSettings.msgTypeOccasionTitle")}static get communicationToneTitle(){return o.tr("FeatureFormSettings.communicationToneTitle")}static get helperCommunicationTone(){return o.tr("FeatureFormSettings.helperCommunicationTone")}static get labelCommunicationTone(){return o.tr("FeatureFormSettings.labelCommunicationTone")}static get toneFormal(){return o.tr("FeatureFormSettings.toneFormal")}static get toneInformal(){return o.tr("FeatureFormSettings.toneInformal")}static get pickColor(){return o.tr("FeatureFormSettings.pickColor")}static get buttonGotIt(){return o.tr("FeatureFormSettings.buttonGotIt")}static get designPresets(){return o.tr("FeatureFormSettings.designPresets")}static get more(){return o.tr("FeatureFormSettings.more")}static get less(){return o.tr("FeatureFormSettings.less")}static get customColors(){return o.tr("FeatureFormSettings.customColors")}static get primaryColor(){return o.tr("FeatureFormSettings.primaryColor")}static get typography(){return o.tr("FeatureFormSettings.typography")}static get browseGoogleFonts(){return o.tr("FeatureFormSettings.browseGoogleFonts")}static get currentFont(){return o.tr("FeatureFormSettings.currentFont")}static get defaultFont(){return o.tr("FeatureFormSettings.defaultFont")}static get resetToDefault(){return o.tr("FeatureFormSettings.resetToDefault")}static get choosePopularFonts(){return o.tr("FeatureFormSettings.choosePopularFonts")}static get selectFromList(){return o.tr("FeatureFormSettings.selectFromList")}static get or(){return o.tr("FeatureFormSettings.or")}static get customFontNameLabel(){return o.tr("FeatureFormSettings.customFontNameLabel")}static get customFontHelper(){return o.tr("FeatureFormSettings.customFontHelper")}static get fontNotFound(){return o.tr("FeatureFormSettings.fontNotFound")}static get hexCodeLabel(){return o.tr("FeatureFormSettings.hexCodeLabel")}static get days(){return o.tr("FeatureFormSettings.days")}static get hours(){return o.tr("FeatureFormSettings.hours")}static get minutes(){return o.tr("FeatureFormSettings.minutes")}static get seconds(){return o.tr("FeatureFormSettings.seconds")}static get previewMode(){return o.tr("FeatureFormSettings.previewMode")}static get registrationStart(){return o.tr("FeatureFormSettings.registrationStart")}static get reservationUnavailable(){return o.tr("FeatureFormSettings.reservationUnavailable")}static get reservationUnavailableMessage(){return o.tr("FeatureFormSettings.reservationUnavailableMessage")}static get availability(){return o.tr("FeatureFormSettings.availability")}static get formClosedMessage(){return o.tr("FeatureFormSettings.formClosedMessage")}static scheduledWithTime(e){return o.tr("FeatureFormSettings.scheduledWithTime",{time:e})}static endedWithTime(e){return o.tr("FeatureFormSettings.endedWithTime",{time:e})}static get formOpenMessage(){return o.tr("FeatureFormSettings.formOpenMessage")}static get scheduleAndLimits(){return o.tr("FeatureFormSettings.scheduleAndLimits")}static get autoOpenHelp(){return o.tr("FeatureFormSettings.autoOpenHelp")}static get labelStartTime(){return o.tr("FeatureFormSettings.labelStartTime")}static get labelEndTime(){return o.tr("FeatureFormSettings.labelEndTime")}static get errorEndTimeBeforeStartTime(){return o.tr("FeatureFormSettings.errorEndTimeBeforeStartTime")}static get labelCountdownTimer(){return o.tr("FeatureFormSettings.labelCountdownTimer")}static get requiresStartTime(){return o.tr("FeatureFormSettings.requiresStartTime")}static get countdownDescription(){return o.tr("FeatureFormSettings.countdownDescription")}static get labelCountdownMessage(){return o.tr("FeatureFormSettings.labelCountdownMessage")}static get labelClosedMessage(){return o.tr("FeatureFormSettings.labelClosedMessage")}static get labelMessageContent(){return o.tr("FeatureFormSettings.labelMessageContent")}static get helperClosedMessage(){return o.tr("FeatureFormSettings.helperClosedMessage")}static get notSet(){return o.tr("FeatureFormSettings.notSet")}static get publicView(){return o.tr("FeatureFormSettings.publicView")}static get editorPreview(){return o.tr("FeatureFormSettings.editorPreview")}static get addTicket(){return o.tr("FormsFeature.addTicket")||"Add ticket"}static get ticket(){return o.tr("Ticket")||"Ticket"}static get buttonContinue(){return o.tr("Continue")}static get noOptionsForCurrency(){return o.tr("FormsFeature.noOptionsForCurrency")}static get clearSelection(){return o.tr("FormsFeature.clearSelection")}static get unavailable(){return o.tr("FormsFeature.unavailable")}static get inWhatCurrency(){return o.tr("FormsFeature.inWhatCurrency")}static get fieldName(){return o.tr("Name")}static get fieldSurname(){return o.tr("Surname")}static get fieldEmail(){return o.tr("Email")}static get fieldPhone(){return o.tr("Phone")}static get fieldCity(){return o.tr("City")}static get fieldBirthYear(){return o.tr("Birth year")}static get fieldNote(){return o.tr("Note")}static get fieldAddress(){return o.tr("Address")}static get fieldNationality(){return o.tr("Nationality")}static get fieldIdDocument(){return o.tr("Identification document")}static get fieldBirthDate(){return o.tr("Birth Date")}static birthDateError(e,i){return o.tr("You must be between {minAge} and {maxAge} years old.",{minAge:e,maxAge:i})}static birthDateWarning(e,i){return o.tr("Warning: Your age is not within the recommended range ({minAge}-{maxAge} years old).",{minAge:e,maxAge:i})}static get birthDateFormatHint(){return o.currentLocale==="cs"?"D. M. RRRR":"MM/DD/YYYY"}static get expiryDate(){return o.tr("Expiry Date")}static get expiryDatePastError(){return o.tr("Expiry date cannot be in the past.")}static get sexLabel(){return o.tr("I am")}static get maleLabel(){return o.tr("Male")}static get femaleLabel(){return o.tr("Female")}static get notSpecifiedLabel(){return o.tr("Not specified")}static get formsTitle(){return o.tr("FormsFeature.formsTitle")}static get createNewForm(){return o.tr("FormsFeature.createNewForm")}static noFormsForEventPrompt(e){return o.tr("FormsFeature.noFormsForEventPrompt",{createNew:e})}static get createCopy(){return o.tr("FormsFeature.createCopy")}static get statusOpen(){return o.tr("FormsFeature.statusOpen")}static get statusClosed(){return o.tr("FormsFeature.statusClosed")}static get responses(){return o.tr("FormsFeature.responses")}static get duplicateSuccess(){return o.tr("FormsFeature.duplicateSuccess")}static get deleteFormTitle(){return o.tr("FormsFeature.deleteFormTitle")}static get deleteFormContent(){return o.tr("FormsFeature.deleteFormContent")}static get tabForm(){return o.tr("FormsFeature.tabForm")}static get tabResponses(){return o.tr("FormsFeature.tabResponses")}static get defaultFormTitle(){return o.tr("FormsFeature.defaultFormTitle")}static get formAvailableAt(){return o.tr("FormsFeature.formAvailableAt")}static get formCreatedSuccess(){return o.tr("FormsFeature.formCreatedSuccess")}static get formTurnedOff(){return o.tr("FormsFeature.formTurnedOff")}static get editOffText(){return o.tr("FormsFeature.editOffText")}static get editContent(){return o.tr("FormsFeature.editContent")}static get dragToReorder(){return o.tr("FormsFeature.dragToReorder")}static get addFieldTitle(){return o.tr("FormsFeature.addFieldTitle")}static get personalInfo(){return o.tr("FormsFeature.personalInfo")}static get noFieldsAvailable(){return o.tr("FormsFeature.noFieldsAvailable")}static get addProductTypeTitle(){return o.tr("FormsFeature.addProductTypeTitle")}static get createNewProductTypeOption(){return o.tr("FormsFeature.createNewProductTypeOption")}static get untitledProductType(){return o.tr("FormsFeature.untitledProductType")}static get noProductTypesToAdd(){return o.tr("FormsFeature.noProductTypesToAdd")}static get newProductTypeDefaultName(){return o.tr("FormsFeature.newProductTypeDefaultName")}static get typeHere(){return o.tr("FormsFeature.typeHere")}static get phoneFormatHint(){return o.tr("FormsFeature.phoneFormatHint")}static get phoneFormatValidation(){return o.tr("FormsFeature.phoneFormatValidation")}static get noProductTypes(){return o.tr("FormsFeature.noProductTypes")}static get productTypes(){return o.tr("FormsFeature.productTypes")}static get seatSelection(){return o.tr("FormsFeature.seatSelection")}static get note(){return o.tr("FormsFeature.note")}static get labelMaxTicketsPerOrder(){return o.tr("FormsFeature.labelMaxTicketsPerOrder")}static get helperMaxTicketsPerOrder(){return o.tr("FormsFeature.helperMaxTicketsPerOrder")}static get validationMaxTicketsInvalid(){return o.tr("FormsFeature.validationMaxTicketsInvalid")}static get createFormTitle(){return o.tr("FormsFeature.createFormTitle")}static get createNewBlankForm(){return o.tr("FormsFeature.createNewBlankForm")}static get orCreateFromCopy(){return o.tr("FormsFeature.orCreateFromCopy")}static get searchFormsToCopy(){return o.tr("FormsFeature.searchFormsToCopy")}static get groupHappeningNow(){return o.tr("FormsFeature.groupHappeningNow")}static get groupUpcoming(){return o.tr("FormsFeature.groupUpcoming")}static get groupOther(){return o.tr("FormsFeature.groupOther")}static numberOfResponsesTooltip(e){return o.tr("FormsFeature.numberOfResponsesTooltip",[e])}static get fieldCannotBeEmpty(){return o.tr("fieldCannotBeEmpty")||"Field cannot be empty"}static get invalidFormat(){return o.tr("invalidFormat")||"Invalid format"}}class R{static get metaFields(){return"fields"}static get metaSecret(){return"secret"}static get metaForm(){return"form"}static get metaValues(){return"values"}static getTicketInputName(e,i,t){return`${e}_${i}_${t}`}static getAvailableCurrencies(e){const i=new Set;if((e.visibleFields||[]).forEach(a=>{(a.type==="product_type"||a.type==="ticket")&&console.log(`FormHelper: Inspecting field [${a.id}] type=${a.type}`,a),a.data&&a.data.product_type_data&&a.data.product_type_data.products&&a.data.product_type_data.products.forEach(d=>{d.currency&&i.add(d.currency),d.currencyCode&&i.add(d.currencyCode),d.currency_code&&i.add(d.currency_code)}),a.options&&a.options.forEach(d=>{d.currency&&i.add(d.currency),d.currencyCode&&i.add(d.currencyCode),d.currency_code&&i.add(d.currency_code)}),a.type==="ticket"&&(a.subFields||a.fields||a.data&&a.data.fields||[]).forEach(l=>{l.options&&l.options.forEach(c=>{c.currency&&i.add(c.currency),c.currencyCode&&i.add(c.currencyCode),c.currency_code&&i.add(c.currency_code)}),l.data&&l.data.product_type_data&&l.data.product_type_data.products&&l.data.product_type_data.products.forEach(c=>{c.currency&&i.add(c.currency),c.currencyCode&&i.add(c.currencyCode),c.currency_code&&i.add(c.currency_code)}),l.product_type_data&&l.product_type_data.products&&l.product_type_data.products.forEach(c=>{c.currency&&i.add(c.currency),c.currencyCode&&i.add(c.currencyCode),c.currency_code&&i.add(c.currency_code)})})}),i.size===0)return console.log("FormHelper: No currencies found, defaulting to CZK"),["CZK"];console.log("FormHelper: Found currencies:",Array.from(i));const r=Array.from(i);return r.includes("CZK")?["CZK",...r.filter(a=>a!=="CZK")]:r}static replaceSpotWithId(e){return e}static calculatePrice(e,i){let t=0,r=0,a="CZK";const d=(n,s)=>{let u=n.options||n.data&&n.data.options||[];if(n.type==="product_type"&&n.data&&n.data.product_type_data&&n.data.product_type_data.products&&(u=n.data.product_type_data.products),!u||u.length===0)return 0;const p=String(s),m=u.find(f=>f.id!=null&&String(f.id)===p);if(m){a==="CZK"&&m.currency&&(a=m.currency);const f=Number(m.price);return isNaN(f)?0:f}return 0},l=e.ticket||[];if(l.length>0){const n=[];i.visibleFields.forEach(s=>{if(s.type==="ticket"){const u=s.subFields||s.fields||s.data&&s.data.fields||[];n.push(...u)}}),l.forEach((s,u)=>{r++,s.spotPrice&&(t+=s.spotPrice),s.fields&&Array.isArray(s.fields)&&s.fields.forEach(p=>{let m=null,f=null;if(p._subFieldId)m=n.find(F=>String(F.id)===String(p._subFieldId));else{const F=Object.keys(p).filter(h=>h!=="currency_code"&&h!=="_subFieldId");if(F.length>0){const h=F[0];m=n.find(b=>b.type===h),f=p[h]}}if(m){if(f===null&&(f=p[m.type],f===void 0)){const h=Object.keys(p).filter(b=>b!=="currency_code"&&b!=="_subFieldId");h.length>0&&(f=p[h[0]])}const F=d(m,f);F>0&&(t+=F)}})})}return(e.fields||[]).forEach(n=>{Object.keys(n).forEach(s=>{if(s==="currency_code")return;const u=n[s],p=i.visibleFields.find(m=>String(m.id)===s);if(p){const m=d(p,u);m>0&&(t+=m,r++)}})}),{totalPrice:t,totalItems:r,currency:a}}}class T{static kMaxPhoneNumberLength=12;static formatInput(e){const i=e.value,t=e.selectionEnd;let r=T.cleanPhoneNumber(i),a=T.formatPhoneNumber(r);i.endsWith(" ")&&(r.length===3||r.length===6||r.length===9||r.startsWith("+")&&r.length===4)&&(a.endsWith(" ")||(a+=" ")),e.value=a;let d=0;for(let n=0;n<t&&n<i.length;n++)i[n]!==" "&&d++;let l=0,c=0;for(let n=0;n<a.length&&(a[n]!==" "&&c++,!(c>d));n++)l++;e.setSelectionRange(l,l)}static cleanPhoneNumber(e){let i=e.replace(/[^\d+]/g,"");return i.includes("+")&&(i.startsWith("+")?i="+"+i.substring(1).replace(/\+/g,""):i=i.replace(/\+/g,"")),i.replace(/\+/g,"").length>T.kMaxPhoneNumberLength&&(i.startsWith("+")?i=i.substring(0,T.kMaxPhoneNumberLength+1):i=i.substring(0,T.kMaxPhoneNumberLength)),i}static formatPhoneNumber(e){let i="";if(e.startsWith("+"))if(e.length>4){i=e.substring(0,4)+" "+e.substring(4);let t=i.substring(0,5),r=i.substring(5),a="";for(let d=0;d<r.length;d++)d>0&&d%3===0&&(a+=" "),a+=r[d];i=t+a}else i=e;else for(let t=0;t<e.length;t++)t>0&&t%3===0&&(i+=" "),i+=e[t];return i}}class G{constructor(e){this.value=e}toString(){return this.value}}function w(v,...e){let i="";return v.forEach((t,r)=>{if(i+=t,r<e.length){const a=e[r];i+=re(a)}}),new G(i)}function K(v){return new G(v)}function re(v){return v==null?"":v instanceof G?v.value:Array.isArray(v)?v.map(re).join(""):typeof v=="number"||typeof v=="boolean"?String(v):String(v).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}class N{static create(e,i){const t=document.createElement("div"),r=e.isHidden,a=N.getInputType(e.type),d=e.id.toString(),l=y.typeHere,c=N.getAutocompleteValue(e.type);t.innerHTML=w`
            <div class="form-field-container" style="${r?"display:none":""}">
                <label class="form-field-label">
                    ${e.title||""}
                    ${e.isRequired?w`<span class="required-star"> *</span>`:""}
                </label>
                
                ${e.description?w`<div class="form-field-description">${K(e.description)}</div>`:""}
                
                <div class="input-wrapper">
                    <input type="${a}" 
                           name="${d}" 
                           class="form-control" 
                           placeholder="${l}"
                           ${e.isRequired?"required":""}
                           ${c?w`autocomplete="${c}"`:""}
                    >
                    
                    ${e.type==="phone"?w`
                        <div class="phone-badges-container" style="display:none; margin-top:8px;"></div>
                    `:""}
                </div>
                
                <div class="form-field-error" style="display:none"></div>
            </div>
        `;const n=t.firstElementChild,s=n.querySelector("input");return e.type==="phone"&&N._attachPhoneLogic(s,n),n}static _attachPhoneLogic(e,i){e.value||(e.value="+420");const t=()=>T.formatInput(e);t(),e.addEventListener("input",t),e.pattern="^\\+\\d{3} \\d{3} \\d{3} \\d{3}$";const r=i.querySelector(".phone-badges-container");if(!r)return;const a=(c,n)=>{const s=document.createElement("div");return s.textContent=c,s.className="phone-badge-chip",s.style.cssText=`
                    display: inline-block;
                    padding: 4px 8px;
                    margin-right: 8px;
                    border-radius: 12px;
                    border: 1px solid var(--primary-color);
                    color: var(--primary-color);
                    background: rgba(var(--primary-color-rgb, 68, 101, 166), 0.1);
                    font-size: 12px;
                    font-weight: 500;
                    cursor: pointer;
                    user-select: none;
                `,s.onmousedown=u=>u.preventDefault(),s.onclick=()=>{let u=e.value,p=u;if(u.startsWith(n))p=u;else if(u.startsWith("+420"))p=n+u.substring(4);else if(u.startsWith("+421"))p=n+u.substring(4);else if(u.startsWith("+")){const m=u.indexOf(" ");m>0?p=n+u.substring(m):p=n+" "+u.replace(/^\+\d+\s*/,"")}else p=n+" "+u;e.value=T.cleanPhoneNumber(p),T.formatInput(e),e.focus()},s},d=a("CZ +420","+420"),l=a("SK +421","+421");r.appendChild(d),r.appendChild(l),e.addEventListener("focus",()=>{r.style.display="block"}),e.addEventListener("blur",()=>{setTimeout(()=>{r.style.display="none"},200)})}static getAutocompleteValue(e){switch(e){case"name":return"given-name";case"surname":return"family-name";case"email":return"email";case"phone":return"tel";case"city":return"address-level2";case"address":return"street-address";case"nationality":return"country";case"birth_year":return"bday-year";default:return null}}static getInputType(e){switch(e){case"email":return"email";case"phone":return"tel";case"birth_year":return"number";case"note":return"text";default:return"text"}}}class B{static create(e,i){const t=document.createElement("div");if(t.className="form-field-container radio-field",!e._hideLabel){const s=document.createElement("label");s.className="form-field-label",s.innerHTML=`${e.title||""}${e.isRequired?'<span class="required-star">*</span>':""}`,t.appendChild(s)}if(e.description){const s=document.createElement("div");s.className="form-field-description",s.innerHTML=e.description,t.appendChild(s)}const r=document.createElement("div");r.className="radio-options";const d=e.type!=="product_type"&&e.options&&e.options.some(s=>s.description&&s.description.trim().length>0),l=i&&i.isCardDesign||e.description&&e.description.trim().length>0||d;e.options&&e.options.forEach(s=>{const u=document.createElement("div");u.className="form-check",l&&u.classList.add("option-card");const p=document.createElement("input");p.type="radio",p.name=e.id,p.value=s.id!==void 0&&s.id!==null?s.id:s.title,p.id=`${e.id}_${s.id!==void 0&&s.id!==null?s.id:s.title}`,p.className="form-check-input";const m=s.currencyCode||s.currency||s.currency_code;m&&(p.setAttribute("data-currency",m),u.setAttribute("data-currency",m)),e.value!==void 0&&e.value!==null&&String(s.id)===String(e.value)?p.checked=!0:e.value,l&&(u.classList.add("option-card"),u.onclick=g=>{g.target!==p&&g.target.tagName!=="LABEL"&&!g.target.closest("label")&&p.click()});const F=document.createElement("label");F.className="form-check-label",F.htmlFor=p.id;let h=`<span>${s.title||""}</span>`;if(s.price){const g=`${s.price} ${m||""}`;h+=`<span class="option-price">+${g}</span>`}F.innerHTML=h;const b=document.createElement("div");if(b.appendChild(F),s.description){const g=document.createElement("span");g.className="option-description",g.innerHTML=s.description,b.appendChild(g)}u.appendChild(p),u.appendChild(b),r.appendChild(u)}),t.appendChild(r);const c=document.createElement("button");c.type="button",c.className="btn-clear-selection",c.innerText=y.clearSelection,t.addEventListener("change",s=>{s.target.name==e.id&&s.target.type==="radio"&&(c.style.display="inline-block")}),e.value!==void 0&&e.value!==null&&e.value!==""&&(c.style.display="inline-block"),c.onclick=()=>{t.querySelectorAll(`input[type="radio"][name="${e.id}"]`).forEach(u=>u.checked=!1),c.style.display="none",t.setAttribute("name",e.id),t.name=e.id,t.value=null,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))},t.appendChild(c);const n=document.createElement("div");return n.className="form-field-error",n.style.display="none",t.appendChild(n),t}}class X{static create(e,i){const t=document.createElement("div");t.className="form-field-container checkbox-field-container",e.isHidden&&(t.style.display="none");const a=e.type!=="product_type"&&e.options&&e.options.some(n=>n.description&&n.description.trim().length>0),d=i&&i.isCardDesign||e.description&&e.description.trim().length>0||a;if(!e._hideLabel){const n=document.createElement("label");n.className="form-field-label",n.innerHTML=`${e.title||""}${e.isRequired?'<span class="required-star">*</span>':""}`,t.appendChild(n)}if(e.description){const n=document.createElement("div");n.className="form-field-description",n.innerHTML=e.description,t.appendChild(n)}const l=document.createElement("div");if(l.className="checkbox-options",e.options&&e.options.forEach(n=>{const s=document.createElement("div");s.className="form-check";const u=document.createElement("input");u.type="checkbox",u.name=e.id,u.value=n.id!==void 0&&n.id!==null?n.id:n.title,u.id=`${e.id}_${n.id!==void 0&&n.id!==null?n.id:n.title}`,u.className="form-check-input";const p=n.currencyCode||n.currency||n.currency_code;p&&(u.setAttribute("data-currency",p),s.setAttribute("data-currency",p)),d&&(s.classList.add("option-card"),s.onclick=h=>{h.target!==u&&h.target.tagName!=="LABEL"&&!h.target.closest("label")&&u.click()});const m=document.createElement("label");m.className="form-check-label",m.htmlFor=u.id;let f=`<span>${n.title||""}</span>`;if(n.price){const h=`${n.price} ${p||""}`;f+=`<span class="option-price">+${h}</span>`}m.innerHTML=f;const F=document.createElement("div");if(F.appendChild(m),n.description){const h=document.createElement("span");h.className="option-description",h.innerHTML=n.description,F.appendChild(h)}s.appendChild(u),s.appendChild(F),l.appendChild(s)}),t.appendChild(l),!e.options||e.options.length===0){const n=document.createElement("div");n.className="form-check single-checkbox";const s=document.createElement("input");s.type="checkbox",s.name=e.id.toString(),s.id=`field_${e.id}`,s.className="form-check-input",e.isRequired&&(s.required=!0);const u=document.createElement("label");if(u.htmlFor=s.id,u.className="form-check-label",u.textContent=e.title||"",e.isRequired&&(u.innerHTML+=' <span class="required-star">*</span>'),n.appendChild(s),n.appendChild(u),t.appendChild(n),e.description){const p=document.createElement("div");p.className="form-field-description",p.style.marginLeft="1.5em",p.innerHTML=e.description,t.appendChild(p)}}const c=document.createElement("div");return c.className="form-field-error",c.style.display="none",t.appendChild(c),t}}class W{static _uniqueIndexCounter=0;static reset(){W._uniqueIndexCounter=0}static create(e,i,t){const r=document.createElement("div");r.className="form-field-container ticket-field",r.dataset.fieldId=e.id;const a=e.subFields||e.fields||e.data&&e.data.fields||[],d=a.some(l=>l.type==="spot");if(i.blueprint){const l=document.createElement("button");l.type="button",l.className="btn btn-primary btn-block",l.style.width="100%",l.style.marginBottom="24px",l.innerHTML=`<i class="material-icons" style="vertical-align: middle; margin-right: 8px;">event_seat</i> ${y.seatSelection||"Select Seat"}`,l.onclick=()=>{O(async()=>{const{BlueprintSelector:c}=await import("./blueprint_selector-tbqRAKaa.js");return{BlueprintSelector:c}},__vite__mapDeps([0,1,2])).then(({BlueprintSelector:c})=>{new c().open(t,e,r.selectedSeats||[])})},r.appendChild(l)}if(d){if(e.title&&e.title!=="Tickets"&&e.title!==J.tickets){const s=document.createElement("label");s.className="form-field-label",s.textContent=e.title,r.appendChild(s)}if(e.description){const s=document.createElement("div");s.className="form-field-description",s.innerHTML=e.description,r.appendChild(s)}const l=document.createElement("div");l.className="tickets-list",r.appendChild(l);const c=(s,u=null)=>{const p=document.createElement("div");p.className="ticket-item",u&&(p.dataset.seatId=u.id),p.dataset.index=s;let m=null;t&&t.state.tickets[s]&&(m=t.state.tickets[s]);const f=document.createElement("div");f.className="ticket-header";const F=document.createElement("span");F.style.fontWeight="bold",F.style.fontSize="1.3rem",u&&u.objectModel?F.textContent=u.objectModel.name||`${y.ticket} ${s+1}`:F.textContent=`${y.ticket} ${s+1}`,f.appendChild(F);const h=document.createElement("button");h.type="button",h.className="btn-remove-ticket",h.title=U.remove,h.innerHTML='<i class="material-icons">close</i>',h.onclick=async()=>{if(t){const g=Array.from(l.children).indexOf(p);t.removeTicket(g)}p.remove(),Array.from(l.children).forEach((g,S)=>{const k=g.querySelector(".ticket-header span");k&&k.textContent.startsWith(y.ticket)&&(k.textContent=`${y.ticket} ${S+1}`)}),r.selectedSeats&&u&&(r.selectedSeats=r.selectedSeats.filter(g=>g.id!==u.id))},f.appendChild(h),p.appendChild(f);const b=[...a].sort((g,S)=>g.type==="spot"?-1:1);if(b.length>0)b.forEach(g=>{const S={...g,id:R.getTicketInputName(e.id,s,g.id)};if(m&&m.fields){const C=m.fields.find(_=>String(_._subFieldId)===String(g.id));if(C){const _=C[g.type];_!==void 0&&(S.value=_)}}if(g.isRequired&&(S.isRequired=!0),S.type==="spot"&&(S.isRequired=!0,u)){let C=0,_=y.currencyDefault||"CZK",z="";const P=u.productModel||(typeof u.product=="object"?u.product:null);P&&(z=P.title||"",P.price&&(C=P.price),P.currency?_=P.currency:i.currencyCode&&(_=i.currencyCode));const Q=u.title||u.name||`Seat #${u.id}`,$=document.createElement("input");$.type="hidden",$.name=S.id,$.value=u.id,$.dataset.name=Q,C>0&&($.dataset.price=C),p.appendChild($);const A=document.createElement("div");A.className="form-field-container";const Y=document.createElement("label");Y.className="form-field-label",Y.textContent=S.title||J.gridSpot||"Spot",A.appendChild(Y);const L=document.createElement("div");L.className="form-control",L.style.backgroundColor="var(--bs-secondary-bg, #e9ecef)",L.style.opacity="1",L.style.display="flex",L.style.alignItems="center";const ie=C>0?`&nbsp;<span class="option-price">+${C} ${_}</span>`:"",ne=z?`${z} - `:"";L.innerHTML=`<span>${ne}${Q}</span>${ie}`,A.appendChild(L),p.appendChild(A);return}const k=D.createFormField(S,i);k.querySelectorAll("input, select, textarea").forEach(C=>{C.dataset.ticketId=e.id,C.dataset.index=s,C.dataset.subId=g.id,S.isRequired&&(C.dataset.required="true")}),p.appendChild(k)});else{const g=document.createElement("div");g.style.fontStyle="italic",g.style.color="#777",g.textContent="Ticket details",p.appendChild(g)}l.appendChild(p)};if(d&&i.blueprint){r.selectedSeats=[];const s=r.querySelector("button.btn-primary");s&&(s.onclick=()=>{O(async()=>{const{BlueprintSelector:u}=await import("./blueprint_selector-tbqRAKaa.js");return{BlueprintSelector:u}},__vite__mapDeps([0,1,2])).then(({BlueprintSelector:u})=>{new u().open(t,e,r.selectedSeats||[])})})}else{const s=document.createElement("button");s.type="button",s.className="btn btn-secondary btn-sm btn-add-ticket",s.textContent=`+ ${y.addTicket}`,s.onclick=()=>{t&&t.addTicket(),c(l.children.length),r.dispatchEvent(new Event("input",{bubbles:!0}))},r.appendChild(s),t&&t.state.tickets.length===0?(t.addTicket(),c(0)):t&&t.state.tickets.length>0?t.state.tickets.forEach((u,p)=>{c(p)}):c(0)}const n=()=>{const s=t.state.tickets,u=Array.from(l.children);let p=!1;if(s.length!==u.length)p=!0;else for(let m=0;m<s.length;m++){const f=s[m],F=u[m];if(f.spot){if(String(f.spot)!==String(F.dataset.seatId)){p=!0;break}}else if(F.dataset.seatId){p=!0;break}}if(!p){s.forEach((m,f)=>{const F=u[f];F&&m.fields&&m.fields.forEach(h=>{if(!h._subFieldId)return;const b=F.querySelector(`[data-sub-id="${h._subFieldId}"]`);if(b){if(document.activeElement===b)return;if(b.type!=="checkbox"){const g=Object.entries(h).find(([S,k])=>S!=="_subFieldId"&&S!=="currency_code"&&S!=="product_type")?.[1];g!==void 0&&String(b.value)!==String(g)&&(console.log(`[TicketFieldBuilder] Syncing value for ${h._subFieldId}: ${b.value} -> ${g}`),b.value=g)}}})});return}l.innerHTML="",r.selectedSeats=[],t.state.tickets.forEach((m,f)=>{let F=null;m.spot&&(F={id:m.spot,title:m.spotName||`Spot ${m.spot}`,productModel:{price:m.spotPrice}},r.selectedSeats.push(F)),c(f,F)}),r.dispatchEvent(new Event("input",{bubbles:!0}))};return t&&(n(),t.addEventListener("state-changed",()=>{n()})),r}else return a.forEach((l,c)=>{const n={...l,id:R.getTicketInputName(e.id,0,l.id)};n.isRequired,n.type==="product_type"&&n.data&&n.data.product_type_data&&n.data.product_type_data.products&&(!n.options||n.options.length===0)&&(n.options=n.data.product_type_data.products.map(p=>({id:p.id,title:p.title,description:p.description,price:p.price}))),n.type==="product_type"&&delete n._hideLabel;const s=D.createFormField(n,i);s.querySelectorAll("input, select, textarea").forEach(p=>{p.dataset.ticketId=e.id,p.dataset.index="0",p.dataset.subId=l.id}),r.appendChild(s)}),t&&t.state.tickets.length===0&&t.addTicket(),r}}class ce{static create(e,i){const t=document.createElement("div");t.className="form-field-container",e.isHidden&&(t.style.display="none");const r=document.createElement("label");if(r.className="form-field-label",r.textContent=y.fieldBirthDate,e.isRequired){const h=document.createElement("span");h.className="required-star",h.textContent=" *",r.appendChild(h)}if(t.appendChild(r),e.description){const h=document.createElement("div");h.className="form-field-description",h.innerHTML=e.description,t.appendChild(h)}const a=document.createElement("div");a.className="input-wrapper";const d=document.createElement("div");d.className="form-field-hint",d.textContent=y.birthDateFormatHint,a.appendChild(d);const l=document.createElement("input");l.type="text",l.name=e.id.toString(),l.className="form-control flatpickr-input",e.isRequired&&(l.required=!0),l.placeholder=y.typeHere,l.autocomplete="off",a.appendChild(l);const c=e.data?.min_year||0,n=e.data?.max_year||0,s=e.data?.is_hard===!0,u=e.data?.message;let p,m;if(c>0||n>0){let h=new Date;i.start&&(h=new Date(i.start));const b=g=>new Date(g.getFullYear(),g.getMonth(),g.getDate());if(n>0){const g=new Date(h.getFullYear()-n,h.getMonth(),h.getDate());p=b(g)}if(c>0){const g=new Date(h.getFullYear()-c,h.getMonth(),h.getDate());m=b(g)}}Z(l,{dateFormat:"Y-m-d",altInput:!0,altFormat:o.currentLocale==="cs"?"j. n. Y":"F j, Y",allowInput:!0,disableMobile:!0,locale:o.currentLocale==="cs"?ee.Czech:"default",parseDate:(h,b)=>{try{const g=Z.parseDate(h,b);if(g)return g}catch{}if(h&&typeof h=="string"){if(h.match(/^\d{1,2}\.\d{1,2}\.\d{4}$/)){const g=h.split(".");return new Date(`${g[2]}-${g[1]}-${g[0]}`)}if(h.match(/^\d{1,2}\. \d{1,2}\. \d{4}$/)){const g=h.replace(/ /g,"").split(".");return new Date(`${g[2]}-${g[1]}-${g[0]}`)}}},defaultDate:l.value||void 0}),t.appendChild(a);const f=document.createElement("div");f.className="form-field-message",f.style.display="none",f.style.marginTop="4px",f.style.fontSize="0.85em",t.appendChild(f);const F=document.createElement("div");if(F.className="form-field-error",F.style.display="none",t.appendChild(F),c>0||n>0){const h=()=>{const b=l.value;if(!b){f.style.display="none",s&&l.setCustomValidity("");return}const g=new Date(b),S=new Date(g.getFullYear(),g.getMonth(),g.getDate());let k=!1;if(p&&S<p&&(k=!0),m&&S>m&&(k=!0),k){let I="";if(u&&u.trim()!==""?I=u.replace("{minAge}",c).replace("{maxAge}",n):s?I=y.birthDateError(c,n):I=y.birthDateWarning(c,n),f.textContent=I,f.style.display="block",s)f.style.color="var(--red-color)",f.classList.add("form-field-error"),l.setCustomValidity(I),l.classList.add("invalid");else{const C=te.warningColor;f.style.color=C,l.setCustomValidity(""),l.classList.remove("invalid"),l.style.borderColor=C}}else f.style.display="none",l.setCustomValidity(""),l.classList.remove("invalid"),l.style.borderColor=""};l.value&&h(),l.addEventListener("input",h),l.addEventListener("change",h)}else console.log("DateFieldBuilder: No age limits for field",e.id,e.title);return t}}class le{static create(e,i){console.log("IdDocumentFieldBuilder field data:",JSON.parse(JSON.stringify(e))),i.isCardDesign;const t=document.createElement("label");if(t.className="form-field-label",t.textContent=e.title,e.isRequired){const s=document.createElement("span");s.className="required-star",s.textContent=" *",t.appendChild(s)}const r=document.createElement("div");r.className="input-wrapper";const a=document.createElement("input");a.type="text",a.name=e.id.toString(),a.className="form-control",e.isRequired&&(a.required=!0),a.placeholder=y.typeHere,r.appendChild(a);const d=e.description?document.createElement("div"):null;d&&(d.className="form-field-description",d.innerHTML=e.description);const l=e.showExpiryDate||e.show_expiry_date||e.data?.showExpiryDate||e.data?.show_expiry_date;let c=null;if(l){const s=document.createElement("label");s.className="form-field-label";const u=e.expiryDateLabel||e.expiry_date_label||e.data?.expiryDateLabel||e.data?.expiry_date_label;s.textContent=u&&u.trim()!==""?u:y.expiryDate;const p=document.createElement("div");p.className="input-wrapper";const m=document.createElement("input");m.type="text",m.name=e.id.toString()+"_expiry",m.className="form-control flatpickr-input",m.placeholder=o.currentLocale==="cs"?"D. M. RRRR":"YYYY-MM-DD",p.appendChild(m);const f=document.createElement("div");f.className="form-field-error",f.style.display="none";const F=h=>{if(!h){f.style.display="none",m.setCustomValidity(""),m.classList.remove("invalid");return}const b=new Date;if(b.setHours(0,0,0,0),h<b){const g=y.expiryDatePastError;f.textContent=g,f.style.display="block",m.setCustomValidity(g),m.classList.add("invalid")}else f.style.display="none",m.setCustomValidity(""),m.classList.remove("invalid")};Z(m,{dateFormat:"Y-m-d",altInput:!0,altFormat:o.currentLocale==="cs"?"j. n. Y":"F j, Y",allowInput:!0,minDate:"today",disableMobile:!1,locale:o.currentLocale==="cs"?ee.Czech:"default",onChange:function(h){F(h[0])}}),c={label:s,wrapper:p,error:f}}const n=document.createElement("div");if(n.className="form-field-container",e.isHidden&&(n.style.display="none"),n.appendChild(t),d&&n.appendChild(d),n.appendChild(r),l&&c){const s=document.createElement("div");s.style.height="8px",n.appendChild(s),n.appendChild(c.label),n.appendChild(c.wrapper),n.appendChild(c.error)}return n}}class D{static createFormField(e,i,t){(!e.title||e.title.trim()==="")&&(e.title=D.getAutoTitle(e.type));let r=null;switch(e.type){case"text":case"name":case"surname":case"city":case"email":case"phone":case"birth_year":case"note":case"address":case"nationality":r=N.create(e,i);break;case"id_document":r=le.create(e,i);break;case"sex":(!e.options||e.options.length===0)&&(e.options=[{id:"male",title:y.maleLabel},{id:"female",title:y.femaleLabel}],e.isRequired||e.options.unshift({id:"",title:y.notSpecifiedLabel})),r=B.create(e,i);break;case"select_one":r=B.create(e,i);break;case"select_many":r=X.create(e,i);break;case"product_type":e.data&&e.data.selection_type==="select_many"?r=X.create(e,i):r=B.create(e,i);break;case"spot":e.options&&e.options.length>0?r=B.create(e,i):r=N.create(e,i);break;case"ticket":r=W.create(e,i,t);break;case"birth_date":r=ce.create(e,i);break;default:console.warn(`Field type ${e.type} not supported yet.`),["text","string"].includes(e.type)&&(r=N.create(e,i));break}return r?D.isCardDesign(i,e)?r.dataset.skipCardWrapping==="true"?r:D.wrapInCard(e,r):r:document.createElement("div")}static getAutoTitle(e){switch(e){case"name":return y.fieldName;case"surname":return y.fieldSurname;case"email":return y.fieldEmail;case"phone":return y.fieldPhone;case"city":return y.fieldCity;case"birth_year":return y.fieldBirthYear;case"birth_date":return y.fieldBirthDate;case"note":return y.fieldNote;case"address":return y.fieldAddress;case"nationality":return y.fieldNationality;case"sex":return y.sexLabel;case"id_document":return y.fieldIdDocument;default:return""}}static isCardDesign(e,i){return!!(e.isCardDesign||i.description&&i.description.trim().length>0||["select_one","select_many","sex"].includes(i.type)&&i.options&&i.options.some(t=>t.description&&t.description.trim().length>0))}static wrapInCard(e,i){const t=document.createElement("div");return t.className="form-field-card",t.appendChild(i),t}}class de{static async sendOrder(e){const i=se.getClient();if(!i)throw new Error("Supabase client not initialized");const{data:t,error:r}=await i.functions.invoke("send-ticket-order",{body:{orderDetails:e}});if(r)return console.error("Error sending order:",r),{success:!1,message:r.message};const a=t?.code||200;return a===200?{success:!0,data:t}:{success:!1,code:a,message:t?.message||"Unknown error",product:t?.product}}}class ue{static updateMetaTags(e,i){if(!e)return;const t=e.title||"Festapp Event";let r="",a=null;if(e.header&&(r=this._extractTextFromHtml(e.header),a=this._extractImageFromHtml(e.header)),r||(r=e.description||"Rychlé a jednoduché založení události, prodej vstupenek a registrace."),e.startTime){const d=this._formatDate(e.startTime);d&&(r=`${d} - ${r}`)}document.title=`${t} - Vstupenky.online`,this._setMetaTag("name","description",r),this._setMetaTag("property","og:title",t),this._setMetaTag("property","og:description",r),i&&this._setMetaTag("property","og:url",i),a&&a.src&&(this._setMetaTag("property","og:image",a.src),a.width&&this._setMetaTag("property","og:image:width",a.width),a.height&&this._setMetaTag("property","og:image:height",a.height)),this._setMetaTag("property","twitter:title",t),this._setMetaTag("property","twitter:description",r),a&&a.src&&this._setMetaTag("property","twitter:image",a.src)}static _setMetaTag(e,i,t){let r=t?String(t).trim():"";const a=i.includes("image")||i.includes("url"),d=i.includes("width")||i.includes("height");!a&&!d&&r.length>300&&(r=r.substring(0,297)+"...");let l=document.querySelector(`meta[${e}="${i}"]`);l||(l=document.createElement("meta"),l.setAttribute(e,i),document.head.appendChild(l)),l.setAttribute("content",r)}static _extractTextFromHtml(e){return e&&new DOMParser().parseFromString(e,"text/html").body.textContent||""}static _extractImageFromHtml(e){if(!e)return null;const r=new DOMParser().parseFromString(e,"text/html").querySelector("img");return r?{src:r.src,width:r.getAttribute("width"),height:r.getAttribute("height")}:null}static _formatDate(e){return e?e.toLocaleDateString("cs-CZ",{day:"numeric",month:"numeric",year:"numeric"}):""}}class E{static timer=null;static render(e,i,t){E.timer&&(clearInterval(E.timer),E.timer=null);const r=document.createElement("div");r.className="countdown-widget";const a=i.countdownTitle||y.registrationStart,d=new Date(i.startTime);r.innerHTML=`
            <div class="countdown-title form-header">${a}</div>
            <div class="countdown-timer-row">
                <div class="time-block"><div class="time-value" id="cd-days">00</div><div class="time-label">${y.days}</div></div>
                <div class="time-block"><div class="time-value" id="cd-hours">00</div><div class="time-label">${y.hours}</div></div>
                <div class="time-block"><div class="time-value" id="cd-minutes">00</div><div class="time-label">${y.minutes}</div></div>
                <div class="time-block"><div class="time-value" id="cd-seconds">00</div><div class="time-label">${y.seconds}</div></div>
            </div>
        `,e.appendChild(r);const l=()=>{const n=d-new Date;if(n<=0){E.timer&&clearInterval(E.timer),t&&t();return}const s=Math.floor(n/(1e3*60*60*24)),u=Math.floor(n%(1e3*60*60*24)/(1e3*60*60)),p=Math.floor(n%(1e3*60*60)/(1e3*60)),m=Math.floor(n%(1e3*60)/1e3),f=S=>S.toString().padStart(2,"0"),F=r.querySelector("#cd-days"),h=r.querySelector("#cd-hours"),b=r.querySelector("#cd-minutes"),g=r.querySelector("#cd-seconds");F&&(F.textContent=f(s)),h&&(h.textContent=f(u)),b&&(b.textContent=f(p)),g&&(g.textContent=f(m))};l(),E.timer=setInterval(l,1e3)}static stop(){E.timer&&(clearInterval(E.timer),E.timer=null)}}class pe{static render(e,i){const t=document.createElement("div");t.className="not-available-widget";let r=i.headerOff;(!r||r.length===0)&&(r=y.reservationUnavailableMessage),t.innerHTML=`
            <i class="material-icons not-available-icon">event_busy</i>
            <div class="not-available-title">${y.reservationUnavailable}</div>
            <div class="not-available-message">${r}</div>
        `,e.appendChild(t)}}class x{static Status={OPEN:"OPEN",CLOSED:"CLOSED",BEFORE_START:"BEFORE_START"};static getStatus(e){const i=new Date;return e.startTime&&i<e.startTime?{status:x.Status.BEFORE_START,targetTime:e.startTime}:e.endTime&&i>e.endTime?{status:x.Status.CLOSED}:e.isOpen===!1?{status:x.Status.CLOSED}:{status:x.Status.OPEN}}static renderStatus(e,i,t,r={}){const{showPreview:a}=r,{status:d}=t;return a?!1:d===x.Status.BEFORE_START&&i.enableCountdown?(E.render(e,i,r.onReload),!0):d===x.Status.CLOSED||d===x.Status.BEFORE_START?(pe.render(e,i),!0):!1}}class me{static render(e,i,t,r,a){e.innerHTML=w`
            <div class="form-wrapper ${t.isCardDesign?"is-card-design":""}">
                ${r?w`<div style="width:100%; color:black; background:orange; padding:8px; margin-bottom:16px; text-align:center; font-weight:bold; font-size:13px;">${y.previewMode}</div>`:""}
                
                ${t.header?w`<div class="form-header">${K(this._optimizeLcp(t.header))}</div>`:""}
                
                ${t.description?w`<div class="form-description">${K(t.description)}</div>`:""}

                <form id="dynamic-form" novalidate>
                    <!-- Fields will be appended here -->
                    <div id="fields-container"></div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-submit">${y.buttonContinue}</button>
                    </div>
                </form>
            </div>
        `;const d=e.querySelector("#dynamic-form"),l=d.querySelector("#fields-container");t.visibleFields.forEach(n=>{const s=D.createFormField(n,t,i);l.appendChild(s)}),d.onsubmit=n=>{n.preventDefault(),a.onSubmit&&a.onSubmit(d,t)};const c=n=>{a.onInput&&a.onInput(n,d,t)};d.addEventListener("input",c),d.addEventListener("change",c)}static _optimizeLcp(e){return e&&e.replace(/<img\s/,'<img fetchpriority="high" ')}}class he{static get maxTicketsReached(){return o.tr("FeatureBlueprint.maxTicketsReached")||"Maximum number of tickets reached"}}class ge extends EventTarget{constructor(e){super(),this.formModel=e;const i=R.getAvailableCurrencies(e);if(this.state={totalPrice:0,totalItems:0,currency:i[0],availableCurrencies:i,validationErrors:{},tickets:[],fields:new Map},this.payload={fields:[],ticket:[],[q.metaSecret]:e.secret,[q.metaForm]:e.key},this.maxTickets=1,e&&e.relatedFields){const t=e.relatedFields.find(r=>r.type==="ticket");if(t&&t.data&&t.data.max_tickets){const r=parseInt(t.data.max_tickets,10);!isNaN(r)&&r>0&&(this.maxTickets=r)}}console.log(`[FormSession] Max tickets limit: ${this.maxTickets}`),this.uiState=new Map,this._spotQueue=Promise.resolve()}getComponentState(e){return this.uiState.get(e)}setComponentState(e,i){this.uiState.set(e,i)}refreshPayload(e){e&&(this.state.fields.size===0&&V.getPayload(e,this.formModel).fields.forEach(t=>{const r=Object.keys(t).find(a=>a!=="currency_code");r&&this.state.fields.set(r,t[r])}),this._syncPayloadFromState(),this._recalculate())}resetIncompatibleCurrencyFields(e){if(!e)return;let i=!1;this.state.tickets.forEach(t=>{if(t.fields){const r=[];t.fields.forEach((a,d)=>{a.currency_code&&a.currency_code!==e&&r.push(d)});for(let a=r.length-1;a>=0;a--)t.fields.splice(r[a],1),i=!0}});for(const[t,r]of this.state.fields.entries()){const a=this.formModel.visibleFields.find(d=>String(d.id)===String(t));if(a){const d=l=>{const c=a.options||a.data&&a.data.options||[];return a.type==="product_type"&&a.data&&a.data.product_type_data?a.data.product_type_data.products.find(n=>String(n.id)===String(l)):c.find(n=>String(n.id)===String(l))};if(!(typeof r=="string"&&r.includes(" | "))){const l=d(r);l&&l.currency&&l.currency!==e&&(this.state.fields.delete(t),i=!0)}}}i&&(this._syncPayloadFromState(),this._recalculate(),this._emitStateChanged())}addTicket(e={}){if(this.state.tickets.length,this.state.tickets.length>=this.maxTickets)throw console.warn("[FormSession] Max tickets reached"),new Error(he.maxTicketsReached);const i={id:Date.now()+Math.random(),fields:[],...e};this.state.tickets.push(i),this._syncPayloadFromState(),this._recalculate(),this._emitStateChanged()}async removeTicket(e){if(e>=0&&e<this.state.tickets.length){const i=this.state.tickets[e];if(i.spot)try{await q.selectSpot(this.formModel.key,this.formModel.secret,i.spot,!1)}catch(t){console.error("FormSession: Failed to deselect spot on removal",t)}this.state.tickets.splice(e,1),this._syncPayloadFromState(),this._recalculate(),this._emitStateChanged()}}updateTicket(e,i,t){if(e<0||e>=this.state.tickets.length)return;const r=this.state.tickets[e],a=r.fields.findIndex(d=>d._subFieldId===i||d._subFieldId===t?._subFieldId);a!==-1?t==null?r.fields.splice(a,1):r.fields[a]=t:t!=null&&r.fields.push(t),t&&t.type==="spot"&&(r.spot=t.value,r.spotPrice=t.price),this._syncPayloadFromState(),this._recalculate()}async toggleSpot(e,i){const t=typeof e=="object"?e.id:e,r=typeof e=="object"?e:{},a=c=>{if(c){if(!this.state.tickets.some(s=>String(s.spot)===String(t))){const s={spot:t,spotName:r.title||r.name||`Spot ${t}`},u=r.productModel||r.product;u&&u.price&&(s.spotPrice=u.price),this.addTicket(s)}}else{const n=this.state.tickets.findIndex(s=>String(s.spot)===String(t));n!==-1&&this.removeTicket(n)}},d=async()=>{a(i);try{const c=this.formModel.secret;return console.log(`[FormSession] Executing toggleSpot queue task. Spot: ${t}, Action: ${i?"Select":"Deselect"}, Secret: ${c}`),await q.selectSpot(this.formModel.key,c,t,i)}catch(c){throw console.error("FormSession: Spot selection failed, reverting state",c),a(!i),c}},l=this._spotQueue.then(()=>d());return this._spotQueue=l.catch(()=>{}),l}_syncPayloadFromState(){this.payload.ticket=this.state.tickets.map((e,i)=>{const t={fields:e.fields||[],_ticketIndex:i};return e.spot&&(t.spot=e.spot),e.spotPrice&&(t.spotPrice=e.spotPrice),e.spotName&&(t.spotName=e.spotName),t}),this.payload.fields=[];for(const[e,i]of this.state.fields.entries()){if(i==null||i==="")continue;const t=this.formModel.visibleFields.find(a=>String(a.id)===String(e));if(!t)continue;const r={[e]:i};if(typeof i=="string"&&!i.includes(" | ")){const d=(l=>{const c=t.options||t.data&&t.data.options||[];return t.type==="product_type"&&t.data&&t.data.product_type_data?t.data.product_type_data.products.find(n=>String(n.id)===String(l)):c.find(n=>String(n.id)===String(l))})(i);d&&d.currency&&(r.currency_code=d.currency)}this.payload.fields.push(r)}}handleInput(e,i){const t=e.target,r=t.name||t.getAttribute&&t.getAttribute("name");if(!r){t.dataset&&t.dataset.fieldId&&console.log("FormSession: Structural update detected from",t);return}if(t.dataset.ticketId&&t.dataset.index!==void 0&&t.dataset.subId){const d=t.dataset.ticketId,l=parseInt(t.dataset.index,10),c=t.dataset.subId;console.log("[FormSession] Handle Input (Data Attr):",{ticketId:d,index:l,subId:c}),this._handleTicketInputRefactored(t,i,[null,d,l,c]);return}const a=r.match(/^(\d+)_(\d+)_(.+)$/);a?(console.log("[FormSession] Handle Input (Regex):",a),this._handleTicketInputRefactored(t,i,a)):this._handleStandardInput(t,i,r)}_handleTicketInputRefactored(e,i,t){const r=t[1],a=typeof t[2]=="number"?t[2]:parseInt(t[2],10),d=t[3],l=this.formModel.visibleFields.find(p=>String(p.id)===String(r));if(!l)return;const n=(l.subFields||l.fields||l.data&&l.data.fields||[]).find(p=>String(p.id)===String(d));if(!n){console.warn(`[FormSession] subDef failed for subId ${d}`);return}let s=e.value;if(e.type==="checkbox"&&!e.checked&&(s=null),s!==null){const m=(F=>{const h=n.options||n.data&&n.data.options||[];return n.type==="product_type"&&n.data&&n.data.product_type_data?n.data.product_type_data.products.find(b=>String(b.id)===String(F)):h.find(b=>String(b.id)===String(F))})(s),f={[n.type]:s,_subFieldId:n.id};n.type==="product_type"&&(f.product_type=s),m&&(m.price!==void 0&&(f.price=m.price),m.currency&&(f.currency_code=m.currency)),console.log("[FormSession] Update Ticket:",{index:a,subId:d,valueObj:f}),n.type,this.updateTicket(a,n.id,f)}else this.updateTicket(a,n.id,null)}initialize(e){const i=V.getTicketDataFromDom(e,this.formModel);i.length>0&&(this.state.tickets=i,console.log("FormSession: Hydrated tickets from DOM:",this.state.tickets)),this.refreshPayload(e)}_handleStandardInput(e,i,t){const r=this.formModel.visibleFields.find(l=>String(l.id)===t);if(!r)return;let a=e.value;if(e.type==="checkbox"||r.type==="select_many"){const l=i.querySelectorAll(`input[name="${t}"]:checked`),c=Array.from(l).map(n=>n.value);a=c.length>1?c.join(" | "):c[0]||"",c.length===0&&(a=null)}a?this.state.fields.set(String(t),a):this.state.fields.delete(String(t)),this._syncPayloadFromState(),this._recalculate()}_handleStandardInput_LEGACY(e,i,t){const r=this.formModel.visibleFields.find(c=>String(c.id)===t);if(!r)return;let a=e.value;if(e.type==="checkbox"||r.type==="select_many"){const c=i.querySelectorAll(`input[name="${t}"]:checked`),n=Array.from(c).map(s=>s.value);a=n.length>1?n.join(" | "):n[0]||""}const l=this.payload.fields.findIndex(c=>c[t]!==void 0);if(l!==-1&&this.payload.fields.splice(l,1),a){const c={[t]:a},n=s=>{const u=r.options||r.data&&r.data.options||[];return r.type==="product_type"&&r.data&&r.data.product_type_data?r.data.product_type_data.products.find(p=>String(p.id)===String(s)):u.find(p=>String(p.id)===String(s))};if(!a.includes(" | ")){const s=n(a);s&&s.currency&&(c.currency_code=s.currency)}this.payload.fields.push(c)}this._recalculate()}_recalculate(){const e=R.calculatePrice(this.payload,this.formModel);this.updateState(e)}_emitStateChanged(){this.dispatchEvent(new CustomEvent("state-changed",{detail:this.state}))}setCurrency(e){this.state.currency!==e&&this.updateState({currency:e})}updateState(e){(e.totalPrice!==this.state.totalPrice||e.totalItems!==this.state.totalItems||e.currency!==this.state.currency)&&(this.state={...this.state,...e},this.dispatchEvent(new CustomEvent("state-changed",{detail:this.state})))}setValidationErrors(e){this.state={...this.state,validationErrors:e},this.dispatchEvent(new CustomEvent("validation-changed",{detail:this.state.validationErrors}))}setIsReady(e){this.dispatchEvent(new CustomEvent("state-changed",{detail:this.state}))}get currentState(){return this.state}}class fe{constructor(e,i){this.session=e,this.container=i,this.element=null,this.isVisible=!1,this._onStateChange=this._onStateChange.bind(this),this.session.addEventListener("state-changed",this._onStateChange)}_onStateChange(e){const i=e.detail;this.render(i)}render(e=null){const{totalPrice:i,totalItems:t,currency:r}=e||this.session.currentState,d=!!this.session.formModel.blueprint;let l=!1;if(d?i<=0&&t<=0&&(l=!0):i<=0&&(l=!0),l){this.element&&(this.element.remove(),this.element=null),this.updateSubmitButton(!1);return}if(this.updateSubmitButton(!0),!this.element){this.element=document.createElement("div"),this.element.id="floating-price-widget",this.element.className="floating-price-widget",document.body.appendChild(this.element);const n=this.session.formModel.primaryColor||"var(--primary-color)";let s="white";n.startsWith("#")&&(s=ae.isLight(n)?"black":"white"),this.element.style.cssText=`
                position: fixed; /* Always fixed as requested */
                top: 16px;
                right: 16px;
                z-index: 2005; /* Above Blueprint Modal */
                
                background-color: ${n};
                color: ${s};
                padding: 12px 16px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.3);
                display: flex;
                align-items: center;
                font-family: var(--font-family-base);
                font-weight: 600 !important;
                font-size: 1.1rem;
                animation: fadeIn 0.3s ease-out;
                cursor: pointer;
            `,this.element.onclick=()=>{const u=document.querySelector('#dynamic-form button[type="submit"]');u&&u.scrollIntoView({behavior:"smooth"})}}this.element.innerHTML=`
            <span style="margin-right: 6px; font-weight: 600;">${t}x</span>
            <i class="material-icons" style="font-size: 24px; margin-right: 10px;">local_activity</i>
            <span style="font-weight: 600;">${i} ${r}</span>
        `}updateSubmitButton(e){const t=(this.container||document).querySelector("#dynamic-form")||document.getElementById("dynamic-form");if(!t)return;const r=t.querySelector('button[type="submit"]');this.session.formModel.visibleFields.some(d=>d.type==="ticket")&&r&&(e?(r.disabled=!1,r.classList.remove("disabled"),r.style.opacity="1",r.style.cursor="pointer"):(r.disabled=!0,r.classList.add("disabled"),r.style.opacity="0.5",r.style.cursor="not-allowed"))}destroy(){this.session.removeEventListener("state-changed",this._onStateChange),this.element&&this.element.remove()}}class ye{constructor(e,i){this.session=e,this.container=i,this.element=null,this._handleStateChange=this._onStateChange.bind(this),this.session.addEventListener("state-changed",this._handleStateChange),this.render()}render(){const{currency:e,availableCurrencies:i}=this.session.state;if(this.element&&(this.element.remove(),this.element=null),console.log("CurrencySelectorWidget: Available currencies:",i),!i||i.length<=1){console.log("CurrencySelectorWidget: Not enough currencies to show selector");return}this.element=document.createElement("div"),this.element.className="currency-selector-widget",this.element.style.cssText=`
            margin-bottom: 24px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        `;const t=document.createElement("div");t.className="currency-selector-title",t.textContent=y.currencySelectLabel,t.style.cssText=`
            font-size: 14px;
            color: var(--text-color, #fff); /* Fallback to white for dark theme */
            margin-bottom: 8px;
            opacity: 0.8;
            font-weight: 500;
        `,this.element.appendChild(t);const r=document.createElement("div");r.className="currency-btn-group",r.style.cssText=`
            display: inline-flex;
            background-color: rgba(255, 255, 255, 0.05); /* Very slight background for group */
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        `,i.forEach((c,n)=>{const s=document.createElement("button");s.type="button",s.className="btn currency-btn",s.textContent=c;const u=c===e;s.style.cssText=`
                border: none;
                padding: 10px 24px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                transition: background-color 0.2s, color 0.2s;
                min-width: 80px;
                background-color: transparent;
                color: rgba(255, 255, 255, 0.6);
                border-radius: 0; /* Explicitly no radius for segmented look */
                flex: 1; /* Stretch to fill */
            `,n>0&&(s.style.borderLeft="1px solid rgba(255, 255, 255, 0.1)"),u&&this._applySelectedStyle(s),s.onclick=()=>{this.session.setCurrency(c)},r.appendChild(s)}),this.element.appendChild(r);const a=this.session.formModel;let d=null;if(a&&a.visibleFields){const c=a.visibleFields.find(n=>n.type==="product_type"||n.type==="ticket");c&&(d=c.id)}let l=!1;if(d){let c=this.container.querySelector(`.form-field-container[data-field-id="${d}"]`);if(!c){const n=this.container.querySelector(`input[name="${d}"]`);n&&(c=n.closest(".form-field-container"))}c&&c.parentNode&&(c.parentNode.insertBefore(this.element,c),l=!0)}if(!l){const c=this.container.querySelector(".form-header")||this.container.querySelector("h1.form-title");if(c&&c.parentElement)c.nextSibling?c.parentElement.insertBefore(this.element,c.nextSibling):c.parentElement.appendChild(this.element);else{const n=this.container.querySelector(".form-wrapper");n?n.prepend(this.element):this.container.prepend(this.element)}}}_applySelectedStyle(e){e.style.backgroundColor="var(--primary-color, #6200EE)",e.style.color="#fff",e.classList.add("active")}_onStateChange(e){e.detail,this.element&&this.render()}destroy(){this.session.removeEventListener("state-changed",this._handleStateChange),this.element&&this.element.remove()}}class H{static handleInputValidation(e,i,t){if(!t)return;const r=e.target,a=r.name;if(!a)return;const d={...t.state.validationErrors};if(!!!d[a]&&!r.classList.contains("invalid"))return;const c=r.dataset.required==="true";let n=!0,s=null;if(r.type==="radio"||r.type==="checkbox"){if(r.type==="checkbox"&&c)n=r.checked,n||(s=y.fieldCannotBeEmpty);else if(r.type==="radio"&&c){const u=i.querySelectorAll(`input[name="${a}"]`);n=Array.from(u).some(p=>p.checked),n||(s=y.fieldCannotBeEmpty)}}else c&&(!r.value||r.value.trim()==="")&&(n=!1,s=y.fieldCannotBeEmpty),n&&r.value&&(r.checkValidity()||(r.validity.typeMismatch||r.validity.patternMismatch)&&(n=!1,s=y.invalidFormat));if(console.log(`[FormValidator] Input: ${a} Valid: ${n}`),n){d[a]&&(delete d[a],t.setValidationErrors(d)),r.classList.remove("invalid");const u=r.closest(".form-field-container");if(u){const p=u.querySelector(".form-field-error");p&&(p.style.display="none");const m=u.querySelector(".radio-options, .checkbox-options");m&&m.classList.remove("invalid")}}else{let u=s||r.validationMessage||y.fieldCannotBeEmpty;d[a]=u,t.setValidationErrors(d),r.classList.add("invalid");const p=r.closest(".form-field-container");if(p){const m=p.querySelector(".form-field-error");m&&(m.textContent=u,m.style.display="block");const f=p.querySelector(".radio-options, .checkbox-options");f&&f.classList.add("invalid")}}}static validateAndShowErrors(e,i,t){const r={},a=e.elements;for(let c=0;c<a.length;c++){const n=a[c];if(!(n.nodeName==="BUTTON"||n.type==="submit")&&!r[n.name]){if(n.dataset.required==="true"){let s=!0;if(n.type==="radio"){const u=e.querySelectorAll(`input[name="${n.name}"]`);s=Array.from(u).some(p=>p.checked)}else n.type==="checkbox"?s=n.checked:s=n.value&&n.value.trim()!=="";if(!s){r[n.name]=y.fieldCannotBeEmpty;continue}}n.validity&&!n.validity.valid&&(n.validity.valueMissing?r[n.name]=y.fieldCannotBeEmpty:n.validity.typeMismatch||n.validity.patternMismatch?n.type==="tel"?r[n.name]=y.phoneFormatValidation:r[n.name]=y.invalidFormat:r[n.name]=n.validationMessage)}}const d=t?t.payload:null,l=d?d.fields:[];if(i.visibleFields.forEach(c=>{if(c.type==="ticket"){const n=d&&d.ticket?d.ticket:[];let s=c.subFields;(!s||s.length===0)&&(s=c.fields||c.data&&c.data.fields||[]),n.forEach((u,p)=>{s.forEach(m=>{const f=m.isRequired!==void 0?m.isRequired:m.is_required;if(f){const F=u.fields.find(g=>g._subFieldId?String(g._subFieldId)===String(m.id):g[m.type]!==void 0);let h=F?F[m.type]:null;m.type==="spot"&&h===null&&(h=u.spot);let b=!1;if(h!==null&&h!==""&&h!==void 0&&(b=!0),console.log(`[FormValidator] Ticket [${p}] Subfield [${m.id}] Type=[${m.type}] Required=${f} Val=[${h}] Satisfied=${b}`),!b){const g=u._ticketIndex!==void 0?u._ticketIndex:p,S=R.getTicketInputName(c.id,g,m.id);r[S]=y.fieldCannotBeEmpty}}})});return}if(!r[c.id]&&c.isRequired){let n=!1;if(d){const s=l.find(p=>p[c.id.toString()]!==void 0),u=s?s[c.id.toString()]:null;Array.isArray(u)?n=u.length>0:n=u!==null&&u!==""&&u!==void 0}n||(r[c.id]=y.fieldCannotBeEmpty)}}),t&&t.setValidationErrors(r),Object.keys(r).length>0){const c=Object.keys(r)[0];let n=e.elements[c];if(typeof RadioNodeList<"u"&&n instanceof RadioNodeList&&(n=n[0]),!n)try{n=e.querySelector(`[name="${c}"]`)}catch(s){console.warn(`[FormValidator] Selector error for ${c}`,s)}return n?((n.closest(".form-field-container")||n).scrollIntoView({behavior:"smooth",block:"center"}),n.focus&&n.focus({preventScroll:!0})):console.warn(`[FormValidator] Could not find element for error field: ${c}`),!1}return!0}static renderErrors(e,i){e.querySelectorAll(".form-field-error").forEach(a=>a.style.display="none"),e.querySelectorAll(".invalid").forEach(a=>a.classList.remove("invalid")),!(!i||Object.keys(i).length===0)&&Object.keys(i).forEach(a=>{const d=i[a];let l=e.querySelector(`[name="${a}"]`);if(!l){const c=e.querySelector("form");if(c&&c.elements[a]){let n=c.elements[a];typeof RadioNodeList<"u"&&n instanceof RadioNodeList&&(n=n[0]),l=n}}if(l){l.classList.add("invalid");const c=l.closest(".form-field-container");if(c){const n=c.querySelector(".form-field-error");n?(n.textContent=d,n.style.display="block"):console.error("[FormValidator] Error div not found in container",c);const s=c.querySelector(".radio-options, .checkbox-options");s&&s.classList.add("invalid")}else console.warn("[FormValidator] Field container not found for input",l)}else console.warn(`[FormValidator] Input not found for error field: ${a} in container`,e)})}}class Fe{static async submitOrder(e){try{const i=await de.sendOrder(e);let t={};i.success?t=i.data||{}:t={code:i.code,message:i.message,product:i.product};const r=t.code?String(t.code):i.success?"200":"0",a=parseInt(r.replace(/\D/g,""),10)||0;return t.code=a,{success:a===200,data:t}}catch(i){throw console.error("FormNetwork Submit Error:",i),i}}}class be extends oe{constructor(e){super(e),this.currentPriceWidget=null,this.currentSession=null,this.currentLink=null,this.onBack=null}cleanup(){this.currentPriceWidget&&(this.currentPriceWidget.destroy(),this.currentPriceWidget=null),this.currentSession=null;const e=document.getElementById("floating-price-widget");e&&e.remove(),this._fabBtn&&(this._fabBtn.remove(),this._fabBtn=null),super.clear()}async init(e,i={}){if(W.reset(),this.currentLink===e&&this.host&&this.host.innerHTML.trim()!==""){console.log("FormPage already initialized for link (Persistent):",e);return}if(i.onBack&&(this.onBack=i.onBack),this.cleanup(),window.scrollTo(0,0),this.currentLink=e,this.onBack=this.onBack||(()=>window.history.back()),!this.host){console.error("FormPage: No host element!");return}this.host.innerHTML="",this.host.style.transform="translate(0)",this.host.style.display="block";const t=document.getElementById("app");t&&(t.style.display="none");try{const r=await q.getFormByLink(e);if(!r){this.renderError(y.formNotFound);return}this.applyTheme(r),ue.updateMetaTags(r,window.location.href);const a=x.getStatus(r),n=!0&&new URLSearchParams(window.location.search).get("preview")==="true";if(x.renderStatus(this.host,r,a,{showPreview:n,onReload:()=>this.init(e)}))return;this.renderForm(r,n),j.updateAppData({formLink:e}).then(()=>{j.canSeeReservations()&&this.renderEditButton(e)})}catch(r){console.error(r),this.renderError(r.message+`
`+r.stack)}}renderEditButton(e){if(this._fabBtn)return;const i=document.createElement("button");i.className="fab-edit",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 17l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm635-498-57-57 57 57Zm-58 58L462-200H368v-94l329-329 57 57Z"/></svg>',i.style.position="fixed",i.style.bottom="24px",i.style.right="24px",i.style.width="56px",i.style.height="56px",i.style.borderRadius="50%",i.style.backgroundColor="var(--primary-color, #000)",i.style.color="#fff",i.style.border="none",i.style.boxShadow="0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)",i.style.cursor="pointer",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.zIndex="3000",i.onclick=()=>{let r=j.context?.occasion?.link;r||(r=e);const a=`/${r}/reservations`;M.navigateExternal(a)},document.body.appendChild(i),this._fabBtn=i}renderLoading(){this.host.innerHTML=`<div class="loading-spinner">${U.loading}</div>`}renderError(e){this.host.innerHTML=`<div class="error-message">${e}</div>`}applyTheme(e){te.applyThemeFromModel(e)}renderForm(e,i){const t=new ge(e);this.currentSession=t,t.addEventListener("validation-changed",a=>{H.renderErrors(this.host,a.detail)}),this.currentPriceWidget=new fe(t,this.host),me.render(this.host,t,e,i,{onSubmit:(a,d)=>this.validateAndSubmit(a,d),onInput:(a,d,l)=>{a.type==="input"&&H.handleInputValidation(a,d,t),a.target.name&&t.handleInput(a,d)}}),new ye(t,this.host),t.addEventListener("state-changed",a=>{const{currency:d,previousCurrency:l}=a.detail;this.host.querySelector("form")});let r=t.state.currency;t.addEventListener("state-changed",a=>{const{currency:d}=a.detail,l=this.host.querySelector("form");if(!l)return;const c=r!==d;r=d,l.querySelectorAll("[data-currency]").forEach(s=>{const u=s.getAttribute("data-currency");if((s.classList.contains("form-check")||s.classList.contains("dropdown-item")||s.classList.contains("option-card"))&&(u!==d?s.style.display="none":s.style.display=""),c&&s.tagName==="INPUT"&&s.checkValidity&&(s.type==="radio"||s.type==="checkbox")){s.checked=!1;const p=s.closest(".form-field-container");if(p){const m=p.querySelector(".btn-clear-selection");m&&(m.style.display="none")}}if(s.tagName==="INPUT"&&u!==d&&s.checkValidity&&(s.type==="radio"||s.type==="checkbox")&&s.checked){s.checked=!1;const p=s.closest(".form-field-container");if(p){const m=p.querySelector(".btn-clear-selection");m&&(m.style.display="none")}}}),c&&t.resetIncompatibleCurrencyFields(d)}),setTimeout(()=>{const a=this.host.querySelector("form");a&&(t.initialize(a),t.setIsReady(!0))},100)}handleInputValidation(e,i){H.handleInputValidation(e,i,this.currentSession)}validateAndSubmit(e,i){console.log("[FormPage] validateAndSubmit called");const t=H.validateAndShowErrors(e,i,this.currentSession);console.log("[FormPage] Custom Validator Result:",t),t&&this.handlePreview(e,i)}calculateTotal(e,i){if(this.currentSession)return this.currentSession.state;const t=V.getPayload(e,i);return R.calculatePrice(t,i)}handlePreview(e,i){if(console.log("[FormPage] handlePreview called"),!e.reportValidity()){console.warn("[FormPage] form.reportValidity() failed. Scanning for native invalid elements..."),Array.from(e.elements).forEach(t=>{t.willValidate&&!t.checkValidity()&&console.warn("[FormPage] Native Invalid Element:",t.name||t.id||t.tagName,t.validationMessage,t)});return}console.log("[FormPage] Native validation passed. Importing OrderPreview..."),O(async()=>{const{OrderPreview:t}=await import("./index-CcrWGBd4.js").then(r=>r.o);return{OrderPreview:t}},__vite__mapDeps([1,2])).then(({OrderPreview:t})=>{console.log("[FormPage] OrderPreview module loaded.",t);try{const r=this.calculateTotal(e,i),a=this.currentSession?this.currentSession.payload:null;t.show(e,i,r,d=>{this.submitOrder(e,i,d||document.body)},()=>{},a)}catch(r){console.error("[FormPage] OrderPreview.show crashed:",r)}}).catch(t=>console.error("[FormPage] Failed to load OrderPreview module",t))}closePreview(){const e=document.getElementById("order-preview-overlay");e&&(e.classList.remove("visible"),setTimeout(()=>{e.remove()},300))}submitOrder(e,i,t){const r=document.getElementById("order-preview-overlay");r?(r.remove(),M.goBackProgrammatically()):this.closePreview();const a=this.showFullScreenLoader(),d=this.currentSession?this.currentSession.payload:V.getPayload(e,i);Fe.submitOrder(d).then(l=>{a.remove(),document.body.style.overflow="",l.success&&(this.cleanup(),this.host&&(this.host.innerHTML="",this.renderForm(i,!1)),window.scrollTo(0,0)),this.showFullScreenResult(l.success,l.data,i)}).catch(l=>{console.error("Submit Error:",l),a.remove(),document.body.style.overflow="",this.showFullScreenResult(!1,{code:999},i)})}showFullScreenLoader(){const e=document.createElement("div");if(e.className="fullscreen-loader-overlay",e.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85); /* Dark background */
            backdrop-filter: blur(5px);
            z-index: 3000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: var(--font-family-base, sans-serif);
        `,e.innerHTML=`
            <div class="spinner"></div>
            <div style="margin-top: 24px; font-weight: 600; font-size: 1.1rem; color: #ffffff;">
                ${U.processing||"Processing..."}
            </div>
        `,document.body.appendChild(e),document.body.style.overflow="hidden",!document.getElementById("spinner-style")){const i=document.createElement("style");i.id="spinner-style",i.textContent=`
                .spinner {
                    border: 4px solid rgba(255,255,255,0.1); /* Light track for dark bg */
                    border-top: 4px solid var(--primary-color, #3498db);
                    border-radius: 50%;
                    width: 50px;
                    height: 50px;
                    animation: spin 1s linear infinite;
                }
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `,document.head.appendChild(i)}return e}showFullScreenResult(e,i,t){M.pushOverlayState("order-result");const r=document.createElement("div");r.className="fullscreen-result-overlay",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100%",r.style.height="100%",r.style.backgroundColor="var(--background-color, #fff)",r.style.zIndex="3000",r.style.overflowY="auto",r.style.padding="20px",r.style.boxSizing="border-box",r.style.display="flex",r.style.flexDirection="column",r.style.justifyContent="center",r.style.alignItems="center",document.body.appendChild(r),document.body.style.overflow="hidden";const a=()=>{r.remove(),document.body.style.overflow="",e&&(this.cleanup(),this.host&&(this.host.innerHTML="",this.renderForm(t,!1)),window.scrollTo(0,0))},d=()=>{window.removeEventListener("popstate",d),a()};window.addEventListener("popstate",d,{once:!0}),O(async()=>{const{OrderResult:l}=await import("./order_result-4cRecScd.js");return{OrderResult:l}},__vite__mapDeps([3,1,2])).then(({OrderResult:l})=>{l.render(r,e,i,t,()=>{M.goBackProgrammatically()})})}}const Se=Object.freeze(Object.defineProperty({__proto__:null,FormPage:be},Symbol.toStringTag,{value:"Module"}));export{y as F,Se as f};
