<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="Aplikace Člověk a Víra.">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Aplikace Člověk a Víra">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="shortcut icon" href="favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Aplikace Člověk a Víra" />
  <link rel="manifest" href="site.webmanifest" />
  <meta name="theme-color" content="#ffffff">

  <title>Aplikace Člověk a Víra</title>
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];

   async function initializeOneSignal(callback, errorCallback) {
       if (!window.OneSignalInitialized) {
           window.OneSignalInitialized = true;
           OneSignalDeferred.push(async function(OneSignal) {
               try {
                 await OneSignal.init({
                       appId: "009d3437-d794-459f-9e3d-4bd70b740f7d",
                       safari_web_id: "web.onesignal.auto.175a5781-a0a7-4966-97e0-0bfa01fcdb1f",
                       allowLocalhostAsSecureOrigin: true,
                       persistNotification: false,
                       welcomeNotification: {
                         title: "Notifikace",
                         message: "Děkujeme za povolení notifikací.",
                       },
                       serviceWorkerParam: { scope: "/push/" },
                       serviceWorkerPath: "./push/OneSignalSDKWorker.js",
                   });

                   OneSignal.Notifications.addEventListener('foregroundWillDisplay', function(event) {
                       console.log("Received notification: ", event.notification.title, event.notification.body);
                       // Show SnackBar or do async work
                   });
               } catch (error) {
                 console.log("OneSignal initialization failed:", error);
               }

               if (callback) callback(null);
           });
       }
   }

   async function requestNotificationPermission(callback, errorCallback) {
       try {
           await OneSignal.Notifications.requestPermission()
           console.log("Notification permission request sent.");
           if (callback) callback(getNotificationPermission());
       } catch (error) {
           console.error("Notification permission request failed:", error);
           if (errorCallback) errorCallback(error);
       }
   }

   async function logout(callback, errorCallback) {
       OneSignalDeferred.push(async function(OneSignal) {
           await OneSignal.logout();
           console.log("User has been logged out from OneSignal.");
       });
       if (callback) callback(null);
   }

   async function login(externalId, callback, errorCallback) {
       console.log("User is logging to OneSignal with Id:", externalId);
       OneSignalDeferred.push(async function(OneSignal) {
           await OneSignal.login(externalId);
           console.log("User has been logged in to OneSignal successfully with externalId:", externalId);
       });
       if (callback) callback(null);
   }

   function getNotificationPermission() {
    // Check if the Notification API is supported
    if (!("Notification" in window)) {
      console.error("This browser does not support desktop notifications.");
      return false;
    }

    // Check if the site is served over HTTPS or is running on localhost
    if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
      console.error("Notifications require a secure context (HTTPS).");
      return false;
    }

    // Return the permission status
    return OneSignal.Notifications.permission;
  }

   async function optIn(callback, errorCallback) {
       try {
           await OneSignal.User.PushSubscription.optIn();
           console.log("User has opted in for notifications.");
       } catch (error) {
           console.error("Opt-in for notifications failed:", error);
       }
       if (callback) callback(null);
   }

   async function optOut(callback, errorCallback) {
       try {
           await OneSignal.User.PushSubscription.optOut();
           console.log("User has opted out of notifications.");
       } catch (error) {
           console.error("Opt-out of notifications failed:", error);
       }
       if (callback) callback(null);
   }
  </script>
  <script>
    function setMetaThemeColor(color) {
        document.querySelector('meta[name="theme-color"]').setAttribute("content", color);
      }
    function setBodyBackgroundColor(color) {
      document.body.style.backgroundColor = color;
    }
  </script>
</head>
<body>

<script>
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (e) => {
    deferredPrompt = e;
    e.preventDefault();
    return false;
  });

  function promptInstall(){
     deferredPrompt.prompt();
  }

  // Listen for app install event
  window.addEventListener('appinstalled', () => {
    deferredPrompt = null;
    appInstalled();
  });

  // Track how PWA was launched (either from browser or as PWA)
  function getLaunchMode() {
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
    if(deferredPrompt) hasPrompt();
    if (document.referrer.startsWith('android-app://')) {
      appLaunchedAsTWA();
    } else if (navigator.standalone || isStandalone) {
      appLaunchedAsPWA();
    } else {
      window.appLaunchedInBrowser();
    }
  }
</script>

<script>
  window.addEventListener('load', function(ev) {
      {{flutter_js}}
      {{flutter_build_config}}

      _flutter.loader.load({
        serviceWorkerSettings: {
          timeoutMillis: 8000,
          serviceWorkerVersion: {{flutter_service_worker_version}},
        },
        onEntrypointLoaded: async function(engineInitializer) {
          const appRunner = await engineInitializer.initializeEngine({
            useColorEmoji: true
          });
          await appRunner.runApp();
        }
      });
    });
</script>

<style>
  body {
    background-color: white;
    height: 100vh;
    width: 100vw;
    margin: 0px;
  }
  .main-content {
    height: 100%;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.4s ease-out;
  }

  svg {
  margin-top: -72px;
  margin-left: -144px;
  max-width: 280px;
  max-height: 100px;
  position: absolute;
  }


</style>

  <div class="main-content" id="loader-content">
      <div class="loader">
      <span>
        <svg version="1.1" id="Vrstva_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
             width="841.89px" height="595.28px" viewBox="0 0 841.89 595.28" enable-background="new 0 0 841.89 595.28" xml:space="preserve">
<path fill="#D39C0A" d="M449.244,170.826h-23.856v111.448h23.856v-24.015l5.965-7.535l18.682,31.55h29.353l-31.395-45.68
	l27.471-31.077H470.59l-15.539,23.072c-1.881,2.827-3.768,5.965-5.493,9.263h-0.313V170.826z M384.54,195.94l15.541-23.859h-15.695
	l-7.853,13.656h-0.311l-8.004-13.656h-15.541l15.541,23.859H384.54z M362.25,235.184c0.629-6.28,4.711-15.543,14.755-15.543
	c10.988,0,13.498,9.733,13.498,15.543H362.25z M411.855,251.508c0.313-1.725,0.783-5.337,0.783-9.416
	c0-18.996-9.417-38.304-34.219-38.304c-26.687,0-38.774,21.505-38.774,40.969c0,24.019,14.915,39.085,40.973,39.085
	c10.362,0,19.936-1.57,27.783-4.864l-3.139-16.168c-6.435,2.198-13.031,3.297-21.195,3.297c-11.139,0-21.032-4.71-21.657-14.6
	H411.855z M258.005,205.517l27.941,76.756h23.859l28.57-76.756h-25.117l-9.887,35.629c-1.729,6.595-2.983,12.405-4.239,18.682
	h-0.473c-1.252-6.121-2.51-12.086-4.395-18.682l-10.357-35.629H258.005z M216.503,220.743c10.83,0,15.227,11.617,15.227,22.919
	c0,13.967-5.81,23.231-15.227,23.231c-10.204,0-15.697-9.892-15.697-23.075C200.806,232.515,205.202,220.743,216.503,220.743
	 M217.289,203.63c-24.803,0-41.127,15.855-41.127,40.816c0,24.8,17.268,39.556,39.714,39.556c20.562,0,40.498-12.872,40.498-40.969
	C256.374,219.802,240.677,203.63,217.289,203.63 M139.825,282.273h23.859V170.826h-23.859V282.273z M111.569,195.94l15.54-23.859
	h-15.697l-7.847,13.656h-0.316l-8.007-13.656H79.706l15.537,23.859H111.569z M125.54,262.655c-3.61,1.57-8.007,2.51-13.655,2.51
	c-11.619,0-21.034-7.535-21.034-21.502c-0.161-12.561,8.003-21.505,20.561-21.505c6.281,0,10.518,1.096,13.343,2.354l3.767-17.738
	c-5.024-1.883-11.93-2.983-18.207-2.983c-28.572,0-43.953,18.368-43.953,40.813c0,24.016,15.853,39.241,40.654,39.241
	c9.104,0,17.11-1.57,21.35-3.605L125.54,262.655z"/>
<path fill="#D39C0A" d="M287.393,386.743c0,0-34.794-24.54-64.234-32.939c-29.438-8.399-38.266-4.21-41.509-2.895
	c-3.239,1.319-8.92,3.716-11.455,5.526c-2.533,1.813-5.03,3.676-5.03,3.676s2.64-4.995,9.539-8.945
	c6.902-3.948,6.762-3.948,6.762-3.948s-10.142,3.127-19.155,10.54c-9.016,7.409-8.594,7.577-12.395,11.857
	c-3.806,4.28-4.508,5.27-4.508,5.27s1.776-10.103,12.396-19.769c10.36-9.427,24.646-21.243,58.597-18.44
	c32.537,2.797,50.708,23.714,50.708,23.714l-4.508-1.316c0,0,26.197,17.461,32.679,22.4c4.645-0.495,18.171-8.564,23.663-11.858
	c5.493-3.297,6.482-4.613,7.888-5.272c1.41-0.656,2.958,0.332,0,2.635c-2.957,2.309-23.663,19.766-23.663,19.766
	s1.551,3.053,3.745,4.909c6.483,5.48,0.762,2.998,0.762,2.998s13.382,11.033,16.903,15.812c0.705,0.821,0.847,2.965-4.511-1.318
	c-5.348-4.283-20.423-15.482-22.533-17.128c-2.395,0.491-19.58,14.493-38.313,22.396c-18.736,7.907-26.905,10.872-43.95,10.542
	c-17.042-0.329-28.172-1.645-38.313-6.585c-10.143-4.942-15.775-10.541-15.775-10.541s2.957,0.982,6.759,2.634
	c3.804,1.646,18.533,5.716,5.636,0c-9.159-4.061-11.161-6.252-19.158-13.177c-8.066-6.988-9.013-9.223-9.013-9.223
	s10.098,6.529,21.509,12.789c11.409,6.259,25.82,13.231,49.484,9.61c23.662-3.627,36.061-10.341,36.061-10.341
	s-6.343,5.398-7.891,6.388c6.338-2.635,22.004-10.038,22.004-10.038s-2.99,3.287-3.974,4.769
	C271.472,397.45,285.277,389.049,287.393,386.743"/>
<path d="M704.296,391.711l7.343-26.257c2.018-7.159,3.857-16.523,5.692-23.866h0.367c1.839,7.343,4.036,16.523,6.239,23.866
	l7.713,26.257H704.296z M735.689,412.643l9.547,31.757h30.292l-38.554-123.743h-36.72l-37.633,123.743h28.822l8.811-31.757H735.689z
	 M586.028,341.588c2.019-0.549,5.875-0.919,12.669-0.919c12.853,0,20.562,5.878,20.562,17.076c0,10.832-8.259,17.809-22.211,17.809
	h-11.02V341.588z M558.307,444.399h27.722V395.75h8.266c11.562,0.183,16.889,4.223,20.376,19.826
	c3.486,15.237,6.607,25.153,8.444,28.823h28.645c-2.392-4.771-6.062-20.929-9.916-35.063c-3.121-11.382-7.896-19.461-16.523-22.95
	v-0.55c10.646-3.859,21.848-14.688,21.848-30.295c0-11.382-4.039-20.196-11.565-26.069c-8.814-6.975-21.667-9.731-40.025-9.731
	c-15.058,0-28.274,1.104-37.27,2.571V444.399z M504.57,444.399h27.909V320.656H504.57V444.399z M448.95,444.399l41.674-123.743
	h-29.742l-15.788,52.876c-4.222,14.139-8.078,28.827-11.197,43.698h-0.553c-2.938-15.424-6.791-29.376-11.016-44.248l-15.058-52.326
	h-30.658l39.659,123.743H448.95z"/>
<polygon fill="#D39C0A" points="67.042,301.398 502.654,290.218 490.701,312.579 "/>
<polygon points="516.609,290.218 504.94,312.597 532.567,312.597 547.986,290.218 "/>
</svg>
      </span>
      </div>

  </div>
</body>
</html>
